"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[101],{200:function(t,e,r){r.d(e,{t:function(){return a}});var n=r(7975);let a=t=>{let e=JSON.parse(JSON.stringify(t)),r=n.pojoUtilities.parseUniquePojoRootKeyOrThrow(e),a=e[r],o=(t,r)=>{let a=n.pojoUtilities.extractChildrenNodes(t,e),l=Object.keys(a);return 0===l.length?{name:t,nodeContent:r}:{name:t,nodeContent:r,children:l.map(t=>{let e=a[t];return o(t,e.nodeContent)})}};return o(r,a.nodeContent)}},7101:function(t,e,r){var n=r(5893),a=r(7294),o=r(6528),l=r(990),s=r(6897),i=r(8649),c=r(5083),d=r(5972),u=r(5281),p=r(1778),f=r(1121),h=r(9986),x=r(1015),y=r(8521),g=r(200);e.Z=t=>{let{formData:e,selectedSystem:r,selectedField:m}=t,b=(0,a.useRef)(null),v=(0,a.useRef)(null),j=(0,a.useRef)(null),[k,Z]=(0,a.useState)("hierarchy"),[C,w]=(0,a.useState)("fieldId"),[N,M]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(!e||!r||!m){M(null);return}try{let t=new y.Models.FsModelForm(e,{fieldModelVersion:"v2"}),r=y.TreeUtilities.FsFieldVisibilityGraph.fromFormModel(m,t).toPojoAt();console.log({visibilityGraph:r});let n=(0,g.t)(r);console.log({d3Nodes:n}),M(n)}catch(t){console.error("Error generating visibility graph:",t),M(null)}},[e,r,m]),(0,a.useEffect)(()=>{if(!N||!b.current)return;let t={top:20,right:90,bottom:30,left:90};o.Ys(b.current).selectAll("*").remove();let e=o.sPX().scaleExtent([.1,4]).on("zoom",t=>{n.attr("transform",t.transform)}),r=o.Ys(b.current).attr("width",800).attr("height",600).call(e);j.current=e;let n=r.append("g").attr("transform","translate(".concat(t.left,",").concat(t.top,")"));n.append("defs").selectAll("marker").data(["end"]).enter().append("marker").attr("id","arrow").attr("viewBox","0 -5 10 10").attr("refX",7).attr("refY",0).attr("markerWidth",8).attr("markerHeight",8).attr("orient","auto").append("path").attr("class","arrow").attr("d","M0,-5L10,0L0,5").attr("fill","#999");let a=o.Ys("body").append("div").attr("class","tooltip").style("position","absolute").style("visibility","hidden").style("background-color","white").style("border","1px solid #ddd").style("border-radius","5px").style("padding","10px").style("box-shadow","0 2px 4px rgba(0,0,0,0.2)").style("font-size","12px").style("max-width","300px").style("color","#000").style("z-index","1000");if("hierarchy"===k){let e=o.G_s().size([800-t.left-t.right,600-t.top-t.bottom])(o.bT9(N));n.append("g").selectAll("path").data(e.links()).enter().append("path").attr("class","link").attr("d",t=>{let e=t.target.x-t.source.x,r=t.target.y-t.source.y,n=Math.sqrt(e*e+r*r),a=t.target.x-e/n*20,o=t.target.y-r/n*20;return"M".concat(t.source.x,",").concat(t.source.y,"L").concat(a,",").concat(o)}).attr("fill","none").attr("stroke","#999").attr("stroke-opacity",.8).attr("stroke-width",2).attr("marker-end","url(#arrow)");let r=n.append("g").selectAll("g").data(e.descendants()).enter().append("g").attr("transform",t=>"translate(".concat(t.x,",").concat(t.y,")"));r.append("circle").attr("r",20).attr("fill",t=>t.data.nodeContent&&t.data.nodeContent.isError?(console.log("Error node found:",t.data.name,t.data.nodeContent),"#ff4444"):"#69b3a2").on("mouseover",function(t,e){a.style("visibility","visible").html("<strong>".concat(e.data.name,"</strong><br/><pre>").concat(JSON.stringify(e.data.nodeContent,null,2),"</pre>")).style("left",t.pageX+10+"px").style("top",t.pageY-28+"px")}).on("mouseout",function(){a.style("visibility","hidden")}),r.append("text").attr("dy",".31em").attr("text-anchor","middle").style("font-size","12px").style("fill","#000000").style("font-weight","500").each(function(t){let e=o.Ys(this);E(t.data).split("\n").forEach((t,r)=>{e.append("tspan").attr("x",0).attr("dy",0===r?"0":"1.2em").text(t)})})}else{let{nodes:t,links:e}=function(t,e){let r=[],n=[],a=new Set;return function t(e,o){let l=e.id||e.name;a.has(l)||(a.add(l),r.push({id:l,name:e.name,nodeContent:e.nodeContent})),o&&n.push({source:o,target:l}),e.children&&e.children.forEach(e=>t(e,l))}(t,void 0),{nodes:r,links:n}}(N);console.log("Force layout nodes:",t),console.log("Force layout links:",e),v.current=o.A4v(t).force("link",o.Fsl(e).id(t=>t.id).distance(100)).force("charge",o.q5i().strength(-300)).force("center",o.wqt(400,300));let r=n.append("g").selectAll("path").data(e).enter().append("path").attr("stroke","#999").attr("stroke-opacity",.6).attr("stroke-width",2).attr("marker-end","url(#arrow)"),l=n.append("g").selectAll("g").data(t).enter().append("g").call(o.ohM().on("start",function(t,e){!t.active&&v.current&&v.current.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y}).on("drag",function(t,e){e.fx=t.x,e.fy=t.y}).on("end",function(t,e){!t.active&&v.current&&v.current.alphaTarget(0),e.fx=null,e.fy=null}));l.append("circle").attr("r",20).attr("fill",t=>t.nodeContent&&t.nodeContent.isError?(console.log("Error node found:",t.name,t.nodeContent),"#ff4444"):"#69b3a2").on("mouseover",function(t,e){a.style("visibility","visible").html("<strong>".concat(e.name,"</strong><br/><pre>").concat(JSON.stringify(e.nodeContent,null,2),"</pre>")).style("left",t.pageX+10+"px").style("top",t.pageY-28+"px")}).on("mouseout",function(){a.style("visibility","hidden")}),l.append("text").attr("dy",".31em").attr("text-anchor","middle").style("font-size","12px").style("fill","#000000").style("font-weight","500").each(function(t){let e=o.Ys(this);E(t).split("\n").forEach((t,r)=>{e.append("tspan").attr("x",0).attr("dy",0===r?"0":"1.2em").text(t)})}),v.current.on("tick",()=>{r.attr("d",t=>{let e=t.source,r=t.target;if(!e.x||!e.y||!r.x||!r.y||isNaN(e.x)||isNaN(e.y)||isNaN(r.x)||isNaN(r.y))return"M0,0L0,0";let n=r.x-e.x,a=r.y-e.y,o=Math.sqrt(n*n+a*a);if(0===o)return"M".concat(e.x,",").concat(e.y,"L").concat(e.x,",").concat(e.y);let l=r.x-n/o*20,s=r.y-a/o*20;return"M".concat(e.x,",").concat(e.y,"L").concat(l,",").concat(s)}),l.attr("transform",t=>{let e=t.x||0,r=t.y||0;return"translate(".concat(e,",").concat(r,")")})})}return()=>{v.current&&v.current.stop(),o.Ys("body").selectAll(".tooltip").remove()}},[N,k,C]);let E=t=>{let e=t.nodeContent||t;switch(C){case"fieldId":return e.directOwnerFieldId||t.name||"";case"value":if(e.value)return[e.subjectId||"",e.operator||"",e.value||""].filter(t=>""!==t).join("\n");return e.operator||e.subjectId||t.name||"";case"nodeId":let r=t.name||"";if(r.startsWith("_root_:")){let t=r.split(":");if(t.length>1)return t.slice(1).join(":")||"vRoot";return"vRoot"}return r;default:return t.name||""}};return r&&m?N?(0,n.jsxs)(l.Z,{sx:{p:2},children:[(0,n.jsxs)(l.Z,{sx:{mb:2,display:"flex",gap:2,alignItems:"center"},children:[(0,n.jsxs)(s.Z,{size:"small",sx:{minWidth:150},children:[(0,n.jsx)(i.Z,{children:"Layout Type"}),(0,n.jsxs)(c.Z,{value:k,label:"Layout Type",onChange:t=>{Z(t.target.value)},children:[(0,n.jsx)(d.Z,{value:"hierarchy",children:"Hierarchy"}),(0,n.jsx)(d.Z,{value:"force",children:"Force-Directed"})]})]}),(0,n.jsxs)(l.Z,{sx:{fontSize:"0.875rem",color:"text.secondary"},children:["Field: ",(0,n.jsx)("strong",{children:m})," | System:"," ",(0,n.jsx)("strong",{children:r})]})]}),(0,n.jsxs)(l.Z,{sx:{mb:2,display:"flex",gap:2,alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsx)(s.Z,{component:"fieldset",children:(0,n.jsxs)(u.Z,{row:!0,value:C,onChange:t=>w(t.target.value),children:[(0,n.jsx)(p.Z,{value:"fieldId",control:(0,n.jsx)(f.Z,{}),label:"Field ID"}),(0,n.jsx)(p.Z,{value:"value",control:(0,n.jsx)(f.Z,{}),label:"Value"}),(0,n.jsx)(p.Z,{value:"nodeId",control:(0,n.jsx)(f.Z,{}),label:"Node ID"})]})}),(0,n.jsxs)(h.Z,{size:"small",variant:"outlined",children:[(0,n.jsx)(x.Z,{onClick:()=>{if(b.current){let t=o.Ys(b.current),e=o.P2S(t.node()),r=Math.min(1.5*e.k,4),n=o.CRH.scale(r).translate(e.x,e.y);t.transition().duration(300).call(j.current.transform,n)}},title:"Zoom In",children:"+"}),(0,n.jsx)(x.Z,{onClick:()=>{if(b.current){let t=o.Ys(b.current),e=o.P2S(t.node()),r=Math.max(e.k/1.5,.1),n=o.CRH.scale(r).translate(e.x,e.y);t.transition().duration(300).call(j.current.transform,n)}},title:"Zoom Out",children:"−"}),(0,n.jsx)(x.Z,{onClick:()=>{b.current&&o.Ys(b.current).transition().duration(300).call(j.current.transform,o.CRH)},title:"Reset Zoom",children:"⌂"})]})]}),(0,n.jsx)(l.Z,{sx:{border:1,borderColor:"divider",borderRadius:1,bgcolor:"background.paper",overflow:"hidden"},children:(0,n.jsx)("svg",{ref:b})})]}):(0,n.jsx)(l.Z,{sx:{p:2,textAlign:"center",color:"text.secondary"},children:"Loading visibility graph..."}):(0,n.jsx)(l.Z,{sx:{p:2,textAlign:"center",color:"text.secondary"},children:"Please select a system and field to view the visibility graph."})}}}]);