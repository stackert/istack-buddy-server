"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[38],{8521:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(351),t)},6574:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ALL_KNOWN_FS_FIELD_TYPES=void 0,t.ALL_KNOWN_FS_FIELD_TYPES=["address","checkbox","creditcard","datetime","email","embed","file","matrix","section","select","signature","text","textarea","name","number","phone","product","radio","rating","richtext","table","tableheader","tablecell"]},351:function(e,t,r){var n,i,o,s,a,l,u,c,d,h=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),f=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),p=this&&this.__importStar||(n=function(e){return(n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),i=0;i<r.length;i++)"default"!==r[i]&&h(t,e,r[i]);return f(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ENormalizedExpressionResultType=t.ALL_KNOWN_FS_FIELD_TYPES=t.EObservationResource=t.EObservationClass=t.EObservationSubjectType=t.ELogLevel=t.TreeUtilities=t.ObservationMakers=t.Models=void 0;let g=r(9386),v=p(r(9959)),m=p(r(4585)),y=r(7175),_=r(1631),b=r(97),I=r(4982),w=r(8133),O=r(5562);(i=u||(t.Models=u={})).FsModelForm=g.FsModelForm,i.FsModelField=g.FsModelField,i.FsModelFieldV2025=g.FsModelFieldV2025,(o=c||(t.ObservationMakers=c={})).AbstractObservationMaker=v.AbstractObservationMaker,o.FieldCalculationObservationMaker=v.FieldCalculationObservationMaker,o.FieldLogicObservationMaker=v.FieldLogicObservationMaker,o.FieldConfigurationObservationMaker=v.FieldConfigurationObservationMaker,o.FieldOrphanFieldIdObservationMaker=v.FieldOrphanFieldIdObservationMaker,o.CompositeFormCalculationObservationMaker=v.CompositeFormCalculationObservationMaker,o.CompositeFormLogicObservationMaker=v.CompositeFormLogicObservationMaker,o.CompositeFormConfigurationObservationMaker=v.CompositeFormConfigurationObservationMaker,o.CompositeFormOrphanFieldIdObservationMaker=v.CompositeFormOrphanFieldIdObservationMaker,(s=o.types||(o.types={})).ELogLevel=m.ELogLevel,s.EObservationSubjectType=m.EObservationSubjectType,s.EObservationClass=m.EObservationClass,s.EObservationResource=m.EObservationResource,(l=(a=d||(t.TreeUtilities=d={})).transformers||(a.transformers={})).transformToLogicSystems=y.transformToLogicSystems,l.transformToCalculationSystems=y.transformToCalculationSystems,l.transformToCircularCalculationSystems=y.transformToCircularCalculationSystems,l.toD3HierarchyGraphNodes=w.toD3HierarchyGraphNodes,l.genericPojoToGraphNodes=O.GenericPojoToGraphNodes,a.FsCalculationGraphDeep=_.FsCalculationGraphDeep,a.FsCalculationGraphShallow=b.FsCalculationGraphShallow,a.FsFieldVisibilityGraph=I.FsFieldVisibilityGraph;var C=r(4585);Object.defineProperty(t,"ELogLevel",{enumerable:!0,get:function(){return C.ELogLevel}}),Object.defineProperty(t,"EObservationSubjectType",{enumerable:!0,get:function(){return C.EObservationSubjectType}}),Object.defineProperty(t,"EObservationClass",{enumerable:!0,get:function(){return C.EObservationClass}}),Object.defineProperty(t,"EObservationResource",{enumerable:!0,get:function(){return C.EObservationResource}});var N=r(6574);Object.defineProperty(t,"ALL_KNOWN_FS_FIELD_TYPES",{enumerable:!0,get:function(){return N.ALL_KNOWN_FS_FIELD_TYPES}});var F=r(2391);Object.defineProperty(t,"ENormalizedExpressionResultType",{enumerable:!0,get:function(){return F.ENormalizedExpressionResultType}})},5845:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractFsTreeGeneric=void 0;let n=r(7975);class i extends n.AbstractDirectedGraph{isEmptyTree(){return null===this.getChildContentAt(this.rootNodeId)&&0===this.getDescendantNodeIds(this.rootNodeId).length}getAllErrorNodes(){let e=[];return this.visitAllAt({visit:(t,r,n)=>{r&&r.isError&&e.push(r)},includeSubtrees:!1},this.rootNodeId),e}}t.AbstractFsTreeGeneric=i},4295:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractFsModel=void 0;class r{get displayOrder(){let e=this.getRawJson();return void 0!==e.displayOrder&&null!==e.displayOrder?Number(e.displayOrder)||0:void 0!==e.sort&&null!==e.sort&&Number(e.sort)||0}}t.AbstractFsModel=r},5051:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.FsModelField=void 0;let n=r(4295);class i extends n.AbstractFsModel{constructor(e,t){var r,n,i;super(),this._tableColumnProps=null,this._rawJson=e,this._parentSectionId=t,this._fieldId=(null===(r=e.id)||void 0===r?void 0:r.toString())||(null===(n=e.fieldId)||void 0===n?void 0:n.toString())||(null===(i=e.field)||void 0===i?void 0:i.toString())||""}get fieldId(){return this._fieldId+""}set visibilityLogicParent(e){this._visibilityLogicParent=e}get visibilityLogicParent(){return this._visibilityLogicParent}convertApiLogicToIStackBuddyLogicJunction(e){var t,r;if(!e)return null;let n="any"===e.conditional?"$or":"$and";return{action:(null===(t=e.action)||void 0===t?void 0:t.toLocaleLowerCase())==="show"?"show":"hide",conditional:n,checks:(null===(r=e.checks)||void 0===r?void 0:r.map(e=>{var t,r,n;return{fieldId:(null===(t=e.fieldId)||void 0===t?void 0:t.toString())||(null===(r=e.field)||void 0===r?void 0:r.toString())||(null===(n=e.id)||void 0===n?void 0:n.toString())||"",condition:e.condition||"equals",option:e.option||""}}))||[],ownerFieldId:this.fieldId,fieldJson:this.getRawJson()}}get visibilityLogicOwn(){return this.convertApiLogicToIStackBuddyLogicJunction(this._rawJson.logic)}getRawJson(){return this._rawJson}getRawJsonItem(e){return this._rawJson[e]}getLogicOwn(){return this.convertApiLogicToIStackBuddyLogicJunction(this._rawJson.logic)}getSectionId(){return"FIELDS_WITHOUT_SECTIONS"===this._parentSectionId?null:this._parentSectionId}setTableColumnProperties(e){this._tableColumnProps={...e}}isLikelyDateCalculation(){if(this._rawJson.calculation&&""!==this._rawJson.calculation.trim())return!1;let e=this._rawJson;return!!e.datetimeCalculations||"date"===e.calculation_category||!!e.field_one_calculation&&!!e.field_two_calculation&&""!==e.field_one_calculation.trim()&&""!==e.field_two_calculation.trim()}getCalculationString(){var e;if("tablecell"===this.getFieldType())return(null===(e=this._tableColumnProps)||void 0===e?void 0:e.calculationString)||null;if(this._rawJson,this.isLikelyDateCalculation()){let e=this._rawJson,t="",r="",n="",i="plus";if(e.datetimeCalculations){let o=e.datetimeCalculations;t=o.fieldOneCalculation||"",r=o.fieldTwoCalculation||"",n=o.calculationUnits||"",i=o.calculationOperator||"plus"}if(e.field_one_calculation&&(t=e.field_one_calculation),e.field_two_calculation&&(r=e.field_two_calculation),e.calculation_units&&(n=e.calculation_units),e.calculation_operator&&(i=e.calculation_operator),t&&r){let e=i||"plus";return`date_calc( [${t}], [${r}], '${e}', '${n}')`}return null}let t=this._rawJson;if(t.numericCalculations&&Array.isArray(t.numericCalculations)){let e=[];for(let r of t.numericCalculations)"field"===r.type?e.push(`[${r.value}]`):"operator"===r.type?e.push(r.value):"number"===r.type&&e.push(r.value);return e.join(" ")}return this._rawJson.calculation&&""!==this._rawJson.calculation.trim()?this._rawJson.calculation:null}labelUserFriendly(){var e;return this._rawJson.label||(null===(e=this._rawJson)||void 0===e?void 0:e.section_heading)||this._rawJson.id||"_UNKNOWN_LABEL_"}getFieldType(){return this._rawJson.type||"_UNKNOWN_FIELD_TYPE_"}}t.FsModelField=i},8580:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.FsModelFieldV2025=void 0;let n=r(4295);class i extends n.AbstractFsModel{constructor(e,t){var r,n,i;super(),this._tableColumnProps=null,this._rawJson=e,this._parentSectionId=t,this._fieldId=(null===(r=e.id)||void 0===r?void 0:r.toString())||(null===(n=e.fieldId)||void 0===n?void 0:n.toString())||(null===(i=e.field)||void 0===i?void 0:i.toString())||""}get fieldId(){return this._fieldId}set visibilityLogicParent(e){this._visibilityLogicParent=e}get visibilityLogicParent(){return this._visibilityLogicParent}convertApiLogicToIStackBuddyLogicJunction(e){var t;if(!e)return null;let r="any"===e.conditional?"$or":"$and";return{action:(null===(t=e.action)||void 0===t?void 0:t.toLocaleLowerCase())==="show"?"show":"hide",conditional:r,checks:(e.fields||e.checks||[]).map(e=>{var t,r,n;if("string"==typeof e)return{fieldId:e,condition:"equals",option:"value1"};let i=(null===(t=e.id)||void 0===t?void 0:t.toString())||(null===(r=e.fieldId)||void 0===r?void 0:r.toString())||(null===(n=e.field)||void 0===n?void 0:n.toString())||"";return e.comparisonOperator?{fieldId:i,condition:this.convertOperator(e.comparisonOperator),option:e.value||""}:{fieldId:i,condition:e.condition||"equals",option:e.option||""}}),ownerFieldId:this.fieldId,fieldJson:this.getRawJson()}}convertOperator(e){switch(e){case"==":return"equals";case"!=":return"notequals";case"gt":return"greaterthan";case"lt":return"lessthan";default:return e}}get visibilityLogicOwn(){return this.convertApiLogicToIStackBuddyLogicJunction(this._rawJson.logic)}getRawJson(){return this._rawJson}getRawJsonItem(e){return this._rawJson[e]}getLogicOwn(){return this.convertApiLogicToIStackBuddyLogicJunction(this._rawJson.logic)}getSectionId(){return"FIELDS_WITHOUT_SECTIONS"===this._parentSectionId?null:this._parentSectionId}setTableColumnProperties(e){this._tableColumnProps={...e}}isLikelyDateCalculation(){if(this._rawJson.calculation&&""!==this._rawJson.calculation.trim())return!1;let e=this._rawJson;return!!e.datetimeCalculations||"date"===e.calculation_category||!!(e.field_one_calculation&&e.field_two_calculation)}getCalculationString(){var e;if("tablecell"===this.getFieldType())return(null===(e=this._tableColumnProps)||void 0===e?void 0:e.calculationString)||null;if(this.isLikelyDateCalculation()){let e=this._rawJson,t="",r="",n="",i="plus";if(e.datetimeCalculations){let o=e.datetimeCalculations;t=o.fieldOneCalculation||"",r=o.fieldTwoCalculation||"",n=o.calculationUnits||"",i=o.calculationOperator||"plus"}if(e.field_one_calculation&&(t=e.field_one_calculation),e.field_two_calculation&&(r=e.field_two_calculation),e.calculation_units&&(n=e.calculation_units),e.calculation_operator&&(i=e.calculation_operator),t&&r){let e=i||"plus";return`date_calc( [${t}], [${r}], '${e}', '${n}')`}return null}let t=this._rawJson;if(t.numericCalculations&&Array.isArray(t.numericCalculations)){let e=[];for(let r of t.numericCalculations)"field"===r.type?e.push(`[${r.value}]`):"operator"===r.type?e.push(r.value):"number"===r.type&&e.push(r.value);return e.join(" ")}return this._rawJson.calculation&&""!==this._rawJson.calculation.trim()?this._rawJson.calculation:null}labelUserFriendly(){var e;return this._rawJson.label||this._rawJson.labelKey||(null===(e=this._rawJson.id)||void 0===e?void 0:e.toString())||"_UNKNOWN_LABEL_"}getFieldType(){return this._rawJson.type||"_UNKNOWN_FIELD_TYPE_"}}t.FsModelFieldV2025=i},5211:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.FsModelForm=void 0;let n=r(4295),i=r(5051),o=r(8580);class s extends n.AbstractFsModel{constructor(e,t={fieldModelVersion:"v2"}){if(super(),this._fields={},this._fieldIdBySection={},this._fieldIdToSectionId={},!e||"object"!=typeof e||!Array.isArray(e.fields))throw Error("FsModelForm constructor requires an object with a fields array");this._rawJson=e,this._preinitializeSectionMappings(),e.fields.forEach(e=>{let r=e.fieldId||e.id;"185096820"==r&&console.log({debug:"field model created"});let n=this._fieldIdToSectionId[r]||"FIELDS_WITHOUT_SECTIONS";this._fields[r]="v2025"===t.fieldModelVersion?new o.FsModelFieldV2025(e,n):new i.FsModelField(e,n)}),Object.keys(this._fields).forEach(e=>{let t=this._fields[e].getSectionId();this._fields[t]?this._fields[e].visibilityLogicParent=this._fields[t].visibilityLogicOwn:this._fields[e].visibilityLogicParent=null}),Object.entries(this._fields).forEach(([e,t])=>{if("tablecell"===t.getFieldType()){let e=this._fields[t.getRawJsonItem("parent_tableheader_id")];t.setTableColumnProperties({calculationString:(null==e?void 0:e.getCalculationString())||""})}})}createFieldModel(e,t,r="v2"){return"v2025"===r?new o.FsModelFieldV2025(e,t):new i.FsModelField(e,t)}_preinitializeSectionMappings(){this._fieldIdBySection.FIELDS_WITHOUT_SECTIONS=[];let e=this._rawJson.fields.map(e=>{var t;return{id:(null===(t=e.fieldId||e.id)||void 0===t?void 0:t.toString())||"",sort:e.sort||e.displayOrder||0,type:e.type||""}}).filter(e=>""!==e.id).sort((e,t)=>e.sort-t.sort),t="FIELDS_WITHOUT_SECTIONS";for(let r of e)"section"===r.type?(t=r.id,this._fieldIdBySection[t]=[],this._fieldIdToSectionId[r.id]=null):(this._fieldIdBySection[t].push(r.id),this._fieldIdToSectionId[r.id]="FIELDS_WITHOUT_SECTIONS"===t?null:t)}getSubjectDictionary(){var e;let t={};for(let r of this._rawJson.fields){let n=(null===(e=r.fieldId||r.id)||void 0===e?void 0:e.toString())||"";if(!n)continue;let i=r.label||n,o=r.type||"text";t[n]={fieldId:n,label:i,fieldType:o}}return t}getRawJson(){return this._rawJson}getRawJsonItem(e){return this._rawJson[e]}getFieldModelById(e){let t=this._fields[e]||null;if(t&&!("fieldId"in t))throw Error(`Field ${e} exists but doesn't implement IFsModelField interface correctly`);return t}getFieldModelByIdOrThrow(e){let t=this.getFieldModelById(e);if(!t)throw Error(`Failed to find model for field with id: '${e}'.`);return t}getFieldIds(){return Object.keys(this._fields)}filterFieldIdsWithLogic(){return Object.keys(this._fields).filter(e=>{let t=this._fields[e],r=t.getLogicOwn(),n=t.visibilityLogicParent;return null!==r||null!==n})}getFieldIdsBySection(e){return this._fieldIdBySection[e]||[]}getSectionIds(e=!1){let t=Object.keys(this._fieldIdBySection).filter(e=>"FIELDS_WITHOUT_SECTIONS"!==e);return e?[...t,"FIELDS_WITHOUT_SECTIONS"]:t}getFieldSection(e){let t=this._fieldIdToSectionId[e];return void 0===t?null:"FIELDS_WITHOUT_SECTIONS"===t?null:t}get formId(){var e,t;return(null===(e=this._rawJson.id)||void 0===e?void 0:e.toString())||(null===(t=this._rawJson.formId)||void 0===t?void 0:t.toString())||""}get hasApprovers(){return!!(this._rawJson.hasApprovers||this._rawJson.has_approvers)}get isEncrypted(){return!!(this._rawJson.isEncrypted||this._rawJson.encrypted||this._rawJson.is_encrypted)}get isOnePageAtTime(){return!!(this._rawJson.isOnePageAtTime||this._rawJson.one_page_at_time||this._rawJson.is_one_page_at_time)}get isAuthProtected(){return!!(this._rawJson.isAuthProtected||this._rawJson.auth_protected||this._rawJson.is_auth_protected)}get authType(){let e=this._rawJson.authType||this._rawJson.auth_type;return"sso"===e||"password"===e?e:void 0}get isWorkflow(){return!!(this._rawJson.isWorkflow||this._rawJson.workflow||this._rawJson.is_workflow)}static isInstance(e){return e instanceof s}}t.FsModelForm=s},9386:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.FsModelForm=t.FsModelFieldV2025=t.FsModelField=void 0;var n=r(5051);Object.defineProperty(t,"FsModelField",{enumerable:!0,get:function(){return n.FsModelField}});var i=r(8580);Object.defineProperty(t,"FsModelFieldV2025",{enumerable:!0,get:function(){return i.FsModelFieldV2025}});var o=r(5211);Object.defineProperty(t,"FsModelForm",{enumerable:!0,get:function(){return o.FsModelForm}})},8506:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GenericPojoToGraphNodes=void 0;let n=r(7975);t.GenericPojoToGraphNodes=e=>{let t=JSON.parse(JSON.stringify(e)),r=n.pojoUtilities.parseUniquePojoRootKeyOrThrow(t),i=t[r],o=(e,r)=>{let i=n.pojoUtilities.extractChildrenNodes(e,t),s=Object.keys(i);return 0===s.length?{name:e,nodeContent:r}:{name:e,nodeContent:r,children:s.map(e=>{let t=i[e];return o(e,t.nodeContent)})}};return o(r,i.nodeContent)}},5562:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.GenericPojoToGraphNodes=void 0;var n=r(8506);Object.defineProperty(t,"GenericPojoToGraphNodes",{enumerable:!0,get:function(){return n.GenericPojoToGraphNodes}})},1631:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.testExports=t.FsCalculationGraphDeep=void 0;let n=r(5211),i=r(97),o=r(7975),s=r(5845),a=e=>e?e.replace("[","").replace("]",""):e;class l extends s.AbstractFsTreeGeneric{constructor(){super(...arguments),this._dependantFieldIds=[],this._dependantNodeFieldIds=[]}circularReferenceFound(e,t){if(!e)throw Error("fieldId is undefined in circularReferenceFound");return this.getDependencyChainOf(t).filter(t=>t.directOwnerFieldId===e).length>0}appendShallowTreeAt(e,t,r){if(!t||!t.rootNodeId)throw Error(JSON.stringify({reason:"Attempted to add non-shallow tree (falsy value)",shallowTree:t,nodeId:e}));if(this.isRoot(e)&&!this._rootFieldId&&(this._rootFieldId=t.rootFieldId,1===t.countTotalNodes())){this.replaceNodeContent(e,{directOwnerFieldId:this._rootFieldId,...t.getChildContentAt(t.rootNodeId)});return}this._appendShallowTreeRecursively(e,t,t.rootNodeId,r)}_appendShallowTreeRecursively(e,t,r,n){let i=t.getChildContentAt(r);if(i.directOwnerFieldId=t.rootFieldId,t.isLeaf(r)){this.appendChildNodeWithContent(e,i),this._dependantNodeFieldIds.push({nodeId:e,fieldId:i.directOwnerFieldId});return}if(!t.isBranch(r))throw Error(JSON.stringify({message:"Attempted to append shallow tree at a node that is neither a branch or a leaf",sourceNodeId:r,targetNodeId:e}));let o=null;this.isRoot(e)&&t.isRoot(r)&&t.rootFieldId===this._rootFieldId?(this.replaceNodeContent(e,i),o=e,this._dependantNodeFieldIds.push({nodeId:e,fieldId:i.directOwnerFieldId})):o=this.appendChildNodeWithContent(e,i),t.getChildrenNodeIdsOf(r).forEach(e=>{let r=t.getChildContentAt(e);r&&(r.directOwnerFieldId=t.rootFieldId),this._appendLeafFromShallowTree(o,e,t,n)})}_appendLeafFromShallowTree(e,t,r,n){let o=r.getChildContentAt(t);if(r.isBranch(t)){let i=this.appendChildNodeWithContent(e,o);r.getChildrenNodeIdsOf(t).forEach(e=>{this._appendLeafFromShallowTree(i,e,r,n)});return}let{operandType:s,isError:l}=o;if(l){let t=o.errorType||"ErrorTypeUnknown",n={directOwnerFieldId:r.rootFieldId,isError:!0,errorType:t,calcError:{calcString:(null==o?void 0:o.calcString)||"",dependencyChainFieldIds:this.getDependencyChainOf(e),message:`Shallow Tree Error of type: '${t};, JSON: ${JSON.stringify(o)}`}};this.appendChildNodeWithContent(e,n);return}if("constant"===s){let t={directOwnerFieldId:r.rootFieldId,operandValue:o.operandValue,operandType:s};this.appendChildNodeWithContent(e,t);return}if(["subject-value","reference"].includes(s)){let t=a(o.operandValue);if(!t)throw Error("Unexpected missing field id"+JSON.stringify(o));if(this.circularReferenceFound(t,e)){let n={directOwnerFieldId:t,isError:!0,errorType:"circular",calcError:{dependencyChainFieldIds:this.getDependencyChainOf(e),message:`Circular reference detected. This subject's value is defined using the subject's own value. 
            This field id: '${t}', attempted to expression from field: '${r.rootFieldId}'`}};this.appendChildNodeWithContent(e,n);return}let s=n.getFieldModelById(t),l=(null==s?void 0:s.getCalculationString())||"",u=i.FsCalculationGraphShallow.fromCalcStringJson(t,l,t);u?this.appendShallowTreeAt(e,u,n):this.appendChildNodeWithContent(e,{directOwnerFieldId:t,operandType:"reference",operandValue:t});return}throw Error("Unexpected operandType: "+JSON.stringify({operandType:s,nodeContent:o}))}getDependencyChainOf(e,t=[]){if(this.isRoot(e))return this.getChildContentAt(this.rootNodeId),t.push({directOwnerFieldId:this._rootFieldId,nodeId:this.rootNodeId}),t;let r=this.getChildContentAt(e);t.push({directOwnerFieldId:r.directOwnerFieldId,nodeId:e});let n=this.getParentNodeId(e);return this.getDependencyChainOf(n,t)}createSubtreeAt(e){return new l}getDependantFieldAndNodeIds(){return structuredClone(this._dependantNodeFieldIds)}getDependantFieldIds(){return this.getDependantFieldAndNodeIds().map(({fieldId:e,nodeId:t})=>e)}isCircularNode(e){let t=this.getChildContentAt(e);return(null==t?void 0:t.errorType)==="circular"}isHasErrorNodes(){return this.getDescendantContentOf(this.rootNodeId).concat([this.getChildContentAt(this.rootNodeId)]).some(e=>e.isError)}cloneAt(e){return l.fromPojo(this.toPojoAt(e||this.rootNodeId))}static fromPojo(e,t){let r=o.GenericDirectedGraph.fromPojo(e,t),n=new l("_MISSING_ROOT_FILED_ID");return n._incrementor=r._incrementor,n._rootNodeId=r._rootNodeId,n._nodeDictionary=r._nodeDictionary,n}getUnresolvedFieldReferences(){let e={};return this.visitLeavesOf({visit:(t,r)=>{"reference"===r.operandType&&(e[r.operandValue]={nodeId:t,fieldId:r.operandValue})},includeSubtrees:!1},this.rootNodeId),Object.keys(e)}get rootFieldId(){return this._rootFieldId}toJavascriptDateCalculation(e){var t,r;let n=this.getChildContentAt(e);if("date_calc"===n.operator){let i=this.getChildrenContentOf(e),o=i[0],s=i[1];return`is_buddy_calculations( $submissionRecord["${o.operandValue}"], $submissionRecord["${s.operandValue}"], '${null===(t=n.dateCalcDetails)||void 0===t?void 0:t.plusMinus}', '${null===(r=n.dateCalcDetails)||void 0===r?void 0:r.calculationUnits}' )`}return""}toJavascriptCalcString(e=this.rootNodeId,t={}){let r=this.getChildContentAt(e);if(!r)return"";if(this.isLeaf(e))return"reference"===r.operandType&&t[r.operandValue]||r.operandValue;if(this.isBranch(e)){let n=r.operator;if("date_calc"===n)return this.toJavascriptDateCalculation(e);let i=this.getChildrenNodeIdsOf(e).map(e=>this.toJavascriptCalcString(e,t));return`( ${i.join(` ${n} `)} )`}return""}getCircularNodeIds(){return this.getAllNodeIds().filter(e=>this.isCircularNode(e))}getAllNodeIds(){return[this.rootNodeId].concat(this.getDescendantNodeIds(this.rootNodeId))}getFieldIdsOfAllContributingFields(){let e={};return this.visitAllAt({visit:(t,r)=>{(null==r?void 0:r.directOwnerFieldId)&&(e[r.directOwnerFieldId]=!0)},includeSubtrees:!1},this.rootNodeId),Object.keys(e)}static fromCalcString(e,t){let r=new l,o=i.FsCalculationGraphShallow.fromCalcStringJson(e,t,e);return o&&r.appendShallowTreeAt(r.rootNodeId,o,new n.FsModelForm({fields:[]})),r}static fromFormModel(e,t){let r=new l,n=i.FsCalculationGraphShallow.fromCalcStringJson(e,t.getFieldModelByIdOrThrow(e).getCalculationString()||"",e);return n&&r.appendShallowTreeAt(r.rootNodeId,n,t),r}}t.FsCalculationGraphDeep=l,t.testExports={fieldRefToFieldId:a}},97:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.FsCalculationGraphShallow=void 0;let n=r(7975),i=r(5845),o=r(9259),s=r(2391),a=e=>/^\[\d+\]$/.test(e);class l extends i.AbstractFsTreeGeneric{constructor(e,t="calc-shallow"){super(t),this._stringParseCallstack={callFrames:[]},this._rootFieldId=e}get rootFieldId(){return this._rootFieldId}getStringParseCallstack(){return this._stringParseCallstack}getDependantFieldIds(){let e=[];return this.visitLeavesOf({visit:t=>{let r=this.getChildContentAt(t);return(null==r?void 0:r.operandType)==="reference"&&e.push(r.operandValue),null},includeSubtrees:!1},this.rootNodeId),e}getErrorNodes(){return this.getDescendantContentOf(this.rootNodeId).concat(this.getChildContentAt(this.rootNodeId)).filter(e=>null==e?void 0:e.isError)}appendOrReplace(e,t){return this.isRoot(e)&&null===this.getChildContentAt(this.rootNodeId)?(this.replaceNodeContent(e,t),e):this.appendChildNodeWithContent(e,t)}appendNodeRecursively(e,t){var r,n,i,l,u,c,d;let h=(0,o.normalizedExpressionTerms)(t);switch(this._stringParseCallstack.callFrames.push({value:t,parentNodeId:e,expressionTerms:h}),h.resultType){case s.ENormalizedExpressionResultType.TERM:{let r;if(h.term==`[${this.rootFieldId}]`){let n=this._stringParseCallstack.callFrames.map(e=>e.expressionTerms.result);r={directOwnerFieldId:this.rootFieldId,isError:!0,errorType:"circular",calcError:{calcPart:t,dependencyChainFieldIds:[{nodeId:e,directOwnerFieldId:this.rootFieldId}],stringParseCallstack:this._stringParseCallstack,message:`This subject's value is defined using the subject's own value (V := V+0).  
                This field id: '${this.rootFieldId}', is defined using term: '${h.term}'.
                The field refers to itself in its calculations definition.`,calcString:t,operandValue:"",operandType:"error",directOwnerFieldId:this.rootFieldId,calculationDecompositionStack:n}}}else r={directOwnerFieldId:this.rootFieldId,calcPart:t,operandValue:h.term||null,operandType:a(h.term||"")?"reference":"constant"};this.appendOrReplace(e,r);return}case s.ENormalizedExpressionResultType.EXPRESSION:{let o={directOwnerFieldId:this.rootFieldId,operator:null===(r=null==h?void 0:h.result)||void 0===r?void 0:r.operator,calcPart:t};(null===(n=null==h?void 0:h.result)||void 0===n?void 0:n.operator)==="date_calc"&&(o.dateCalcDetails={...null===(i=null==h?void 0:h.result)||void 0===i?void 0:i.dateCalcDetails});let s=this.appendOrReplace(e,o);this.appendNodeRecursively(s,null===(l=null==h?void 0:h.result)||void 0===l?void 0:l.lho),this.appendNodeRecursively(s,null===(u=null==h?void 0:h.result)||void 0===u?void 0:u.rho);return}case s.ENormalizedExpressionResultType.ERROR:{let t=this._stringParseCallstack.callFrames.map(e=>e.expressionTerms.result);this.appendOrReplace(e,{directOwnerFieldId:this.rootFieldId,isError:!0,errorType:"malformed-expression",calcError:{message:(null===(c=h.calcError)||void 0===c?void 0:c.message)||"Unknown error",calcString:(null===(d=h.calcError)||void 0===d?void 0:d.calcString)||"",calculationDecompositionStack:t},calculationDecompositionStack:t,meta:{isLeaf:!0,expressionNormalizeResult:h.result,decompositionStackRaws:this._stringParseCallstack.callFrames}});return}default:throw Error(`Invalid value for tree construction: ${t}`)}}static fromFieldJson(e){return l.fromCalcStringJson(e.id+""||"_MISSING_FIELD_ID_",null==e?void 0:e.calculation)}static fromCalcStringJsonOrThrow(e,t,r="calc-shallow"){let n=l.fromCalcStringJson(e,t,r);if(!n)throw Error(`Failed to create tree from calcString '${t}'`);return n}static fromCalcStringJson(e,t,r="calc-shallow"){if(!t)return null;let n=new l(e,r);return n.appendNodeRecursively(n.rootNodeId,t),n}static fromPojo(e,t){let r=n.AbstractDirectedGraph.fromPojo(e,t),i=new l("_MISSING_ROOT_FILED_ID","shallow:from:pojo");return i._incrementor=r._incrementor,i._rootNodeId=r._rootNodeId,i._nodeDictionary=r._nodeDictionary,i}}t.FsCalculationGraphShallow=l},9259:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isFieldReference=void 0,t.parseExpressionTermsFromCalcString=s,t.normalizedExpressionTerms=function(e,t=i){let r=s(e);return null===r?{resultType:n.ENormalizedExpressionResultType.TERM,term:null}:"object"==typeof r&&null!==r.lho&&null!==r.rho&&r.operator?{resultType:n.ENormalizedExpressionResultType.EXPRESSION,result:r}:"object"==typeof r&&r.operator&&(null===r.lho||null!==r.rho)?{resultType:n.ENormalizedExpressionResultType.ERROR,result:r,calcError:{message:"Missing Left-Hand Operand",calcString:e}}:"object"==typeof r&&r.operator&&(null!==r.lho||null===r.rho)?{resultType:n.ENormalizedExpressionResultType.ERROR,result:r,calcError:{message:"Missing Right-Hand Operand",calcString:e}}:"object"==typeof r&&r.operator&&(null===r.lho||null===r.rho)?{resultType:n.ENormalizedExpressionResultType.ERROR,result:r,calcError:{message:"Missing one or more operands",calcString:e}}:"string"==typeof r?e.includes(r)&&r!==e?{resultType:n.ENormalizedExpressionResultType.ERROR,result:{lho:null,rho:null,operator:null},calcError:{message:"Failed to parse expression: Missing operator",calcString:e}}:t(r)?{resultType:n.ENormalizedExpressionResultType.TERM,term:r}:{resultType:n.ENormalizedExpressionResultType.ERROR,result:{lho:null,rho:null,operator:null},calcError:{message:"Failed to parse expression: Missing operator",calcString:e}}:{resultType:n.ENormalizedExpressionResultType.ERROR,calcError:{message:"Unexpected result type",calcString:e}}};let n=r(2391),i=e=>{let t=/^\[\d+\]$/.test(e),r=/^-?\d*\.?\d+$/.test(e);return t||r},o=e=>"string"==typeof e;function s(e){if(!e||!o(e))return null;let t=e.trim();if(""===t)return null;if(t.startsWith("date_calc(")){let e=t.match(/date_calc\(\s*\[(\d+)\],\s*\[(\d+)\],\s*'(\w+)',\s*'(\w+)'\)/);if(e){let[t,r,n,i,o]=e;return{lho:`[${r}]`,rho:`[${n}]`,operator:"date_calc",dateCalcDetails:{plusMinus:i,calculationUnits:o}}}}let r=t;for(;r.startsWith("(")&&r.endsWith(")");)r=r.slice(1,-1).trim();let n=-1,i=0;for(let e=r.length-1;e>=0;e--){let t=r[e];if(")"===t&&i++,"("===t&&i--,0===i&&("+"===t||"-"===t)){n=e;break}}if(-1===n){i=0;for(let e=r.length-1;e>=0;e--){let t=r[e];if(")"===t&&i++,"("===t&&i--,0===i&&("*"===t||"/"===t)){n=e;break}}}if(-1!==n){let e=r[n],t=r.slice(0,n).trim(),i=r.slice(n+1).trim();return i.startsWith("(")&&i.endsWith(")")?{lho:t||null,rho:i,operator:e}:{lho:t||null,rho:i||null,operator:e}}return r}t.isFieldReference=e=>/^\[\d+\]$/.test(e)},2104:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(1631),t),i(r(97),t),i(r(4283),t),i(r(2391),t)},4283:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.toJavascriptCalculationFunction=t.toJavascriptCalculateFunctionBody=void 0,t.toJavascriptCalculationFunction=e=>Function("$submissionRecord",r(e,e.rootNodeId,{183969732:"$submissionRecord['183969732']"}));let r=(e,t=e.rootNodeId,r={})=>{let n=e.toJavascriptCalcString(t,r),i=[...new Set(e.getDependantFieldIds())].map(e=>`//	${e}`);return`
    const  is_buddy_calculations  = (...args)=>{
       console.log({ is_buddy_calculations:JSON.stringify(args), message: 'is_buddy_date_logic is a stubbed function for test purposes only'});
       return 0; // stubbed return value  we can not rely on dates for calculations at this time.
    }

    // calculation for field: ${e.rootFieldId}
    // dependant fieldIds:
    ${i.join("\n")}

    return ${n};
    `};t.toJavascriptCalculateFunctionBody=r},2391:function(e,t){var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.ENormalizedExpressionResultType=void 0,(n=r||(t.ENormalizedExpressionResultType=r={})).TERM="term",n.ERROR="error",n.EXPRESSION="expression"},7175:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.transformToCircularCalculationSystems=t.transformToCalculationSystems=t.decorateLogicSystems=t.transformToLogicSystems=void 0;var n=r(4206);Object.defineProperty(t,"transformToLogicSystems",{enumerable:!0,get:function(){return n.transformToLogicSystems}}),Object.defineProperty(t,"decorateLogicSystems",{enumerable:!0,get:function(){return n.decorateLogicSystems}});var i=r(1816);Object.defineProperty(t,"transformToCalculationSystems",{enumerable:!0,get:function(){return i.transformToCalculationSystems}}),Object.defineProperty(t,"transformToCircularCalculationSystems",{enumerable:!0,get:function(){return i.transformToCircularCalculationSystems}})},1816:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.transformToCircularCalculationSystems=t.transformToCalculationSystems=void 0;let n=r(1631),i=(e,t,r=!0)=>{let i=n.FsCalculationGraphDeep.fromFormModel(e,t);if(r&&0===i.getCircularNodeIds().length)return[];if(!r)return i.getFieldIdsOfAllContributingFields().filter(e=>e&&e.trim());let o=new Set,s=new Set(i.getFieldIdsOfAllContributingFields()),a=e=>{if(o.has(e))return;let r=n.FsCalculationGraphDeep.fromFormModel(e,t);r.getCircularNodeIds().length>0&&(o.add(e),r.getFieldIdsOfAllContributingFields().forEach(e=>{e&&e.trim()&&(s.add(e),a(e))}))};return a(e),Array.from(s).filter(e=>e&&e.trim()).forEach(a),Array.from(o)},o=(e,t={filterCircularRefOnly:!0})=>{let{filterCircularRefOnly:r=!0}=t,n={},o=new Set;return e.getFieldIds().forEach(t=>{if(o.has(t))return;let s=i(t,e,r).filter(e=>e&&e.trim());s.length>0&&!Object.values(n).some(e=>s.some(t=>e.includes(t)))&&(n[t]=s,s.forEach(e=>o.add(e)))}),Object.entries(n).reduce((t,[r,n])=>{let i=n.map(t=>{let r=e.getFieldModelById(t);return{fieldId:t,label:(null==r?void 0:r.labelUserFriendly())||"",sort:(null==r?void 0:r.displayOrder)||0}}).sort((e,t)=>e.sort-t.sort);return t[r]=i,t},{})};t.transformToCalculationSystems=o,t.transformToCircularCalculationSystems=o},4206:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.transformToLogicSystems=t.decorateLogicSystems=void 0;let n=r(4982);t.decorateLogicSystems=(e,t)=>{let r={};return Object.entries(e).forEach(([e,i])=>{let o=n.FsFieldVisibilityGraph.fromFormModel(e,t);r[e]={participatingFieldIds:[],isHasErrors:o.getAllErrorNodes().length>0,allErrorNodes:[]},r[e].participatingFieldIds=i.participatingFieldIds.map(e=>{var r,i;return{fieldId:e,errorNodes:n.FsFieldVisibilityGraph.fromFormModel(e,t).getAllErrorNodes(),label:(null===(r=t.getFieldModelById(e))||void 0===r?void 0:r.labelUserFriendly())||"",sort:(null===(i=t.getFieldModelById(e))||void 0===i?void 0:i.displayOrder)||0}}).sort((e,t)=>e.sort-t.sort),i.participatingFieldIds.forEach(i=>{r[e].allErrorNodes.push(...n.FsFieldVisibilityGraph.fromFormModel(i,t).getAllErrorNodes())})}),r},t.transformToLogicSystems=e=>{let t={},r=e.getFieldIds().reduce((e,t)=>(t&&(e[t]={fieldId:t}),e),{}),o=e.getFieldIds().reduce((e,t)=>(t&&(e[t]={fieldId:t,isAlreadyVisited:!1}),e),{});for(let s in r){if(!o[s])continue;delete o[s];let r=n.FsFieldVisibilityGraph.fromFormModel(s,e);if(r.isEmptyTree())continue;let a=r.getFieldIdsOfAllContributingFields();0!==a.length&&(a.forEach(e=>{delete o[e]}),i(t,{fieldId:s,participatingFields:a}))}return t};let i=(e,t)=>{0!==t.participatingFields.length&&(o(s(e),t.participatingFields)?Object.entries(e).forEach(([r,n])=>{if(o(n.participatingFieldIds,t.participatingFields)){let i=[...new Set([...n.participatingFieldIds,...t.participatingFields])];t.participatingFields.length>n.participatingFieldIds.length?(e[t.fieldId]={participatingFieldIds:i},delete e[r]):e[r]={participatingFieldIds:i}}}):e[t.fieldId]={participatingFieldIds:t.participatingFields})},o=(e,t)=>e.some(e=>t.includes(e)),s=e=>Object.values(e).flatMap(e=>e.participatingFieldIds)},4982:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isFieldReference=t.FsFieldVisibilityGraph=void 0;let n=r(7975);t.isFieldReference=e=>/^\[\d+\]$/.test(e);let i={$and:"&&",$or:"||"},o=e=>{switch(e){case"equals":return"==";case"notequals":return"!=";case"greaterthan":return">";case"lessthan":return"<";default:return e}},s=r(5845),a=(e,t)=>!(e in t);class l extends s.AbstractFsTreeGeneric{constructor(e,t){super(e,t),this._contributingFieldIds=[],this.JUNCTION_OPERATORS=["$and","$or","any","all"],this._ownBranchNodeId=null,this._parentFieldId=null,this._parentSectionBranchNodeId=null,this._rootFieldId=null}static fromFormModel(e,t,r){let n=new l(r,{virtualRoot:!0,directOwnerFieldId:e});n._rootFieldId=e,n._contributingFieldIds.push(e);let i=t.getFieldModelByIdOrThrow(n._rootFieldId);n._parentFieldId=i.getSectionId();let o=i.visibilityLogicOwn,s=i.visibilityLogicParent;if(o){let{action:r,checks:i,conditional:s}=o,a=["any","$and"].includes(s)?"$and":"$or",l=n.appendChildNodeWithContent(n.rootNodeId,{operator:a,directOwnerFieldId:e,isOwnBranch:!0});n.appendChecks(l,i,t),(i||[]).forEach(e=>{n.processAndAddFieldAtRecursively(l,e.fieldId,t)})}if(s){let{action:r,checks:i,conditional:o}=s,a=["any","$and"].includes(o)?"$and":"$or",l=n.appendChildNodeWithContent(n.rootNodeId,{operator:a,directOwnerFieldId:e,isParentBranch:!0});n.appendChecks(l,i,t),(i||[]).forEach(e=>{n.processAndAddFieldAtRecursively(l,e.fieldId,t)})}return n}appendChildNodeWithContent(e,t){let r=super.appendChildNodeWithContent(e,t);return t&&"operator"in t&&this.JUNCTION_OPERATORS.includes(t.operator)&&this._contributingFieldIds.push(t.directOwnerFieldId),r}processAndAddFieldAtRecursively(e,t,r){let n=r.getFieldModelByIdOrThrow(t),i=n.visibilityLogicOwn,o=n.visibilityLogicParent;if(i||o){if(this._contributingFieldIds.includes(t)){this.appendCircularNode(e,t,r);return}if(i){let n=["any","$and"].includes(null==i?void 0:i.conditional)?"$and":"$or",o=this.appendChildNodeWithContent(e,{operator:n,directOwnerFieldId:t,isOwnBranch:!0});((null==i?void 0:i.checks)||[]).forEach(e=>{this.appendChildNodeWithContent(o,{directOwnerFieldId:t,operator:e.condition,subjectId:e.fieldId,value:e.option}),this.processAndAddFieldAtRecursively(o,e.fieldId,r)})}if(o){let n=["any","$and"].includes(null==o?void 0:o.conditional)?"$and":"$or",i=this.appendChildNodeWithContent(e,{operator:n,directOwnerFieldId:t,isParentBranch:!0});((null==o?void 0:o.checks)||[]).forEach(e=>{this.appendChildNodeWithContent(i,{directOwnerFieldId:t,operator:e.condition,subjectId:e.fieldId,value:e.option}),this.processAndAddFieldAtRecursively(i,e.fieldId,r)})}}}appendChecks(e,t,r){t.forEach(t=>{if(null===r.getFieldModelById(t.fieldId))throw Error(`No Field model found for fieldId: '${null==t?void 0:t.fieldId}'.`);let{fieldId:n,condition:i,option:o}=t;this.appendChildNodeWithContent(e,{operator:i,subjectId:n+"",value:o,directOwnerFieldId:n+""})})}isEmptyTree(){let e=Object.keys(this._nodeDictionary);if(e.length>1||0===e.length)return!1;let t=this.getChildContentAt(this.rootNodeId);return null===t||"virtualRoot"in t&&!0===t.virtualRoot}getParentSectionBranchId(){return this._parentSectionBranchNodeId}getOwnBranchId(){return this._ownBranchNodeId}getPathToRootRecursive(e,t=[]){let r=this.getChildContentAt(e);if(t.unshift({...r,nodeId:e}),e===this.rootNodeId)return t;{let r=this.getParentNodeId(e);return this.getPathToRootRecursive(r,t)}}getDependantFieldIds(){let e=[];return this.visitLeavesOf({visit:t=>{let r=this.getChildContentAt(t);r.subjectId&&e.push(r.subjectId)},includeSubtrees:!1},this.rootNodeId),e}getFieldIdsOfAllContributingFields(){let e=this,t={};return this.visitAllAt({visit:(r,n,i)=>{!e.isRoot(r)&&n&&n.directOwnerFieldId&&(a("directOwnerFieldId",t)&&(t[n.directOwnerFieldId]=[]),t[n.directOwnerFieldId].push(n.directOwnerFieldId))},includeSubtrees:!1},this.rootNodeId),Object.keys(t).filter(e=>e&&"undefined"!==e)}appendCircularNode(e,t,r){let n=this.getChildContentAt(e),i=this.getPathToRootRecursive(e),o=this.getUserFriendlyLabel(n.directOwnerFieldId,r),s=n.isParentBranch?"inherited from parent logic":"own logic",a=`
     Field '${o.substring(0,25)}...' (${n.directOwnerFieldId}) is attempting to  add logic branch which would create circular reference to itself (it's logic includes a check for ${t}).

    The logic condition is '${s}'.

    Path to root (dependency chain): ${JSON.stringify(i,null,2)}. 
    `,l=i.map(({directOwnerFieldId:e,nodeId:t})=>({directOwnerFieldId:e,nodeId:t}));this.appendChildNodeWithContent(e,{isError:!0,errorType:"circular",logicError:{message:a,existingCheckFieldId:t,logicExpressionString:JSON.stringify({violatingShallowLogic:null}),dependencyChainFieldIds:l}})}getParentFieldId(){return this._parentFieldId}getUserFriendlyLabel(e,t){return t.getFieldModelByIdOrThrow(e).labelUserFriendly()}isCircular(e){let t=this.getChildContentAt(e);return null!==t&&!((null==t?void 0:t.errorType)!="circular")}getAllNodeIds(){return[this.rootNodeId].concat(this.getDescendantNodeIds(this.rootNodeId))}getCircularNodeIds(){return this.getAllNodeIds().filter(e=>this.isCircular(e))}cloneAt(e){return l.fromPojo(this.toPojoAt(e||this.rootNodeId))}toJavascriptMatcherBodyString(e=this.rootNodeId,t={}){let r=this.getChildContentAt(e);if(!r)return"";if(this.isLeaf(e)){let e="",t=o(r.operator);switch(r.operator){case"dateIsEqual":case"dateIsNotEqual":case"dateAfter":case"dateBefore":case"dateIsBetween":case"dateIsNotBetween":case"dateIsWithin":case"dateIsNotWithin":e=`is_buddy_date_logic($submissionRecord['${r.subjectId}'], '${r.operator}', '${r.value}')`;break;case"equals":case"notequals":case"greaterthan":case"lessthan":e=`$submissionRecord['${r.subjectId}'] ${t} '${r.value}'`;break;case"equals":case"notequals":e=`$submissionRecord['${r.subjectId}'] ${o(r.operator)} '${r.value}'`;break;default:e=`${r.subjectId} ${t} ${r.value}`}return`(${e})`}if(this.isBranch(e)){let n=i[r.operator],o=this.getChildrenNodeIdsOf(e).map(e=>this.toJavascriptMatcherBodyString(e,t));return`( ${o.join(` ${n} `)} )`}return""}static fromPojo(e,t){let r=n.GenericDirectedGraph.fromPojo(e,t),i=new l(r.rootNodeId);return i._incrementor=r._incrementor,i._rootNodeId=r._rootNodeId,i._nodeDictionary=r._nodeDictionary,i}}t.FsFieldVisibilityGraph=l},8133:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.toJavascriptMatcherFunction=t.toD3HierarchyGraphNodes=t.FsFieldVisibilityGraph=void 0;var n=r(4982);Object.defineProperty(t,"FsFieldVisibilityGraph",{enumerable:!0,get:function(){return n.FsFieldVisibilityGraph}});var i=r(5990);Object.defineProperty(t,"toD3HierarchyGraphNodes",{enumerable:!0,get:function(){return i.toD3HierarchyGraphNodes}});var o=r(9987);Object.defineProperty(t,"toJavascriptMatcherFunction",{enumerable:!0,get:function(){return o.toJavascriptMatcherFunction}})},5990:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.toD3HierarchyGraphNodes=void 0;let r=(e,t)=>{let r=e.getChildContentAt(t);return null!==r&&!!r.isCircularNode};t.toD3HierarchyGraphNodes=(e,t)=>{e.toPojoAt(t);let n=e.cloneAt(e.rootNodeId);class i{constructor(){this.includeSubtrees=!0}visit(e,t,i){if(null!==t&&r(n,e)){let r=n.getChildContentAt(i);null===r&&(r={}),"hasCircularReferencesAt"in r||(r.hasCircularReferencesAt=[]),r.hasCircularReferencesAt.push({message:"This node attempts to add logic condition ..., which is already in the dependency chain",circularReferenceNode:{nodeId:e,nodeContent:t}}),n.replaceNodeContent(i,r),n.removeNodeAt(e)}}}let o=new i;return n.visitAllAt(o,n.rootNodeId),n.toPojoAt()}},9987:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.toJavascriptMatcherFunction=void 0,t.toJavascriptMatcherFunction=e=>Function("$submissionRecord",r(e,e.rootNodeId,{183969732:"$submissionRecord['183969732']"}));let r=(e,t=e.rootNodeId,r={})=>{let n=e.toJavascriptMatcherBodyString(),i=[...new Set(e.getDependantFieldIds())].map(e=>`//	${e}`),o=e.getChildContentAt(e.rootNodeId).directOwnerFieldId;return`


    // visibility logic for field: ${o}
    // dependant fieldIds:
    ${i.join("\n")}

    const is_buddy_date_logic  = (...args)=>{
       console.log({ is_buddy_date_logic:JSON.stringify(args), message: 'is_buddy_date_logic is a stubbed function for test purposes only'})
    }



    return ${n};
    `}},8753:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractObservationMaker=void 0;let n=r(4585);class i{constructor(){this.childMakers=[],this.logItems=[]}getObservationMakerClassName(){return this.constructor.observationMakerClassName||this.constructor.name}getObservationClassName(){return this.observationClassName}getAllLogItems(){return this.logItems}filterBy(e){return this.logItems.filter(t=>(!e.subjectId||t.subjectId===e.subjectId)&&(!e.logLevel||t.logLevel===e.logLevel)&&(!e.subjectType||t.subjectType===e.subjectType)&&(!e.observationClassName||t.observationClassName===e.observationClassName)&&(!e.parentObserver||t.parentObserver===e.parentObserver)&&(!e.message||!!t.message.includes(e.message))&&(!e.messageSecondary||!!t.messageSecondary.includes(e.messageSecondary)))}filterByLogLevel(e){return this.logItems.filter(t=>t.logLevel===e)}getUniquePrimaryMessages(){return Array.from(new Set(this.logItems.map(e=>e.message)))}getCountBy(e){return this.filterBy(e).length}getLogItems(){return[...this.logItems]}clearLogItems(){this.logItems=[]}addChildMaker(e){this.childMakers.push(e)}async makeChildObservations(e){let t=[],r={...e,parentObserver:this.getObservationMakerClassName()};for(let e of this.childMakers){let n=await e.makeObservation(r);t.push(...n.logItems)}return t}createDebugLogItem(e,t){return this._createLogItem(e,{...t,logLevel:n.ELogLevel.DEBUG})}createInfoLogItem(e,t){return this._createLogItem(e,{...t,logLevel:n.ELogLevel.INFO})}createWarnLogItem(e,t){return this._createLogItem(e,{...t,logLevel:n.ELogLevel.WARN})}createErrorLogItem(e,t){return this._createLogItem(e,{...t,logLevel:n.ELogLevel.ERROR})}createDetailedLogMessage(e,t){return this._createLogItem(e,{subjectId:t.subjectId,logLevel:t.logLevel,subjectType:t.subjectType,observationClassName:t.observationClassName,messageSecondary:t.messageSecondary,relatedEntityIds:t.relatedEntityIds,additionalDetails:t.additionalDetails})}_createLogItem(e,t){let r={subjectId:t.subjectId,logLevel:t.logLevel,subjectType:t.subjectType||this.subjectType,observationClassName:t.observationClassName||this.observationClassName,message:this.messagePrimary,messageSecondary:t.messageSecondary,relatedEntityIds:t.relatedEntityIds||[],parentObserver:null==e?void 0:e.parentObserver,additionalDetails:t.additionalDetails};return this.logItems.push(r),r}}t.AbstractObservationMaker=i,i.observationMakerClassName="AbstractObservationMaker"},9638:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.CompositeFormCalculationObservationMaker=void 0;let n=r(7175),i=r(8753),o=r(3200),s=r(1546),a=r(4585);class l extends i.AbstractObservationMaker{constructor(){super(),this.messagePrimary="Form Calculation and Logic Analysis",this.subjectType=a.EObservationSubjectType.FORM,this.observationClassName=a.EObservationClass.CompositeFormCalculationObservationMaker,this.fieldCalculationMaker=new o.FieldCalculationObservationMaker,this.fieldLogicMaker=new s.FieldLogicObservationMaker}getRequiredResources(){return[a.EObservationResource.FORM_MODEL,a.EObservationResource.LOGIC_SYSTEM]}async makeObservation(e){let t=e.resources.formModel;this.clearLogItems();try{(0,n.transformToLogicSystems)(t);let r={...e,parentObserver:this.getObservationMakerClassName()},i=t.getFieldIds(),o=0,s=0;for(let e of i){let n=t.getFieldModelById(e);if(!n)continue;n.getCalculationString()&&""==n.getCalculationString()?o++:s++;let i={resources:{fieldModel:n},logicTrees:r.logicTrees,parentObserver:this.getObservationMakerClassName()},a=await this.fieldCalculationMaker.makeObservation(i);this.logItems.push(...a.logItems)}return this.logItems.push(this.createInfoLogItem(e,{subjectId:t.formId,messageSecondary:`Form analysis complete: ${t.getFieldIds().length} fields analyzed, ${o} with calculations, ${o} with logic`,relatedEntityIds:[],additionalDetails:{totalFieldsAnalyzed:t.getFieldIds().length,calculationWarnings:this.filterByLogLevel(a.ELogLevel.WARN).length,fieldsWithCalculationsCount:o,fieldsWithoutCalculationsCount:s,analysisType:"form_calculation_and_logic_summary"}})),{logItems:this.getLogItems()}}catch(r){return this.logItems.push(this.createErrorLogItem(e,{subjectId:t.formId,messageSecondary:`Error during form calculation and logic analysis: ${r}`,relatedEntityIds:[],additionalDetails:{errorType:"form_calculation_and_logic_analysis",error:String(r)}})),{logItems:this.getLogItems()}}}}t.CompositeFormCalculationObservationMaker=l,l.observationMakerClassName="CompositeFormCalculationObservationMaker"},1527:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.CompositeFormConfigurationObservationMaker=void 0;let n=r(8753),i=r(3145),o=r(4585);class s extends n.AbstractObservationMaker{constructor(){super(),this.messagePrimary="Form Configuration Analysis",this.subjectType=o.EObservationSubjectType.FORM,this.observationClassName=o.EObservationClass.CompositeFormConfigurationObservationMaker,this.fieldConfigurationMaker=new i.FieldConfigurationObservationMaker}getRequiredResources(){return[o.EObservationResource.FORM_MODEL]}async makeObservation(e){let t=e.resources.formModel,r={withLogic:0,withoutLogic:0,withCalculation:0,withoutCalculation:0,duplicateLabelCount:0},n={};this.clearLogItems();try{if(!t)throw Error("Form model not provided in context resources");let i=t.getFieldIds(),s=0,a={};for(let o of i){let i=t.getFieldModelById(o);if(!i)continue;s++,a[i.getFieldType()]=(a[i.getFieldType()]||0)+1,["section","embed","richtext"].includes(i.getFieldType())||(n[i.labelUserFriendly()]||(n[i.labelUserFriendly()]=[]),n[i.labelUserFriendly()].push(i.fieldId)),i.getCalculationString()?r.withCalculation++:r.withoutCalculation++,i.getLogicOwn()?r.withLogic++:r.withoutLogic++;let l={resources:{fieldModel:i},parentObserver:this.getObservationMakerClassName()};try{let e=await this.fieldConfigurationMaker.makeObservation(l);this.logItems.push(...e.logItems)}catch(t){this.createErrorLogItem(e,{subjectId:o,messageSecondary:`Error analyzing field configuration: ${t instanceof Error?t.message:String(t)}`})}}Object.entries(n).forEach(([t,n])=>{n.length>1&&(r.duplicateLabelCount++,n.forEach(r=>{this.createWarnLogItem(e,{subjectId:r,subjectType:o.EObservationSubjectType.FIELD,messageSecondary:`Duplicate label used ${n.length} times, label: '${t.substring(0,100)}' (truncated to 100 chars).`,relatedEntityIds:n.filter(e=>e!=r)})}))});let l="true"===t.getRawJsonItem("is_workflow_form"),u={isWorkflowForm:l,isNonWorkflowForm:!l,hasApprovers:"true"===t.getRawJsonItem("has_approvers"),isWorkflowPublished:"true"===t.getRawJsonItem("is_workflow_published"),isEncrypted:"true"===t.getRawJsonItem("encrypted"),isActive:"true"!==t.getRawJsonItem("inactive"),isOneQuestionAtATime:"true"===t.getRawJsonItem("should_display_one_question_at_a_time"),numColumns:t.getRawJsonItem("num_columns"),submissionCount:t.getRawJsonItem("submissions"),submissionsUnreadCount:t.getRawJsonItem("submissions_unread"),submissionsTodayCount:t.getRawJsonItem("submissions_today"),viewsCount:t.getRawJsonItem("views"),formVersion:t.getRawJsonItem("version"),formLanguage:t.getRawJsonItem("language"),formTimezone:t.getRawJsonItem("timezone"),isDeleted:"true"===t.getRawJsonItem("deleted"),duplicateLabelCount:r.duplicateLabelCount};this.createInfoLogItem(e,{subjectId:t.formId,messageSecondary:`Form configuration analysis complete. Total fields: ${s}`,additionalDetails:{totalFieldsAnalyzed:s,fieldTypeCounts:a,formConfigurations:u,miscOtherCounts:r,analysisType:"form_configuration_summary"}})}catch(r){this.createErrorLogItem(e,{subjectId:(null==t?void 0:t.formId)||"unknown",messageSecondary:`Error during form configuration analysis: ${r instanceof Error?r.message:String(r)}`})}return{logItems:this.getLogItems()}}}t.CompositeFormConfigurationObservationMaker=s,s.observationMakerClassName="CompositeFormConfigurationObservationMaker"},6584:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.CompositeFormLogicObservationMaker=void 0;let n=r(8753),i=r(1546),o=r(4585);class s extends n.AbstractObservationMaker{constructor(){super(),this.messagePrimary="Form Logic Analysis",this.subjectType=o.EObservationSubjectType.FORM,this.observationClassName=o.EObservationClass.CompositeFormLogicObservationMaker,this.fieldLogicMaker=new i.FieldLogicObservationMaker}getRequiredResources(){return[o.EObservationResource.FORM_MODEL]}async makeObservation(e){let t=e.resources.formModel;this.clearLogItems();try{if(!t)throw Error("Form model is undefined in context resources");let r=t.getFieldIds(),n=0,i=0,s=0;for(let o of r){let r=t.getFieldModelById(o);if(!r)continue;n++,r.getLogicOwn()?i++:s++;let a={resources:{fieldModel:r,formModel:t},parentObserver:this.getObservationMakerClassName()};try{let e=await this.fieldLogicMaker.makeObservation(a);this.logItems.push(...e.logItems)}catch(t){this.createErrorLogItem(e,{subjectId:o,messageSecondary:`Error analyzing field logic: ${t instanceof Error?t.message:String(t)}`})}}this.createInfoLogItem(e,{subjectId:t.formId,messageSecondary:`Form logic analysis complete. 
        Total fields: ${n}, 
        Fields with logic: ${i}, 
        Fields with logic warning: ${this.filterByLogLevel(o.ELogLevel.WARN).length}`,additionalDetails:{totalLogicWarnings:this.filterByLogLevel(o.ELogLevel.WARN).length,totalLogicInfoMessage:this.filterByLogLevel(o.ELogLevel.INFO).length,fieldsWithoutLogicCount:s,fieldsWithLogicCount:i}})}catch(r){this.createErrorLogItem(e,{subjectId:(null==t?void 0:t.formId)||"unknown",messageSecondary:`Error during form logic analysis: ${r instanceof Error?r.message:String(r)}`})}return{logItems:this.getLogItems()}}}t.CompositeFormLogicObservationMaker=s,s.observationMakerClassName="CompositeFormLogicObservationMaker"},6190:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.CompositeFormOrphanFieldIdObservationMaker=void 0;let n=r(8753),i=r(9283),o=r(4585);class s extends n.AbstractObservationMaker{constructor(){super(),this.messagePrimary="Form Orphan Field ID Analysis",this.subjectType=o.EObservationSubjectType.FORM,this.observationClassName=o.EObservationClass.CompositeFormOrphanFieldIdObservationMaker,this.fieldOrphanFieldIdMaker=new i.FieldOrphanFieldIdObservationMaker}getRequiredResources(){return[o.EObservationResource.FORM_MODEL]}async makeObservation(e){let t=e.resources.formModel;this.clearLogItems();try{if(!t)throw Error("Form model not provided in context resources");for(let r of t.getFieldIds()){let n=t.getFieldModelById(r);if(!n)continue;let i={resources:{fieldModel:n,formModel:t},parentObserver:this.getObservationMakerClassName()};try{let e=await this.fieldOrphanFieldIdMaker.makeObservation(i);this.logItems.push(...e.logItems)}catch(t){this.createErrorLogItem(e,{subjectId:r,messageSecondary:`Error analyzing field orphan field ID: ${t instanceof Error?t.message:String(t)}`})}}let r=this.getLogItems().filter(e=>e.logLevel===o.ELogLevel.ERROR);r.length>0?this.createErrorLogItem(e,{subjectId:t.formId,messageSecondary:`Form orphan fieldId analysis complete. Found ${r.length} orphan fieldIds.`}):this.createInfoLogItem(e,{subjectId:t.formId,messageSecondary:"Form orphan fieldId analysis complete. Found no orphan fieldIds."})}catch(r){this.createErrorLogItem(e,{subjectId:(null==t?void 0:t.formId)||"unknown",messageSecondary:`Error during form orphan field ID analysis: ${r instanceof Error?r.message:String(r)}`})}return{logItems:this.getLogItems()}}}t.CompositeFormOrphanFieldIdObservationMaker=s,s.observationMakerClassName="CompositeFormOrphanFieldIdObservationMaker"},3200:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.FieldCalculationObservationMaker=void 0;let n=r(2104),i=r(8753),o=r(4585);class s extends i.AbstractObservationMaker{constructor(){super(...arguments),this.messagePrimary="Field Calculation at a glance",this.subjectType=o.EObservationSubjectType.FIELD,this.observationClassName=o.EObservationClass.FieldCalculationObservationMaker}getRequiredResources(){return[o.EObservationResource.FIELD_MODEL]}async makeObservation(e){let t=e.resources.fieldModel,r=[];try{let i=t.getCalculationString();if(i&&""!==i.trim()||r.push(this.createInfoLogItem(e,{subjectId:t.fieldId,messageSecondary:`No calculation found for fieldId: ${t.fieldId}`,relatedEntityIds:[],additionalDetails:{fieldId:t.fieldId,calculationString:i,calculationType:null,fieldType:t.getFieldType()}})),i&&""!==i.trim()){let o=n.FsCalculationGraphShallow.fromCalcStringJsonOrThrow(t.fieldId,i),s=o.getAllErrorNodes();0==s.length&&r.push(this.createInfoLogItem(e,{subjectId:t.fieldId,messageSecondary:`No calculation errors found in fieldId: ${t.fieldId}, calculation: '${i}'`,relatedEntityIds:o.getDependantFieldIds(),additionalDetails:{fieldId:t.fieldId,calculationString:i,calculationType:"",fieldType:t.getFieldType(),errorType:"no_errors"}})),s.forEach(n=>{r.push(this.createWarnLogItem(e,{subjectId:t.fieldId,messageSecondary:n.calcError.message,relatedEntityIds:o.getDependantFieldIds(),additionalDetails:{fieldId:t.fieldId,calculationString:i,calculationType:"",fieldType:t.getFieldType(),errorType:"calculation_error",errorDetails:n.calcError}}))})}return{logItems:r}}catch(n){return r.push(this.createErrorLogItem(e,{subjectId:t.fieldId,messageSecondary:`Error analyzing field calculation: ${n}`,relatedEntityIds:[],additionalDetails:{errorType:"field_calculation_analysis",fieldId:t.fieldId,error:String(n)}})),{logItems:r}}}}t.FieldCalculationObservationMaker=s,s.observationMakerClassName="FieldCalculationObservationMaker"},3145:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.FieldConfigurationObservationMaker=void 0;let n=r(8753),i=r(4585);class o extends n.AbstractObservationMaker{constructor(){super(),this.messagePrimary="Field Configuration Analysis",this.subjectType=i.EObservationSubjectType.FIELD,this.observationClassName=i.EObservationClass.FieldConfigurationObservationMaker}getRequiredResources(){return[i.EObservationResource.FIELD_MODEL]}async makeObservation(e){let t=e.resources.fieldModel;this.clearLogItems();try{if(!t)throw Error("Field model not provided in context resources");if(t.labelUserFriendly()!==t.labelUserFriendly().trim()&&this.createWarnLogItem(e,{subjectId:t.fieldId,messageSecondary:`Field has leading/trailing whitespace, field: ${t.fieldId}`,additionalDetails:{fieldId:t.fieldId,fieldType:t.getFieldType(),analysisType:"field_configuration_summary"}}),""===t.labelUserFriendly().trim()&&this.createWarnLogItem(e,{subjectId:t.fieldId,messageSecondary:`Field has empty/missing label, field: ${t.fieldId}`,additionalDetails:{fieldId:t.fieldId,fieldType:t.getFieldType(),analysisType:"field_configuration_summary"}}),["checkbox","radio","select"].includes(t.getFieldType())){let r=t.getRawJsonItem("options");Array.isArray(r)||this.createWarnLogItem(e,{subjectId:t.fieldId,messageSecondary:`Field of type: '${t.getFieldType()}' has no define options.`}),Array.isArray(r)&&r.length<2&&this.createWarnLogItem(e,{subjectId:t.fieldId,messageSecondary:`Field of type: '${t.getFieldType()}' than ${r.length} options.`})}}catch(r){this.createErrorLogItem(e,{subjectId:(null==t?void 0:t.fieldId)||"unknown",messageSecondary:`Error during field configuration analysis: ${r instanceof Error?r.message:String(r)}`})}return{logItems:this.getLogItems()}}}t.FieldConfigurationObservationMaker=o,o.observationMakerClassName="FieldConfigurationObservationMaker"},1546:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.FieldLogicObservationMaker=void 0;let n=r(8133),i=r(8753),o=r(4585);class s extends i.AbstractObservationMaker{constructor(){super(...arguments),this.messagePrimary="Field Logic Analysis",this.subjectType=o.EObservationSubjectType.FIELD,this.observationClassName=o.EObservationClass.FieldLogicObservationMaker}getRequiredResources(){return[o.EObservationResource.FIELD_MODEL,o.EObservationResource.FORM_MODEL]}async makeObservation(e){let t=e.resources.fieldModel,r=e.resources.formModel;this.clearLogItems();let i=t.getLogicOwn();if(!i)return this.createInfoLogItem(e,{subjectId:t.fieldId,messageSecondary:`Field has no own logic configured, fieldId: ${t.fieldId}`,relatedEntityIds:[],additionalDetails:{fieldId:t.fieldId,fieldType:t.getFieldType(),hasLogic:!1}}),{logItems:this.getLogItems()};let o=JSON.stringify(i),s=n.FsFieldVisibilityGraph.fromFormModel(t.fieldId,r).getAllErrorNodes();0===s.length&&this.createInfoLogItem(e,{subjectId:t.fieldId,messageSecondary:`No logic errors found, fieldId: ${t.fieldId}. Number of conditions: ${(i.checks||[]).length}`,relatedEntityIds:[],additionalDetails:{fieldId:t.fieldId,logicString:o,fieldType:t.getFieldType(),hasLogic:!0,logicOwn:i}});let{action:a,checks:l,ownerFieldId:u}=i;return s.forEach(r=>{var n;this.createWarnLogItem(e,{subjectId:t.fieldId,messageSecondary:r.logicError.message,relatedEntityIds:null===(n=r.logicError.dependencyChainFieldIds)||void 0===n?void 0:n.map(e=>e.directOwnerFieldId),additionalDetails:{fieldId:t.fieldId,logicString:o,fieldType:t.getFieldType(),logic:{action:a,checks:l,ownerFieldId:u}}})}),{logItems:this.getLogItems()}}}t.FieldLogicObservationMaker=s,s.observationMakerClassName="FieldLogicObservationMaker"},9283:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.FieldOrphanFieldIdObservationMaker=void 0;let n=r(8753),i=r(4585),o=r(2104);class s extends n.AbstractObservationMaker{constructor(){super(),this.messagePrimary="Field Orphan Field ID Analysis",this.subjectType=i.EObservationSubjectType.FIELD,this.observationClassName=i.EObservationClass.FieldOrphanFieldIdObservationMaker}getRequiredResources(){return[i.EObservationResource.FIELD_MODEL,i.EObservationResource.FORM_MODEL]}async makeObservation(e){let t=e.resources.fieldModel,r=e.resources.formModel;this.clearLogItems();try{if(!t)throw Error("Field model not provided in context resources");if(!r)throw Error("Form model not provided in context resources");if(t.getCalculationString()){let n=o.FsCalculationGraphShallow.fromCalcStringJson(t.fieldId,t.getCalculationString()||"");n&&n.getDependantFieldIds().forEach(n=>{a(n,r)||this.createErrorLogItem(e,{subjectId:t.fieldId,messageSecondary:`Calculation of field ${t.fieldId} refers to a field that does not exist of form (orphan fieldId: ${n})`})})}if(t.getLogicOwn()){let{checks:n}=t.getLogicOwn();n&&(n||[]).forEach(n=>{a(n.fieldId,r)&&this.createErrorLogItem(e,{subjectId:t.fieldId,messageSecondary:`One of the logic conditions of field ${t.fieldId} refers to a field that does not exist of form (orphan fieldId: ${n.fieldId}). check: ${JSON.stringify(n)}`})})}}catch(r){this.createErrorLogItem(e,{subjectId:(null==t?void 0:t.fieldId)||"unknown",messageSecondary:`Error during field orphan field ID analysis: ${r instanceof Error?r.message:String(r)}`})}return{logItems:this.getLogItems()}}}t.FieldOrphanFieldIdObservationMaker=s,s.observationMakerClassName="FieldOrphanFieldIdObservationMaker";let a=(e,t)=>null!==t.getFieldModelById(e)},9959:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.CompositeFormOrphanFieldIdObservationMaker=t.CompositeFormConfigurationObservationMaker=t.CompositeFormLogicObservationMaker=t.CompositeFormCalculationObservationMaker=t.FieldOrphanFieldIdObservationMaker=t.FieldConfigurationObservationMaker=t.FieldLogicObservationMaker=t.FieldCalculationObservationMaker=t.AbstractObservationMaker=void 0;var n=r(8753);Object.defineProperty(t,"AbstractObservationMaker",{enumerable:!0,get:function(){return n.AbstractObservationMaker}});var i=r(3200);Object.defineProperty(t,"FieldCalculationObservationMaker",{enumerable:!0,get:function(){return i.FieldCalculationObservationMaker}});var o=r(1546);Object.defineProperty(t,"FieldLogicObservationMaker",{enumerable:!0,get:function(){return o.FieldLogicObservationMaker}});var s=r(3145);Object.defineProperty(t,"FieldConfigurationObservationMaker",{enumerable:!0,get:function(){return s.FieldConfigurationObservationMaker}});var a=r(9283);Object.defineProperty(t,"FieldOrphanFieldIdObservationMaker",{enumerable:!0,get:function(){return a.FieldOrphanFieldIdObservationMaker}});var l=r(9638);Object.defineProperty(t,"CompositeFormCalculationObservationMaker",{enumerable:!0,get:function(){return l.CompositeFormCalculationObservationMaker}});var u=r(6584);Object.defineProperty(t,"CompositeFormLogicObservationMaker",{enumerable:!0,get:function(){return u.CompositeFormLogicObservationMaker}});var c=r(1527);Object.defineProperty(t,"CompositeFormConfigurationObservationMaker",{enumerable:!0,get:function(){return c.CompositeFormConfigurationObservationMaker}});var d=r(6190);Object.defineProperty(t,"CompositeFormOrphanFieldIdObservationMaker",{enumerable:!0,get:function(){return d.CompositeFormOrphanFieldIdObservationMaker}})},4585:function(e,t){var r,n,i,o,s,a,l,u;Object.defineProperty(t,"__esModule",{value:!0}),t.EObservationResource=t.EObservationClass=t.EObservationSubjectType=t.ELogLevel=void 0,(s=r||(t.ELogLevel=r={})).DEBUG="debug",s.INFO="info",s.WARN="warn",s.ERROR="error",(a=n||(t.EObservationSubjectType=n={})).FORM="form",a.FIELD="field",a.SUBMIT_ACTION="submitAction",a.EMAIL_NOTIFICATION="emailNotification",a.EMAIL_CONFIRMATION="emailConfirmation",a.WEBHOOK="webhook",(l=i||(t.EObservationResource=i={})).FORM_MODEL="formModel",l.FIELD_MODEL="fieldModel",l.CALC_TREE="calcTree",l.LOGIC_TREE="logicTree",l.LOGIC_SYSTEM="logicSystem",l.WEBHOOK_MODEL="webhookModel",l.EMAIL_MODEL="emailModel",(u=o||(t.EObservationClass=o={})).FieldCalculationObservationMaker="FieldCalculationObservationMaker",u.FieldLogicObservationMaker="FieldLogicObservationMaker",u.FieldConfigurationObservationMaker="FieldConfigurationObservationMaker",u.FieldOrphanFieldIdObservationMaker="FieldOrphanFieldIdObservationMaker",u.CompositeFormCalculationObservationMaker="CompositeFormCalculationObservationMaker",u.CompositeFormLogicObservationMaker="CompositeFormLogicObservationMaker",u.CompositeFormConfigurationObservationMaker="CompositeFormConfigurationObservationMaker",u.CompositeFormOrphanFieldIdObservationMaker="CompositeFormOrphanFieldIdObservationMaker"},9746:function(e,t,r){var n,i,o,s=this&&this.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GenericDirectedGraph=t.AbstractDirectedGraph=void 0;let l=a(r(767)),u=r(4418),c=r(2359),d=e=>e.nodeContent;class h extends c.AbstractTree{appendChildNodeWithContent(e,t){return super.appendChildNodeWithContent(e,t)}cloneAt(e){let t=this.toPojoAt(e);return h.fromPojo(t,d)}createSubtreeAt(e){let t=new this.constructor(e),r=super.appendChildNodeWithContent(e,t);return t._rootNodeId=r,t._nodeDictionary={},t._nodeDictionary[t._rootNodeId]={nodeContent:null},t._incrementor=this._incrementor,t}fromPojoAppendChildNodeWithContent(e,t){return this.appendChildNodeWithContent(e,t)}static getNewInstance(e,t){return new f(e,t)}static fromPojo(e,t=d){return s(h,n,"m",o).call(h,e,t)}}t.AbstractDirectedGraph=h,n=h,o=function(e,t=d){let r=Object.assign({},e),o=l.default.parseUniquePojoRootKeyOrThrow(r),a=r[o],c=h.getNewInstance(o);if(c.replaceNodeContent(c.rootNodeId,t(a)),delete r[o],s(h,n,"f",i).call(h,c._rootNodeId,o,c,r,t),Object.keys(r).length>0)throw new u.DirectedGraphError("Orphan nodes detected while parsing pojo object.");return c},i={value:(e,t,r,o,a,u=[])=>(Object.entries(l.default.extractChildrenNodes(t,o)).forEach(([t,l])=>{if(l&&l.nodeType&&l.nodeType.startsWith(c.AbstractTree.SubtreeNodeTypeName)){let c=r.createSubtreeAt(e);c.replaceNodeContent(c.rootNodeId,a(l)),s(h,n,"f",i).call(h,c.rootNodeId,t,c,o,a,u)}else{let c=r.fromPojoAppendChildNodeWithContent(e,a(l));u.push({from:t,to:c}),s(h,n,"f",i).call(h,c,t,r,o,a,u)}}),u)};class f extends h{}t.GenericDirectedGraph=f},767:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});let n=r(4418),i=e=>{let t=[];return Object.entries(e).forEach(([e,r])=>{e===r.parentId&&t.push(e)}),t};t.default={extractChildrenNodes:(e,t)=>{let r={};return Object.entries(t).forEach(([n,i])=>{i.parentId===e&&(r[n]=i,delete t[n])}),r},parseCandidateRootNodeId:i,parseUniquePojoRootKeyOrThrow:e=>{let t=i(e);if(1!==t.length)throw new n.DirectedGraphError(`No distinct root found. There must exist one and only one nodeId === {parentId}. Found ${t.length}.`);return t[0]}}},119:function(e,t,r){var n,i,o,s,a,l=this&&this.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GenericExpressionTree=t.AbstractExpressionTree=void 0;let c=r(2359),d=r(4418),h=u(r(767)),f=r(8139),p=r(8573),g=e=>e.nodeContent;class v extends c.AbstractTree{constructor(e="_root_",t){super(e,t),n.add(this)}appendContentWithAnd(e,t){return this.appendContentWithJunction(e,p.createAndJunction(),t)}createSubtreeOfTypeAt(e,t){return this.createSubtreeAt(e)}defaultJunction(e){return p.createAndJunction()}appendTreeAt(e,t,r){let n=e;if(this.isLeaf(e)){let t=this.getChildContentAt(e);this.replaceNodeContent(e,this.defaultJunction(e)),n=this.appendChildNodeWithContent(e,t)}let i=super.appendTreeAt(n,t,r);return n!==e&&i.push({from:e,to:n}),i}appendContentWithOr(e,t){return this.appendContentWithJunction(e,p.createOrJunction(),t)}appendContentWithJunction(e,t,r){if(this.isBranch(e)){let i;super.replaceNodeContent(e,t);let s=l(this,n,"m",o).call(this,e);return s.length>0?(i=s[0],super.replaceNodeContent(i,r)):i=super.appendChildNodeWithContent(e,r),{newNodeId:i,originalContentNodeId:void 0,junctionNodeId:e,isNewBranch:!1}}let i=this.getChildContentAt(e),s=super.appendChildNodeWithContent(e,i);return this.replaceNodeContent(e,t),{newNodeId:super.appendChildNodeWithContent(e,r),originalContentNodeId:s,junctionNodeId:e,isNewBranch:!0}}appendChildNodeWithContent(e,t){let r=l(this,n,"m",o).call(this,e);return r.length>0?(super.replaceNodeContent(r[0],t),r[0]):super.appendChildNodeWithContent(e,t)}cloneAt(e=this.rootNodeId){let t=this.toPojoAt(e);return v.fromPojo(t,g)}getNewInstance(e,t){return super._getNewInstance(e,t)}static reRootTreeAt(e,t,r){let n=e.getTreeNodeIdsAt(t),i=[];return n.forEach(n=>{let o=n.replace(t,r);e._nodeDictionary[o]=e._nodeDictionary[n],delete e._nodeDictionary[n],i.push({from:n,to:o})}),i}static getNewInstance(e,t){return new m(e,t)}static fromPojo(e,t=g){let r=l(v,i,"m",s).call(v,e,t);return v.validateTree(r),r}fromPojoAppendChildNodeWithContent(e,t){return this.appendChildNodeWithContent(e,t)}_getSiblingIds(e){return super.getSiblingIds(e)}removeNodeAt(e){let t=this._getSiblingIds(e);if(t.length>1)return super.removeNodeAt(e);let r=this.getParentNodeId(e),n=this.getChildContentAt(t[0]);this.replaceNodeContent(r,n),super.removeNodeAt(t[0]),super.removeNodeAt(e)}static validateTree(e){e.getTreeNodeIdsAt(e.rootNodeId).forEach(t=>{if(e.isBranch(t)){let r=e.getChildrenNodeIdsOf(t);if(r.length<2)throw new f.ExpressionTreeError(`Tree fails no-single-child rule. childIds: '${r.join("', '")}'.`)}})}toPojoAt(e=this.rootNodeId,t){return super.toPojoAt(e,t)}}t.AbstractExpressionTree=v,i=v,n=new WeakSet,o=function(e){return this.getChildrenNodeIdsOf(e).filter(e=>null===this.getChildContentAt(e))},s=function(e,t=g){let r=Object.assign({},e),n=h.default.parseUniquePojoRootKeyOrThrow(r),o=r[n],s=v.getNewInstance(n);if(s.replaceNodeContent(s.rootNodeId,t(o)),delete r[n],l(v,i,"f",a).call(v,s._rootNodeId,n,s,r,t),Object.keys(r).length>0)throw new d.DirectedGraphError("Orphan nodes detected while parsing pojo object.");return s},a={value:(e,t,r,n,o,s=[])=>(Object.entries(h.default.extractChildrenNodes(t,n)).forEach(([t,u])=>{if(u.nodeType&&u.nodeType.startsWith(c.AbstractTree.SubtreeNodeTypeName+":")){let c=r.createSubtreeOfTypeAt(e,u.nodeType);c.replaceNodeContent(c.rootNodeId,o(u)),l(v,i,"f",a).call(v,c.rootNodeId,t,c,n,o,s)}else{let c=r.fromPojoAppendChildNodeWithContent(e,o(u));s.push({from:t,to:c}),l(v,i,"f",a).call(v,c,t,r,n,o,s)}}),s)};class m extends v{getNewInstance(e,t){return new m(e,t)}createSubtreeAt(e){let t=new m("_subtree_"),r=this.appendChildNodeWithContent(e,t);return v.reRootTreeAt(t,t.rootNodeId,r),t._rootNodeId=r,t._incrementor=this._incrementor,t}createSubtreeOfTypeAt(e,t){return this.createSubtreeAt(e)}}t.GenericExpressionTree=m},8139:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ExpressionTreeError=void 0;class r extends Error{constructor(e){super(e),this._code="ERR_EXPRESSION_TREE",this.name=this._code}get code(){return this._code}}t.ExpressionTreeError=r},8573:function(e,t){var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.createOrJunction=t.createAndJunction=t.JunctionOperatorType=void 0,(n=r=t.JunctionOperatorType||(t.JunctionOperatorType={})).AND="$and",n.OR="$or",t.createAndJunction=function(){return{operator:r.AND}},t.createOrJunction=function(){return{operator:r.OR}}},1947:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractObfuscatedExpressionTree=void 0;let n=r(119),i=r(8677),o=r(3762),s=r(2359);class a extends n.AbstractExpressionTree{constructor(e,t,r){super(t,r),this._internalTree=e||n.AbstractExpressionTree.fromPojo({root:{parentId:"root",nodeContent:s.AbstractTree.EmptyNode}}),this._keyStore=new i.KeyStore,this._internalTree.getTreeNodeIdsAt(this._internalTree.rootNodeId).forEach(e=>{this._keyStore.putValue(e)}),this._rootKey=this._keyStore.reverseLookUpExactlyOneOrThrow(this._internalTree.rootNodeId),this._internalTree.getSubtreeIdsAt(this._internalTree.rootNodeId).forEach(e=>{let t=this._internalTree.getChildContentAt(e);this._keyStore.putValue(e),this._internalTree.replaceNodeContent(e,new l(t))})}get rootNodeId(){return this._rootKey}appendChildNodeWithContent(e,t){let r=this._getNodeIdOrThrow(e),n=this._internalTree.appendChildNodeWithContent(r,t);return this._keyStore.putValue(n)}static appendTreeAt(e,t,r,n){let i=e._getNodeIdOrThrow(t);return e._internalTree.appendTreeAt(i,r instanceof a?r._internalTree:r,n).map(({from:t,to:r})=>({from:t,to:e._keyStore.putValue(r)}))}appendTreeAt(e,t,r){return a.appendTreeAt(this,e,t,r)}appendContentWithJunction(e,t,r){let n=this._getNodeIdOrThrow(e);if(this.isBranch(e)){let i=this._internalTree.appendContentWithJunction(n,t,r);return{isNewBranch:!1,newNodeId:this._keyStore.putValue(i.newNodeId),junctionNodeId:e}}let i=this._internalTree.appendContentWithJunction(n,t,r);return i.junctionNodeId=this._keyStore.reverseLookUpExactlyOneOrThrow(i.junctionNodeId),i.originalContentNodeId=this._keyStore.putValue(i.originalContentNodeId),i.newNodeId=this._keyStore.putValue(i.newNodeId),i}cloneAt(e){let t=this._getNodeIdOrThrow(e);return new u(this._internalTree.cloneAt(t))}buildReverseMap(e={}){return this._keyStore.allKeys().forEach(t=>{e[this._keyStore.getValue(t)]=t}),this._internalTree.getSubtreeIdsAt(this._internalTree.rootNodeId).forEach(t=>{this._internalTree.getChildContentAt(t).buildReverseMap(e)}),e}countTotalNodes(e=this.rootNodeId,t){let r=this._getNodeIdOrThrow(e);return this._internalTree.countTotalNodes(r,t)}getChildContentAt(e){let t=this._getNodeIdOrThrow(e);return this._internalTree.getChildContentAt(t)}getChildrenNodeIdsOf(e,t){let r=this._getNodeIdOrThrow(e);return this.reverseMapKeys(this._internalTree.getChildrenNodeIdsOf(r,t))}getChildrenContentOf(e,t){let r=this._getNodeIdOrThrow(e);return this._internalTree.getChildrenContentOf(r,t)}getDescendantContentOf(e,t){let r=this._getNodeIdOrThrow(e);return this._internalTree.getDescendantContentOf(r,t)}getDescendantNodeIds(e,t){let r=this._getNodeIdOrThrow(e);return this.reverseMapKeys(this._internalTree.getDescendantNodeIds(r,t))}createSubtreeAt(e){let t=this._internalTree.appendChildNodeWithContent(e,null);this._internalTree.getNewInstance(t);let r=this.getNewInstance(t);this._internalTree.replaceNodeContent(t,r);let n=this._keyStore.putValue(t);return r._keyStore=new i.KeyStore,r._keyStore.putValue(t,n),r._rootNodeId=t,r._nodeDictionary={[t]:{nodeContent:null}},r._rootKey=n,r._internalTree._incrementor=this._internalTree._incrementor,r}getNewInstance(e,t){class r extends a{}return new r(new n.GenericExpressionTree(e,t))}getParentNodeId(e){let t=this._getNodeIdOrThrow(e),r=this._internalTree.getParentNodeId(t);return this._keyStore.reverseLookUpExactlyOneOrThrow(r)}getSiblingIds(e){let t=this._getNodeIdOrThrow(e);return this.reverseMapKeys(this._internalTree.getSiblingIds(t))}getTreeContentAt(e=this.rootNodeId,t){let r=this._getNodeIdOrThrow(e),n=this._internalTree.getTreeContentAt(r);return t&&this._internalTree.getSubtreeIdsAt().forEach(e=>{let t=this._internalTree.getChildContentAt(e);null!==t&&n.push(...t.getTreeContentAt())}),n}getTreeNodeIdsAt(e){let t=this._getNodeIdOrThrow(e);return this.reverseMapKeys(this._internalTree.getTreeNodeIdsAt(t))}_getNodeId(e){return this._keyStore.getValue(e)}_getNodeIdOrThrow(e){let t=this._getNodeId(e);if(void 0===t)throw new o.ObfuscatedError(`Failed to find nodeId with key: '${e}'.`);return t}isLeaf(e){let t=this._getNodeIdOrThrow(e);return this._internalTree.isLeaf(t)}removeNodeAt(e){let t=this._getNodeIdOrThrow(e);super.removeNodeAt.call(this._internalTree,t)}replaceNodeContent(e,t){let r=this._getNodeIdOrThrow(e);this._internalTree.replaceNodeContent(r,t)}reverseMapKeys(e){return e.map(e=>this._keyStore.reverseLookUpExactlyOneOrThrow(e))}wrapVisitor(e){return{includeSubtrees:e.includeSubtrees,visit:(t,r,n)=>{e.visit(t,r,n)}}}toPojoAt(e=this.rootNodeId){let t=this._getNodeIdOrThrow(e),r=this._internalTree.toPojoAt(t);return a.obfuscatePojo(r)}static obfuscatePojo(e){let t=Object.assign({},e),r=new i.KeyStore;return Object.keys(t).forEach(e=>{t[r.putValue(e)]=Object.assign({},t[e]),delete t[e]}),Object.entries(t).forEach(([e,n])=>{t[e].parentId=r.reverseLookUpExactlyOneOrThrow(t[e].parentId)}),t}visitAllAt(e,t=this.rootNodeId,r=this.rootNodeId){let n=this.getChildrenNodeIdsOf(t,e.includeSubtrees),i=this.getChildContentAt(t),o=this.wrapVisitor(e);e.includeSubtrees&&i instanceof a?i._internalTree.visitAllAt(o):e.visit(t,i,r),n.forEach(e=>{this.visitAllAt(o,e,t)})}visitLeavesOf(e,t=this.rootNodeId){this.wrapVisitor(e),this._getNodeIdOrThrow(t);let r=this.getDescendantNodeIds(t,e.includeSubtrees).filter(e=>this.isLeaf(e)&&!this.isSubtree(e));e.includeSubtrees&&r.push(...this.getSubtreeIdsAt(t)),r.forEach(t=>{let r=this.getParentNodeId(t),n=this.getChildContentAt(t);n instanceof a?n._internalTree.visitLeavesOf(e):e.visit(t,n,r)})}static fromPojo(e){class t extends a{}let r=n.AbstractExpressionTree.fromPojo(e);return n.AbstractExpressionTree.validateTree(r),new t(r)}fromPojoAppendChildNodeWithContent(e,t){let r=this._keyStore.reverseLookUpExactlyOneOrThrow(e),n=this.appendChildNodeWithContent(r,t);return this._keyStore.getValue(n)}}t.AbstractObfuscatedExpressionTree=a;class l extends a{}class u extends a{}},3762:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ObfuscatedError=void 0;class r extends Error{constructor(e){super(e),this.name="ObfuscatedError"}get code(){return"ERR_OBFUSCATE_ERROR"}}t.ObfuscatedError=r},2359:function(e,t,r){var n,i,o,s,a,l,u,c,d,h,f,p,g,v,m,y,_,b=this&&this.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractTree=void 0;let I=r(4418),w=r(4745),O=r(8677),C=e=>e,N=(e,t)=>RegExp("^"+e+t+"[\\d]+$"),F=(e,t,r="")=>RegExp("^"+e+t,r);class E{constructor(e="_root_",t){n.add(this),this._nodeDictionary={},this._nodeKeyDelimiter=":",this._incrementor=new w.Incrementor,this.SubtreeNodeTypeName="_ABSTRACT_FOR_BACKWARD_COMPATIBILITY_ONLY_",this._rootNodeId=e,void 0===t?b(this,n,"m",v).call(this,this._rootNodeId,E.EmptyNode):this._nodeDictionary[this._rootNodeId]={nodeContent:t}}appendChildNodeWithContent(e,t){return b(this,n,"m",i).call(this,e,t)}appendTreeAt(e=this.rootNodeId,t,r){return E.appendTree(this,t,e,r)}static appendTree(e,t,r,i){let o=i||t.rootNodeId,s=b(t,n,"m",h).call(t,o),a=RegExp(o,"g");t._rootNodeId,t._rootNodeId;let l=s.map(e=>{let t=e.replace(a,r+":treeAppend");return{from:e,to:t}});return l.forEach(({from:r,to:i})=>{if(i in e._nodeDictionary)throw Error(`ID COLLISION offending node: "${i}".`);e._nodeDictionary[i]=t._nodeDictionary[r],b(e,n,"m",c).call(e,"ANY")}),l}countDescendantsOf(e=this.rootNodeId){return b(this,n,"m",o).call(this,e),this.getDescendantNodeIds(e).length}countGreatestDepthOf(e=this.rootNodeId){b(this,n,"m",s).call(this,e);let t=1,r=this.getDescendantNodeIds(e);if(0===r.length)return t;let i=this.getBranchDepth(e);for(let e of r){let r=this.getBranchDepth(e)-i+1;r>t&&(t=r)}return t}countLeavesOf(e=this.rootNodeId){return this.getDescendantNodeIds(e).filter(e=>0===this.getDescendantNodeIds(e).length).length}countTotalNodes(e=this.rootNodeId,t=!0){let r=b(this,n,"m",h).call(this,e).length;return t&&this.getSubtreeIdsAt(e).forEach(e=>{let t=this.getChildContentAt(e);r+=t.countTotalNodes()}),r}filterIds(e){return Object.keys(this._nodeDictionary).filter(e)}getBranchDepth(e){let t=RegExp(this._nodeKeyDelimiter,"g");return(e.match(t)||[]).length+1}nodeIdExists(e){return void 0!==this._nodeDictionary[e]}getChildContentAt(e){return b(this,n,"m",a).call(this,e)}getNodeIdsWithNodeContent(e,t){return this.getTreeNodeIdsAt(this.rootNodeId).filter(t=>!this.isSubtree(t)&&null!==this.getChildContentAt(t)&&e(this.getChildContentAt(t)))}getChildrenNodeIdsOf(e,t=!1){return b(this,n,"m",l).call(this,e,t)}getCountTotalNodes(){return Object.keys(this._nodeDictionary).length}getChildrenContentOf(e,t=!1){let r=b(this,n,"m",l).call(this,e,t);return b(this,n,"m",u).call(this,r)}getDescendantContentOf(e,t=!1){b(this,n,"m",o).call(this,e);let r=this.getDescendantNodeIds(e,t),i=[];return r.forEach(e=>{let r=b(this,n,"m",a).call(this,e);if(r instanceof E){let e=r.getTreeContentAt(r.rootNodeId,t);i.push(...e)}else i.push(r)}),i}getDescendantNodeIds(e,t=!1){let r=F(e,this._nodeKeyDelimiter);return t?this.filterIds(e=>r.test(e)):this.filterIds(e=>r.test(e)&&!this.isSubtree(e))}_getNewInstance(e,t){return Reflect.construct(this.constructor,[e,t])}getParentNodeId(e){return b(this,n,"m",d).call(this,e)}getSiblingIds(e){if(this.isRoot(e))return[];let t=b(this,n,"m",d).call(this,e),r=b(this,n,"m",l).call(this,t),i=r.indexOf(e);return i>-1&&r.splice(i,1),r}getSubtreeIdsAt(e=this.rootNodeId){let t=this.getDescendantNodeIds(e,!0),r=this;return t.filter(e=>r.isSubtree(e))}getTreeContentAt(e=this.rootNodeId,t=!1){if(this.nodeIdExists(e)){let r=this.getDescendantContentOf(e,t);return r.push(this.getChildContentAt(e)),r}return[]}getTreeNodeIdsAt(e){return b(this,n,"m",h).call(this,e)}isBranch(e){return this.getDescendantNodeIds(e).length>0}isLeaf(e){return b(this,n,"m",f).call(this,e)}isRoot(e){return e===this._rootNodeId}isSubtree(e){return this.getChildContentAt(e) instanceof E}move(e,t){let r=b(this,n,"m",c).call(this,t),i=b(this,n,"m",h).call(this,e).map(t=>({from:t,to:t.replace(e,r)}));return i.forEach(({from:e,to:t})=>{b(this,n,"m",p).call(this,e,t)}),i}moveChildren(e,t){let r=this.getDescendantNodeIds(e).map(r=>({from:r,to:r.replace(e,t)}));return r.forEach(({from:e,to:t})=>{b(this,n,"m",p).call(this,e,t)}),r}removeNodeAt(e){if(this.isRoot(e))throw new I.DirectedGraphError("Can not remove root node.");b(this,n,"m",h).call(this,e).forEach(e=>{this.removeSingleNode(e)})}removeSingleNode(e){delete this._nodeDictionary[e]}replaceNodeContent(e,t){b(this,n,"m",g).call(this,e,t)}get rootNodeId(){return this._rootNodeId}visitAllAt(e,t=this.rootNodeId){b(this,n,"m",m).call(this,e,t,t)}visitLeavesOf(e,t=this._rootNodeId){b(this,n,"m",y).call(this,e,t)}static obfuscatePojo(e){let t=Object.assign({},e),r=new O.KeyStore;return Object.keys(t).forEach(e=>{t[r.putValue(e)]=Object.assign({},t[e]),delete t[e]}),Object.entries(t).forEach(([e,n])=>{t[e].parentId=r.reverseLookUpExactlyOneOrThrow(t[e].parentId)}),t}toPojoAt(e=this.rootNodeId,t){return b(this,n,"m",_).call(this,e,e,t)}}t.AbstractTree=E,n=new WeakSet,i=function(e,t){let r=b(this,n,"m",c).call(this,e);return this._nodeDictionary[r]={nodeContent:t},r},o=function(e){if(this.nodeIdExists(e))return!0;throw new I.DirectedGraphError(`Tried to retrieve node that does not exist. nodeId: "${e}".`)},s=function(e){if(void 0===this._nodeDictionary[e])throw new I.DirectedGraphError(`Tried to retrieve node that does not exist. nodeId: "${e}".`);return b(this,n,"m",a).call(this,e)},a=function(e){return void 0===this._nodeDictionary[e]?E.EmptyNode:this._nodeDictionary[e].nodeContent},l=function(e,t=!1){let r=N(e,this._nodeKeyDelimiter);return t?this.filterIds(e=>r.test(e)):this.filterIds(e=>r.test(e)&&!this.isSubtree(e))},u=function(e){return e.map(e=>{let t=b(this,n,"m",a).call(this,e);if(t instanceof E){let e=t.rootNodeId;return b(t,n,"m",a).call(t,e)}return t})},c=function(e){return[e,this._incrementor.next].join(this._nodeKeyDelimiter)},d=function(e){if(e===this._rootNodeId)return this._rootNodeId;if(!e)throw new I.DirectedGraphError(`Could not derive parent nodeId from '${e}'.`);let t="";if(""===(t=e.split(this._nodeKeyDelimiter).slice(0,-1).join(this._nodeKeyDelimiter)))throw new I.DirectedGraphError(`Could not derive parent nodeId from '${e}'.`);return t},h=function(e){let t=F(e,"");return this.filterIds(e=>t.test(e)&&!this.isSubtree(e))},f=function(e){return 0===this.getDescendantNodeIds(e).length},p=function(e,t){b(this,n,"m",v).call(this,t,b(this,n,"m",a).call(this,e)),this.removeSingleNode(e)},g=function(e,t){if(this.isRoot(e)&&t instanceof E)throw new I.DirectedGraphError("Can not replace root with subtree.");this._nodeDictionary[e]={nodeContent:t}},v=function(e,t){this._nodeDictionary[e]={nodeContent:t}},m=function e(t,r=this._rootNodeId,i=this._rootNodeId){let o=b(this,n,"m",l).call(this,r,t.includeSubtrees),s=b(this,n,"m",a).call(this,r);t.includeSubtrees&&s instanceof E?b(s,n,"m",e).call(s,t):t.visit(r,s,i),o.forEach(i=>{b(this,n,"m",e).call(this,t,i,r)})},y=function e(t,r=this._rootNodeId){this.getDescendantNodeIds(r,t.includeSubtrees).filter(e=>b(this,n,"m",f).call(this,e)).forEach(r=>{let i=this.getParentNodeId(r),o=b(this,n,"m",a).call(this,r);o instanceof E?b(o,n,"m",e).call(o,t):t.visit(r,o,i)})},_=function e(t,r,i=C,o={}){let s=this.getChildContentAt(t);return s instanceof E?(Object.entries(s.toPojoAt(s.rootNodeId)).forEach(([e,t])=>{o[e]=t}),o[t]={nodeType:[E.SubtreeNodeTypeName,s.SubtreeNodeTypeName].join(":"),nodeContent:s.getChildContentAt(s.rootNodeId),parentId:r}):(o[t]={parentId:r,nodeContent:i(s)},b(this,n,"m",l).call(this,t,E.SHOULD_INCLUDE_SUBTREES).forEach(r=>{b(this,n,"m",e).call(this,r,t,i,o)})),o},E.EmptyNode=null,E.SubtreeNodeTypeName="subtree",E.SHOULD_INCLUDE_SUBTREES=!0},9159:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DirectedGraphError=void 0;class r extends Error{constructor(e){super(e),this._code="ERR_DIRECTED_GRAPH",this.name=this._code}get code(){return this._code}}t.DirectedGraphError=r},4418:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.DirectedGraphError=void 0;var n=r(9159);Object.defineProperty(t,"DirectedGraphError",{enumerable:!0,get:function(){return n.DirectedGraphError}})},958:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Incrementor=void 0;class r{constructor(){this._counter=0}get next(){return this._counter++}}t.Incrementor=r},4745:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Incrementor=void 0;var n=r(958);Object.defineProperty(t,"Incrementor",{enumerable:!0,get:function(){return n.Incrementor}})},8677:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.KeyStore=void 0;let n=r(7466),i=r(2954);class o{constructor(){this._keyStore={}}allKeys(){return Object.keys(this._keyStore)}getValue(e){return this._keyStore[e]}keyExists(e){return e in this._keyStore}keyExistsOrThrow(e){if(!this.keyExists(e))throw new i.KeyStoreError(`Key: '${e}' does not exist in store.`);return!0}putValue(e,t=n.v4()){if(this.keyExists(t))throw new i.KeyStoreError("Tried to overwrite value, key already exists in store. (use .replaceValue).");return this._keyStore[t]=e,t}removeKey(e){this.keyExistsOrThrow(e),delete this._keyStore[e]}replaceValue(e,t){this.keyExistsOrThrow(t),this._keyStore[t]=e}reverseLookUp(e){return Object.entries(this._keyStore).filter(([t,r])=>Object.is(e,r)).map(([e,t])=>e)}reverseLookUpExactlyOneOrThrow(e){let t=this.reverseLookUp(e);if(1!==t.length)throw new i.KeyStoreError(`Key: '${e}' has ${t.length} matches. Can not determine 1:1 mapping.`);return t[0]}swapValues(e,t){let r=this.getValue(e),n=this.getValue(t);this.replaceValue(n,e),this.replaceValue(r,t)}}t.KeyStore=o},2954:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.KeyStoreError=void 0;class r extends Error{constructor(e){super(e),this._code="ERR_KEY_STORE",this.name=this._code}get code(){return this._code}}t.KeyStoreError=r},4218:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isUUIDv4=void 0;let n=r(2465);t.isUUIDv4=e=>n.regExpUUIDv4.test(e)},2465:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.regExpUUIDv4=void 0,t.regExpUUIDv4=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/},7975:function(e,t,r){var n,i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.treeToPojoAt=t.treeToPojo=t.getNodeContent=t.createSubtree=t.reRootTree=t.cloneTreeFrom=t.cloneTree=t.SafeAPI=t.pojoUtilities=t.treeUtils=t.KeyStoreError=t.KeyStore=t.Incrementor=t.isUUIDv4=t.DirectedGraphError=t.GenericDirectedGraph=t.AbstractDirectedGraph=t.AbstractTree=t.AbstractObfuscatedExpressionTree=t.GenericExpressionTree=t.AbstractExpressionTree=void 0;var o=r(119);Object.defineProperty(t,"AbstractExpressionTree",{enumerable:!0,get:function(){return o.AbstractExpressionTree}}),Object.defineProperty(t,"GenericExpressionTree",{enumerable:!0,get:function(){return o.GenericExpressionTree}});var s=r(1947);Object.defineProperty(t,"AbstractObfuscatedExpressionTree",{enumerable:!0,get:function(){return s.AbstractObfuscatedExpressionTree}});var a=r(2359);Object.defineProperty(t,"AbstractTree",{enumerable:!0,get:function(){return a.AbstractTree}});var l=r(9746);Object.defineProperty(t,"AbstractDirectedGraph",{enumerable:!0,get:function(){return l.AbstractDirectedGraph}}),Object.defineProperty(t,"GenericDirectedGraph",{enumerable:!0,get:function(){return l.GenericDirectedGraph}});var u=r(9159);Object.defineProperty(t,"DirectedGraphError",{enumerable:!0,get:function(){return u.DirectedGraphError}});var c=r(4218);Object.defineProperty(t,"isUUIDv4",{enumerable:!0,get:function(){return c.isUUIDv4}});var d=r(958);Object.defineProperty(t,"Incrementor",{enumerable:!0,get:function(){return d.Incrementor}});var h=r(8677);Object.defineProperty(t,"KeyStore",{enumerable:!0,get:function(){return h.KeyStore}});var f=r(2954);Object.defineProperty(t,"KeyStoreError",{enumerable:!0,get:function(){return f.KeyStoreError}});var p=r(767);Object.defineProperty(t,"treeUtils",{enumerable:!0,get:function(){return i(p).default}});var g=r(767);Object.defineProperty(t,"pojoUtilities",{enumerable:!0,get:function(){return i(g).default}});let v=r(119);(n=t.SafeAPI||(t.SafeAPI={})).createGenericTree=function(e,t){return v.GenericExpressionTree.fromPojo(e,t)},n.createAbstractTree=function(e,t){return v.AbstractExpressionTree.fromPojo(e,t)},t.cloneTree=function(e){return e.cloneAt(e.rootNodeId)},t.cloneTreeFrom=function(e,t){return e.cloneAt(t)},t.reRootTree=function(e,t,r){return v.AbstractExpressionTree.reRootTreeAt(e,t,r)},t.createSubtree=function(e,t){return e.createSubtreeAt(t)},t.getNodeContent=function(e,t){return e.getChildContentAt(t)},t.treeToPojo=function(e){return e.toPojoAt()},t.treeToPojoAt=function(e,t){return e.toPojoAt(t)}},7466:function(e,t,r){r.r(t),r.d(t,{NIL:function(){return M},parse:function(){return v},stringify:function(){return h},v1:function(){return g},v3:function(){return N},v4:function(){return F},v5:function(){return T},validate:function(){return u},version:function(){return S}});var n,i,o,s=new Uint8Array(16);function a(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(s)}for(var l=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,u=function(e){return"string"==typeof e&&l.test(e)},c=[],d=0;d<256;++d)c.push((d+256).toString(16).substr(1));var h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!u(r))throw TypeError("Stringified UUID is invalid");return r},f=0,p=0,g=function(e,t,r){var n=t&&r||0,s=t||Array(16),l=(e=e||{}).node||i,u=void 0!==e.clockseq?e.clockseq:o;if(null==l||null==u){var c=e.random||(e.rng||a)();null==l&&(l=i=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==u&&(u=o=(c[6]<<8|c[7])&16383)}var d=void 0!==e.msecs?e.msecs:Date.now(),g=void 0!==e.nsecs?e.nsecs:p+1,v=d-f+(g-p)/1e4;if(v<0&&void 0===e.clockseq&&(u=u+1&16383),(v<0||d>f)&&void 0===e.nsecs&&(g=0),g>=1e4)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");f=d,p=g,o=u;var m=((268435455&(d+=122192928e5))*1e4+g)%4294967296;s[n++]=m>>>24&255,s[n++]=m>>>16&255,s[n++]=m>>>8&255,s[n++]=255&m;var y=d/4294967296*1e4&268435455;s[n++]=y>>>8&255,s[n++]=255&y,s[n++]=y>>>24&15|16,s[n++]=y>>>16&255,s[n++]=u>>>8|128,s[n++]=255&u;for(var _=0;_<6;++_)s[n+_]=l[_];return t||h(s)},v=function(e){if(!u(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r};function m(e,t,r){function n(e,n,i,o){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof n&&(n=v(n)),16!==n.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var s=new Uint8Array(16+e.length);if(s.set(n),s.set(e,n.length),(s=r(s))[6]=15&s[6]|t,s[8]=63&s[8]|128,i){o=o||0;for(var a=0;a<16;++a)i[o+a]=s[a];return i}return h(s)}try{n.name=e}catch(e){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n}function y(e){return(e+64>>>9<<4)+14+1}function _(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function b(e,t,r,n,i,o){var s;return _((s=_(_(t,e),_(n,o)))<<i|s>>>32-i,r)}function I(e,t,r,n,i,o,s){return b(t&r|~t&n,e,t,i,o,s)}function w(e,t,r,n,i,o,s){return b(t&n|r&~n,e,t,i,o,s)}function O(e,t,r,n,i,o,s){return b(t^r^n,e,t,i,o,s)}function C(e,t,r,n,i,o,s){return b(r^(t|~n),e,t,i,o,s)}var N=m("v3",48,function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){for(var t=[],r=32*e.length,n="0123456789abcdef",i=0;i<r;i+=8){var o=e[i>>5]>>>i%32&255,s=parseInt(n.charAt(o>>>4&15)+n.charAt(15&o),16);t.push(s)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[y(t)-1]=t;for(var r=1732584193,n=-271733879,i=-1732584194,o=271733878,s=0;s<e.length;s+=16){var a=r,l=n,u=i,c=o;r=I(r,n,i,o,e[s],7,-680876936),o=I(o,r,n,i,e[s+1],12,-389564586),i=I(i,o,r,n,e[s+2],17,606105819),n=I(n,i,o,r,e[s+3],22,-1044525330),r=I(r,n,i,o,e[s+4],7,-176418897),o=I(o,r,n,i,e[s+5],12,1200080426),i=I(i,o,r,n,e[s+6],17,-1473231341),n=I(n,i,o,r,e[s+7],22,-45705983),r=I(r,n,i,o,e[s+8],7,1770035416),o=I(o,r,n,i,e[s+9],12,-1958414417),i=I(i,o,r,n,e[s+10],17,-42063),n=I(n,i,o,r,e[s+11],22,-1990404162),r=I(r,n,i,o,e[s+12],7,1804603682),o=I(o,r,n,i,e[s+13],12,-40341101),i=I(i,o,r,n,e[s+14],17,-1502002290),n=I(n,i,o,r,e[s+15],22,1236535329),r=w(r,n,i,o,e[s+1],5,-165796510),o=w(o,r,n,i,e[s+6],9,-1069501632),i=w(i,o,r,n,e[s+11],14,643717713),n=w(n,i,o,r,e[s],20,-373897302),r=w(r,n,i,o,e[s+5],5,-701558691),o=w(o,r,n,i,e[s+10],9,38016083),i=w(i,o,r,n,e[s+15],14,-660478335),n=w(n,i,o,r,e[s+4],20,-405537848),r=w(r,n,i,o,e[s+9],5,568446438),o=w(o,r,n,i,e[s+14],9,-1019803690),i=w(i,o,r,n,e[s+3],14,-187363961),n=w(n,i,o,r,e[s+8],20,1163531501),r=w(r,n,i,o,e[s+13],5,-1444681467),o=w(o,r,n,i,e[s+2],9,-51403784),i=w(i,o,r,n,e[s+7],14,1735328473),n=w(n,i,o,r,e[s+12],20,-1926607734),r=O(r,n,i,o,e[s+5],4,-378558),o=O(o,r,n,i,e[s+8],11,-2022574463),i=O(i,o,r,n,e[s+11],16,1839030562),n=O(n,i,o,r,e[s+14],23,-35309556),r=O(r,n,i,o,e[s+1],4,-1530992060),o=O(o,r,n,i,e[s+4],11,1272893353),i=O(i,o,r,n,e[s+7],16,-155497632),n=O(n,i,o,r,e[s+10],23,-1094730640),r=O(r,n,i,o,e[s+13],4,681279174),o=O(o,r,n,i,e[s],11,-358537222),i=O(i,o,r,n,e[s+3],16,-722521979),n=O(n,i,o,r,e[s+6],23,76029189),r=O(r,n,i,o,e[s+9],4,-640364487),o=O(o,r,n,i,e[s+12],11,-421815835),i=O(i,o,r,n,e[s+15],16,530742520),n=O(n,i,o,r,e[s+2],23,-995338651),r=C(r,n,i,o,e[s],6,-198630844),o=C(o,r,n,i,e[s+7],10,1126891415),i=C(i,o,r,n,e[s+14],15,-1416354905),n=C(n,i,o,r,e[s+5],21,-57434055),r=C(r,n,i,o,e[s+12],6,1700485571),o=C(o,r,n,i,e[s+3],10,-1894986606),i=C(i,o,r,n,e[s+10],15,-1051523),n=C(n,i,o,r,e[s+1],21,-2054922799),r=C(r,n,i,o,e[s+8],6,1873313359),o=C(o,r,n,i,e[s+15],10,-30611744),i=C(i,o,r,n,e[s+6],15,-1560198380),n=C(n,i,o,r,e[s+13],21,1309151649),r=C(r,n,i,o,e[s+4],6,-145523070),o=C(o,r,n,i,e[s+11],10,-1120210379),i=C(i,o,r,n,e[s+2],15,718787259),n=C(n,i,o,r,e[s+9],21,-343485551),r=_(r,a),n=_(n,l),i=_(i,u),o=_(o,c)}return[r,n,i,o]}(function(e){if(0===e.length)return[];for(var t=8*e.length,r=new Uint32Array(y(t)),n=0;n<t;n+=8)r[n>>5]|=(255&e[n/8])<<n%32;return r}(e),8*e.length))}),F=function(e,t,r){var n=(e=e||{}).random||(e.rng||a)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return h(n)};function E(e,t){return e<<t|e>>>32-t}var T=m("v5",80,function(e){var t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var n=unescape(encodeURIComponent(e));e=[];for(var i=0;i<n.length;++i)e.push(n.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var o=Math.ceil((e.length/4+2)/16),s=Array(o),a=0;a<o;++a){for(var l=new Uint32Array(16),u=0;u<16;++u)l[u]=e[64*a+4*u]<<24|e[64*a+4*u+1]<<16|e[64*a+4*u+2]<<8|e[64*a+4*u+3];s[a]=l}s[o-1][14]=(e.length-1)*8/4294967296,s[o-1][14]=Math.floor(s[o-1][14]),s[o-1][15]=(e.length-1)*8&4294967295;for(var c=0;c<o;++c){for(var d=new Uint32Array(80),h=0;h<16;++h)d[h]=s[c][h];for(var f=16;f<80;++f)d[f]=E(d[f-3]^d[f-8]^d[f-14]^d[f-16],1);for(var p=r[0],g=r[1],v=r[2],m=r[3],y=r[4],_=0;_<80;++_){var b=Math.floor(_/20),I=E(p,5)+function(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:case 3:return t^r^n;case 2:return t&r^t&n^r&n}}(b,g,v,m)+y+t[b]+d[_]>>>0;y=m,m=v,v=E(g,30)>>>0,g=p,p=I}r[0]=r[0]+p>>>0,r[1]=r[1]+g>>>0,r[2]=r[2]+v>>>0,r[3]=r[3]+m>>>0,r[4]=r[4]+y>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}),M="00000000-0000-0000-0000-000000000000",S=function(e){if(!u(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}},6528:function(e,t,r){function n(){}function i(e){return null==e?n:function(){return this.querySelector(e)}}function o(){return[]}function s(e){return null==e?o:function(){return this.querySelectorAll(e)}}function a(e){return function(){return this.matches(e)}}function l(e){return function(t){return t.matches(e)}}r.d(t,{ohM:function(){return tT},wqt:function(){return tM},Fsl:function(){return tL},q5i:function(){return tq},A4v:function(){return tV},bT9:function(){return tH},rRh:function(){return ru},Ys:function(){return tp},G_s:function(){return t3},sPX:function(){return rN},CRH:function(){return rg},P2S:function(){return rv}});var u,c=Array.prototype.find;function d(){return this.firstElementChild}var h=Array.prototype.filter;function f(){return Array.from(this.children)}function p(e){return Array(e.length)}function g(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function v(e,t,r,n,i,o){for(var s,a=0,l=t.length,u=o.length;a<u;++a)(s=t[a])?(s.__data__=o[a],n[a]=s):r[a]=new g(e,o[a]);for(;a<l;++a)(s=t[a])&&(i[a]=s)}function m(e,t,r,n,i,o,s){var a,l,u,c=new Map,d=t.length,h=o.length,f=Array(d);for(a=0;a<d;++a)(l=t[a])&&(f[a]=u=s.call(l,l.__data__,a,t)+"",c.has(u)?i[a]=l:c.set(u,l));for(a=0;a<h;++a)u=s.call(e,o[a],a,o)+"",(l=c.get(u))?(n[a]=l,l.__data__=o[a],c.delete(u)):r[a]=new g(e,o[a]);for(a=0;a<d;++a)(l=t[a])&&c.get(f[a])===l&&(i[a]=l)}function y(e){return e.__data__}function _(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}g.prototype={constructor:g,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var b="http://www.w3.org/1999/xhtml",I={svg:"http://www.w3.org/2000/svg",xhtml:b,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function w(e){var t=e+="",r=t.indexOf(":");return r>=0&&"xmlns"!==(t=e.slice(0,r))&&(e=e.slice(r+1)),I.hasOwnProperty(t)?{space:I[t],local:e}:e}function O(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function C(e,t){return e.style.getPropertyValue(t)||O(e).getComputedStyle(e,null).getPropertyValue(t)}function N(e){return e.trim().split(/^|\s+/)}function F(e){return e.classList||new E(e)}function E(e){this._node=e,this._names=N(e.getAttribute("class")||"")}function T(e,t){for(var r=F(e),n=-1,i=t.length;++n<i;)r.add(t[n])}function M(e,t){for(var r=F(e),n=-1,i=t.length;++n<i;)r.remove(t[n])}function S(){this.textContent=""}function x(){this.innerHTML=""}function A(){this.nextSibling&&this.parentNode.appendChild(this)}function k(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function L(e){var t=w(e);return(t.local?function(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}:function(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===b&&t.documentElement.namespaceURI===b?t.createElement(e):t.createElementNS(r,e)}})(t)}function j(){return null}function P(){var e=this.parentNode;e&&e.removeChild(this)}function R(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function D(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function $(e){return function(){var t=this.__on;if(t){for(var r,n=0,i=-1,o=t.length;n<o;++n)(r=t[n],e.type&&r.type!==e.type||r.name!==e.name)?t[++i]=r:this.removeEventListener(r.type,r.listener,r.options);++i?t.length=i:delete this.__on}}}function J(e,t,r){return function(){var n,i=this.__on,o=function(e){t.call(this,e,this.__data__)};if(i){for(var s=0,a=i.length;s<a;++s)if((n=i[s]).type===e.type&&n.name===e.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=o,n.options=r),n.value=t;return}}this.addEventListener(e.type,o,r),n={type:e.type,name:e.name,value:t,listener:o,options:r},i?i.push(n):this.__on=[n]}}function G(e,t,r){var n=O(e),i=n.CustomEvent;"function"==typeof i?i=new i(t,r):(i=n.document.createEvent("Event"),r?(i.initEvent(t,r.bubbles,r.cancelable),i.detail=r.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}E.prototype={add:function(e){0>this._names.indexOf(e)&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var z=[null];function U(e,t){this._groups=e,this._parents=t}function B(){return new U([[document.documentElement]],z)}U.prototype=B.prototype={constructor:U,select:function(e){"function"!=typeof e&&(e=i(e));for(var t=this._groups,r=t.length,n=Array(r),o=0;o<r;++o)for(var s,a,l=t[o],u=l.length,c=n[o]=Array(u),d=0;d<u;++d)(s=l[d])&&(a=e.call(s,s.__data__,d,l))&&("__data__"in s&&(a.__data__=s.__data__),c[d]=a);return new U(n,this._parents)},selectAll:function(e){if("function"==typeof e){var t;t=e,e=function(){var e;return e=t.apply(this,arguments),null==e?[]:Array.isArray(e)?e:Array.from(e)}}else e=s(e);for(var r=this._groups,n=r.length,i=[],o=[],a=0;a<n;++a)for(var l,u=r[a],c=u.length,d=0;d<c;++d)(l=u[d])&&(i.push(e.call(l,l.__data__,d,u)),o.push(l));return new U(i,o)},selectChild:function(e){var t;return this.select(null==e?d:(t="function"==typeof e?e:l(e),function(){return c.call(this.children,t)}))},selectChildren:function(e){var t;return this.selectAll(null==e?f:(t="function"==typeof e?e:l(e),function(){return h.call(this.children,t)}))},filter:function(e){"function"!=typeof e&&(e=a(e));for(var t=this._groups,r=t.length,n=Array(r),i=0;i<r;++i)for(var o,s=t[i],l=s.length,u=n[i]=[],c=0;c<l;++c)(o=s[c])&&e.call(o,o.__data__,c,s)&&u.push(o);return new U(n,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,y);var r=t?m:v,n=this._parents,i=this._groups;"function"!=typeof e&&(I=e,e=function(){return I});for(var o=i.length,s=Array(o),a=Array(o),l=Array(o),u=0;u<o;++u){var c=n[u],d=i[u],h=d.length,f="object"==typeof(b=e.call(c,c&&c.__data__,u,n))&&"length"in b?b:Array.from(b),p=f.length,g=a[u]=Array(p),_=s[u]=Array(p);r(c,d,g,_,l[u]=Array(h),f,t);for(var b,I,w,O,C=0,N=0;C<p;++C)if(w=g[C]){for(C>=N&&(N=C+1);!(O=_[N])&&++N<p;);w._next=O||null}}return(s=new U(s,n))._enter=a,s._exit=l,s},enter:function(){return new U(this._enter||this._groups.map(p),this._parents)},exit:function(){return new U(this._exit||this._groups.map(p),this._parents)},join:function(e,t,r){var n=this.enter(),i=this,o=this.exit();return"function"==typeof e?(n=e(n))&&(n=n.selection()):n=n.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==r?o.remove():r(o),n&&i?n.merge(i).order():i},merge:function(e){for(var t=e.selection?e.selection():e,r=this._groups,n=t._groups,i=r.length,o=n.length,s=Math.min(i,o),a=Array(i),l=0;l<s;++l)for(var u,c=r[l],d=n[l],h=c.length,f=a[l]=Array(h),p=0;p<h;++p)(u=c[p]||d[p])&&(f[p]=u);for(;l<i;++l)a[l]=r[l];return new U(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var n,i=e[t],o=i.length-1,s=i[o];--o>=0;)(n=i[o])&&(s&&4^n.compareDocumentPosition(s)&&s.parentNode.insertBefore(n,s),s=n);return this},sort:function(e){function t(t,r){return t&&r?e(t.__data__,r.__data__):!t-!r}e||(e=_);for(var r=this._groups,n=r.length,i=Array(n),o=0;o<n;++o){for(var s,a=r[o],l=a.length,u=i[o]=Array(l),c=0;c<l;++c)(s=a[c])&&(u[c]=s);u.sort(t)}return new U(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n=e[t],i=0,o=n.length;i<o;++i){var s=n[i];if(s)return s}return null},size:function(){let e=0;for(let t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,r=0,n=t.length;r<n;++r)for(var i,o=t[r],s=0,a=o.length;s<a;++s)(i=o[s])&&e.call(i,i.__data__,s,o);return this},attr:function(e,t){var r=w(e);if(arguments.length<2){var n=this.node();return r.local?n.getAttributeNS(r.space,r.local):n.getAttribute(r)}return this.each((null==t?r.local?function(e){return function(){this.removeAttributeNS(e.space,e.local)}}:function(e){return function(){this.removeAttribute(e)}}:"function"==typeof t?r.local?function(e,t){return function(){var r=t.apply(this,arguments);null==r?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}:function(e,t){return function(){var r=t.apply(this,arguments);null==r?this.removeAttribute(e):this.setAttribute(e,r)}}:r.local?function(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}:function(e,t){return function(){this.setAttribute(e,t)}})(r,t))},style:function(e,t,r){return arguments.length>1?this.each((null==t?function(e){return function(){this.style.removeProperty(e)}}:"function"==typeof t?function(e,t,r){return function(){var n=t.apply(this,arguments);null==n?this.style.removeProperty(e):this.style.setProperty(e,n,r)}}:function(e,t,r){return function(){this.style.setProperty(e,t,r)}})(e,t,null==r?"":r)):C(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?function(e){return function(){delete this[e]}}:"function"==typeof t?function(e,t){return function(){var r=t.apply(this,arguments);null==r?delete this[e]:this[e]=r}}:function(e,t){return function(){this[e]=t}})(e,t)):this.node()[e]},classed:function(e,t){var r=N(e+"");if(arguments.length<2){for(var n=F(this.node()),i=-1,o=r.length;++i<o;)if(!n.contains(r[i]))return!1;return!0}return this.each(("function"==typeof t?function(e,t){return function(){(t.apply(this,arguments)?T:M)(this,e)}}:t?function(e){return function(){T(this,e)}}:function(e){return function(){M(this,e)}})(r,t))},text:function(e){return arguments.length?this.each(null==e?S:("function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}:function(e){return function(){this.textContent=e}})(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?x:("function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}:function(e){return function(){this.innerHTML=e}})(e)):this.node().innerHTML},raise:function(){return this.each(A)},lower:function(){return this.each(k)},append:function(e){var t="function"==typeof e?e:L(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var r="function"==typeof e?e:L(e),n=null==t?j:"function"==typeof t?t:i(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),n.apply(this,arguments)||null)})},remove:function(){return this.each(P)},clone:function(e){return this.select(e?D:R)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,r){var n,i,o=(e+"").trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}}),s=o.length;if(arguments.length<2){var a=this.node().__on;if(a){for(var l,u=0,c=a.length;u<c;++u)for(n=0,l=a[u];n<s;++n)if((i=o[n]).type===l.type&&i.name===l.name)return l.value}return}for(n=0,a=t?J:$;n<s;++n)this.each(a(o[n],t,r));return this},dispatch:function(e,t){return this.each(("function"==typeof t?function(e,t){return function(){return G(this,e,t.apply(this,arguments))}}:function(e,t){return function(){return G(this,e,t)}})(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var n,i=e[t],o=0,s=i.length;o<s;++o)(n=i[o])&&(yield n)}};var W={value:()=>{}};function V(){for(var e,t=0,r=arguments.length,n={};t<r;++t){if(!(e=arguments[t]+"")||e in n||/[\s.]/.test(e))throw Error("illegal type: "+e);n[e]=[]}return new q(n)}function q(e){this._=e}function K(e,t,r){for(var n=0,i=e.length;n<i;++n)if(e[n].name===t){e[n]=W,e=e.slice(0,n).concat(e.slice(n+1));break}return null!=r&&e.push({name:t,value:r}),e}q.prototype=V.prototype={constructor:q,on:function(e,t){var r,n=this._,i=(e+"").trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");if(r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),e&&!n.hasOwnProperty(e))throw Error("unknown type: "+e);return{type:e,name:t}}),o=-1,s=i.length;if(arguments.length<2){for(;++o<s;)if((r=(e=i[o]).type)&&(r=function(e,t){for(var r,n=0,i=e.length;n<i;++n)if((r=e[n]).name===t)return r.value}(n[r],e.name)))return r;return}if(null!=t&&"function"!=typeof t)throw Error("invalid callback: "+t);for(;++o<s;)if(r=(e=i[o]).type)n[r]=K(n[r],e.name,t);else if(null==t)for(r in n)n[r]=K(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new q(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var r,n,i=Array(r),o=0;o<r;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw Error("unknown type: "+e);for(n=this._[e],o=0,r=n.length;o<r;++o)n[o].value.apply(t,i)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw Error("unknown type: "+e);for(var n=this._[e],i=0,o=n.length;i<o;++i)n[i].value.apply(t,r)}};var H,Y,X=0,Q=0,Z=0,ee=0,et=0,er=0,en="object"==typeof performance&&performance.now?performance:Date,ei="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function eo(){return et||(ei(es),et=en.now()+er)}function es(){et=0}function ea(){this._call=this._time=this._next=null}function el(e,t,r){var n=new ea;return n.restart(e,t,r),n}function eu(){et=(ee=en.now())+er,X=Q=0;try{!function(){eo(),++X;for(var e,t=H;t;)(e=et-t._time)>=0&&t._call.call(void 0,e),t=t._next;--X}()}finally{X=0,function(){for(var e,t,r=H,n=1/0;r;)r._call?(n>r._time&&(n=r._time),e=r,r=r._next):(t=r._next,r._next=null,r=e?e._next=t:H=t);Y=e,ed(n)}(),et=0}}function ec(){var e=en.now(),t=e-ee;t>1e3&&(er-=t,ee=e)}function ed(e){!X&&(Q&&(Q=clearTimeout(Q)),e-et>24?(e<1/0&&(Q=setTimeout(eu,e-en.now()-er)),Z&&(Z=clearInterval(Z))):(Z||(ee=en.now(),Z=setInterval(ec,1e3)),X=1,ei(eu)))}function eh(e,t,r){var n=new ea;return t=null==t?0:+t,n.restart(r=>{n.stop(),e(r+t)},t,r),n}ea.prototype=el.prototype={constructor:ea,restart:function(e,t,r){if("function"!=typeof e)throw TypeError("callback is not a function");r=(null==r?eo():+r)+(null==t?0:+t),this._next||Y===this||(Y?Y._next=this:H=this,Y=this),this._call=e,this._time=r,ed()},stop:function(){this._call&&(this._call=null,this._time=1/0,ed())}};var ef=V("start","end","cancel","interrupt"),ep=[];function eg(e,t,r,n,i,o){var s=e.__transition;if(s){if(r in s)return}else e.__transition={};!function(e,t,r){var n,i=e.__transition;function o(l){var u,c,d,h;if(1!==r.state)return a();for(u in i)if((h=i[u]).name===r.name){if(3===h.state)return eh(o);4===h.state?(h.state=6,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete i[u]):+u<t&&(h.state=6,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete i[u])}if(eh(function(){3===r.state&&(r.state=4,r.timer.restart(s,r.delay,r.time),s(l))}),r.state=2,r.on.call("start",e,e.__data__,r.index,r.group),2===r.state){for(u=0,r.state=3,n=Array(d=r.tween.length),c=-1;u<d;++u)(h=r.tween[u].value.call(e,e.__data__,r.index,r.group))&&(n[++c]=h);n.length=c+1}}function s(t){for(var i=t<r.duration?r.ease.call(null,t/r.duration):(r.timer.restart(a),r.state=5,1),o=-1,s=n.length;++o<s;)n[o].call(e,i);5===r.state&&(r.on.call("end",e,e.__data__,r.index,r.group),a())}function a(){for(var n in r.state=6,r.timer.stop(),delete i[t],i)return;delete e.__transition}i[t]=r,r.timer=el(function(e){r.state=1,r.timer.restart(o,r.delay,r.time),r.delay<=e&&o(e-r.delay)},0,r.time)}(e,r,{name:t,index:n,group:i,on:ef,tween:ep,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})}function ev(e,t){var r=ey(e,t);if(r.state>0)throw Error("too late; already scheduled");return r}function em(e,t){var r=ey(e,t);if(r.state>3)throw Error("too late; already running");return r}function ey(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw Error("transition not found");return r}function e_(e,t){var r,n,i,o=e.__transition,s=!0;if(o){for(i in t=null==t?null:t+"",o){if((r=o[i]).name!==t){s=!1;continue}n=r.state>2&&r.state<5,r.state=6,r.timer.stop(),r.on.call(n?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete o[i]}s&&delete e.__transition}}function eb(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}var eI=180/Math.PI,ew={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function eO(e,t,r,n,i,o){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*r+t*n)&&(r-=e*l,n-=t*l),(a=Math.sqrt(r*r+n*n))&&(r/=a,n/=a,l/=a),e*n<t*r&&(e=-e,t=-t,l=-l,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(t,e)*eI,skewX:Math.atan(l)*eI,scaleX:s,scaleY:a}}function eC(e,t,r,n){function i(e){return e.length?e.pop()+" ":""}return function(o,s){var a,l,u,c,d=[],h=[];return o=e(o),s=e(s),!function(e,n,i,o,s,a){if(e!==i||n!==o){var l=s.push("translate(",null,t,null,r);a.push({i:l-4,x:eb(e,i)},{i:l-2,x:eb(n,o)})}else(i||o)&&s.push("translate("+i+t+o+r)}(o.translateX,o.translateY,s.translateX,s.translateY,d,h),(a=o.rotate)!==(l=s.rotate)?(a-l>180?l+=360:l-a>180&&(a+=360),h.push({i:d.push(i(d)+"rotate(",null,n)-2,x:eb(a,l)})):l&&d.push(i(d)+"rotate("+l+n),(u=o.skewX)!==(c=s.skewX)?h.push({i:d.push(i(d)+"skewX(",null,n)-2,x:eb(u,c)}):c&&d.push(i(d)+"skewX("+c+n),!function(e,t,r,n,o,s){if(e!==r||t!==n){var a=o.push(i(o)+"scale(",null,",",null,")");s.push({i:a-4,x:eb(e,r)},{i:a-2,x:eb(t,n)})}else(1!==r||1!==n)&&o.push(i(o)+"scale("+r+","+n+")")}(o.scaleX,o.scaleY,s.scaleX,s.scaleY,d,h),o=s=null,function(e){for(var t,r=-1,n=h.length;++r<n;)d[(t=h[r]).i]=t.x(e);return d.join("")}}}var eN=eC(function(e){let t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?ew:eO(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),eF=eC(function(e){return null==e?ew:(u||(u=document.createElementNS("http://www.w3.org/2000/svg","g")),u.setAttribute("transform",e),e=u.transform.baseVal.consolidate())?eO((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):ew},", ",")",")");function eE(e,t,r){var n=e._id;return e.each(function(){var e=em(this,n);(e.value||(e.value={}))[t]=r.apply(this,arguments)}),function(e){return ey(e,n).value[t]}}function eT(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function eM(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function eS(){}var ex="\\s*([+-]?\\d+)\\s*",eA="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ek="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",eL=/^#([0-9a-f]{3,8})$/,ej=RegExp(`^rgb\\(${ex},${ex},${ex}\\)$`),eP=RegExp(`^rgb\\(${ek},${ek},${ek}\\)$`),eR=RegExp(`^rgba\\(${ex},${ex},${ex},${eA}\\)$`),eD=RegExp(`^rgba\\(${ek},${ek},${ek},${eA}\\)$`),e$=RegExp(`^hsl\\(${eA},${ek},${ek}\\)$`),eJ=RegExp(`^hsla\\(${eA},${ek},${ek},${eA}\\)$`),eG={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ez(){return this.rgb().formatHex()}function eU(){return this.rgb().formatRgb()}function eB(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=eL.exec(e))?(r=t[1].length,t=parseInt(t[1],16),6===r?eW(t):3===r?new eK(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===r?eV(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===r?eV(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=ej.exec(e))?new eK(t[1],t[2],t[3],1):(t=eP.exec(e))?new eK(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=eR.exec(e))?eV(t[1],t[2],t[3],t[4]):(t=eD.exec(e))?eV(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=e$.exec(e))?e0(t[1],t[2]/100,t[3]/100,1):(t=eJ.exec(e))?e0(t[1],t[2]/100,t[3]/100,t[4]):eG.hasOwnProperty(e)?eW(eG[e]):"transparent"===e?new eK(NaN,NaN,NaN,0):null}function eW(e){return new eK(e>>16&255,e>>8&255,255&e,1)}function eV(e,t,r,n){return n<=0&&(e=t=r=NaN),new eK(e,t,r,n)}function eq(e,t,r,n){var i;return 1==arguments.length?((i=e)instanceof eS||(i=eB(i)),i)?new eK((i=i.rgb()).r,i.g,i.b,i.opacity):new eK:new eK(e,t,r,null==n?1:n)}function eK(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}function eH(){return`#${eZ(this.r)}${eZ(this.g)}${eZ(this.b)}`}function eY(){let e=eX(this.opacity);return`${1===e?"rgb(":"rgba("}${eQ(this.r)}, ${eQ(this.g)}, ${eQ(this.b)}${1===e?")":`, ${e})`}`}function eX(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function eQ(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function eZ(e){return((e=eQ(e))<16?"0":"")+e.toString(16)}function e0(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new e2(e,t,r,n)}function e1(e){if(e instanceof e2)return new e2(e.h,e.s,e.l,e.opacity);if(e instanceof eS||(e=eB(e)),!e)return new e2;if(e instanceof e2)return e;var t=(e=e.rgb()).r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),o=Math.max(t,r,n),s=NaN,a=o-i,l=(o+i)/2;return a?(s=t===o?(r-n)/a+(r<n)*6:r===o?(n-t)/a+2:(t-r)/a+4,a/=l<.5?o+i:2-o-i,s*=60):a=l>0&&l<1?0:s,new e2(s,a,l,e.opacity)}function e2(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}function e5(e){return(e=(e||0)%360)<0?e+360:e}function e4(e){return Math.max(0,Math.min(1,e||0))}function e3(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}function e6(e,t,r,n,i){var o=e*e,s=o*e;return((1-3*e+3*o-s)*t+(4-6*o+3*s)*r+(1+3*e+3*o-3*s)*n+s*i)/6}eT(eS,eB,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:ez,formatHex:ez,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return e1(this).formatHsl()},formatRgb:eU,toString:eU}),eT(eK,eq,eM(eS,{brighter(e){return e=null==e?1.4285714285714286:Math.pow(1.4285714285714286,e),new eK(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new eK(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new eK(eQ(this.r),eQ(this.g),eQ(this.b),eX(this.opacity))},displayable(){return -.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:eH,formatHex:eH,formatHex8:function(){return`#${eZ(this.r)}${eZ(this.g)}${eZ(this.b)}${eZ((isNaN(this.opacity)?1:this.opacity)*255)}`},formatRgb:eY,toString:eY})),eT(e2,function(e,t,r,n){return 1==arguments.length?e1(e):new e2(e,t,r,null==n?1:n)},eM(eS,{brighter(e){return e=null==e?1.4285714285714286:Math.pow(1.4285714285714286,e),new e2(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new e2(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new eK(e3(e>=240?e-240:e+120,i,n),e3(e,i,n),e3(e<120?e+240:e-120,i,n),this.opacity)},clamp(){return new e2(e5(this.h),e4(this.s),e4(this.l),eX(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=eX(this.opacity);return`${1===e?"hsl(":"hsla("}${e5(this.h)}, ${100*e4(this.s)}%, ${100*e4(this.l)}%${1===e?")":`, ${e})`}`}}));var e8=e=>()=>e;function e7(e,t){var r=t-e;return r?function(t){return e+t*r}:e8(isNaN(e)?t:e)}var e9=function e(t){var r,n=1==(r=+(r=t))?e7:function(e,t){var n,i,o;return t-e?(n=e,i=t,n=Math.pow(n,o=r),i=Math.pow(i,o)-n,o=1/o,function(e){return Math.pow(n+e*i,o)}):e8(isNaN(e)?t:e)};function i(e,t){var r=n((e=eq(e)).r,(t=eq(t)).r),i=n(e.g,t.g),o=n(e.b,t.b),s=e7(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=o(t),e.opacity=s(t),e+""}}return i.gamma=e,i}(1);function te(e){return function(t){var r,n,i=t.length,o=Array(i),s=Array(i),a=Array(i);for(r=0;r<i;++r)n=eq(t[r]),o[r]=n.r||0,s[r]=n.g||0,a[r]=n.b||0;return o=e(o),s=e(s),a=e(a),n.opacity=1,function(e){return n.r=o(e),n.g=s(e),n.b=a(e),n+""}}}te(function(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),i=e[n],o=e[n+1],s=n>0?e[n-1]:2*i-o,a=n<t-1?e[n+2]:2*o-i;return e6((r-n/t)*t,s,i,o,a)}}),te(function(e){var t=e.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*t),i=e[(n+t-1)%t],o=e[n%t],s=e[(n+1)%t],a=e[(n+2)%t];return e6((r-n/t)*t,i,o,s,a)}});var tt=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,tr=RegExp(tt.source,"g");function tn(e,t){var r;return("number"==typeof t?eb:t instanceof eB?e9:(r=eB(t))?(t=r,e9):function(e,t){var r,n,i,o,s,a=tt.lastIndex=tr.lastIndex=0,l=-1,u=[],c=[];for(e+="",t+="";(i=tt.exec(e))&&(o=tr.exec(t));)(s=o.index)>a&&(s=t.slice(a,s),u[l]?u[l]+=s:u[++l]=s),(i=i[0])===(o=o[0])?u[l]?u[l]+=o:u[++l]=o:(u[++l]=null,c.push({i:l,x:eb(i,o)})),a=tr.lastIndex;return a<t.length&&(s=t.slice(a),u[l]?u[l]+=s:u[++l]=s),u.length<2?c[0]?(r=c[0].x,function(e){return r(e)+""}):(n=t,function(){return n}):(t=c.length,function(e){for(var r,n=0;n<t;++n)u[(r=c[n]).i]=r.x(e);return u.join("")})})(e,t)}var ti=B.prototype.constructor;function to(e){return function(){this.style.removeProperty(e)}}var ts=0;function ta(e,t,r,n){this._groups=e,this._parents=t,this._name=r,this._id=n}var tl=B.prototype;ta.prototype=(function(e){return B().transition(e)}).prototype={constructor:ta,select:function(e){var t=this._name,r=this._id;"function"!=typeof e&&(e=i(e));for(var n=this._groups,o=n.length,s=Array(o),a=0;a<o;++a)for(var l,u,c=n[a],d=c.length,h=s[a]=Array(d),f=0;f<d;++f)(l=c[f])&&(u=e.call(l,l.__data__,f,c))&&("__data__"in l&&(u.__data__=l.__data__),h[f]=u,eg(h[f],t,r,f,h,ey(l,r)));return new ta(s,this._parents,t,r)},selectAll:function(e){var t=this._name,r=this._id;"function"!=typeof e&&(e=s(e));for(var n=this._groups,i=n.length,o=[],a=[],l=0;l<i;++l)for(var u,c=n[l],d=c.length,h=0;h<d;++h)if(u=c[h]){for(var f,p=e.call(u,u.__data__,h,c),g=ey(u,r),v=0,m=p.length;v<m;++v)(f=p[v])&&eg(f,t,r,v,p,g);o.push(p),a.push(u)}return new ta(o,a,t,r)},selectChild:tl.selectChild,selectChildren:tl.selectChildren,filter:function(e){"function"!=typeof e&&(e=a(e));for(var t=this._groups,r=t.length,n=Array(r),i=0;i<r;++i)for(var o,s=t[i],l=s.length,u=n[i]=[],c=0;c<l;++c)(o=s[c])&&e.call(o,o.__data__,c,s)&&u.push(o);return new ta(n,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw Error();for(var t=this._groups,r=e._groups,n=t.length,i=r.length,o=Math.min(n,i),s=Array(n),a=0;a<o;++a)for(var l,u=t[a],c=r[a],d=u.length,h=s[a]=Array(d),f=0;f<d;++f)(l=u[f]||c[f])&&(h[f]=l);for(;a<n;++a)s[a]=t[a];return new ta(s,this._parents,this._name,this._id)},selection:function(){return new ti(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,r=++ts,n=this._groups,i=n.length,o=0;o<i;++o)for(var s,a=n[o],l=a.length,u=0;u<l;++u)if(s=a[u]){var c=ey(s,t);eg(s,e,r,u,a,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new ta(n,this._parents,e,r)},call:tl.call,nodes:tl.nodes,node:tl.node,size:tl.size,empty:tl.empty,each:tl.each,on:function(e,t){var r,n,i,o=this._id;return arguments.length<2?ey(this.node(),o).on.on(e):this.each((i=(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})?ev:em,function(){var s=i(this,o),a=s.on;a!==r&&(n=(r=a).copy()).on(e,t),s.on=n}))},attr:function(e,t){var r=w(e),n="transform"===r?eF:tn;return this.attrTween(e,"function"==typeof t?(r.local?function(e,t,r){var n,i,o;return function(){var s,a,l=r(this);return null==l?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local))===(a=l+"")?null:s===n&&a===i?o:(i=a,o=t(n=s,l))}}:function(e,t,r){var n,i,o;return function(){var s,a,l=r(this);return null==l?void this.removeAttribute(e):(s=this.getAttribute(e))===(a=l+"")?null:s===n&&a===i?o:(i=a,o=t(n=s,l))}})(r,n,eE(this,"attr."+e,t)):null==t?(r.local?function(e){return function(){this.removeAttributeNS(e.space,e.local)}}:function(e){return function(){this.removeAttribute(e)}})(r):(r.local?function(e,t,r){var n,i,o=r+"";return function(){var s=this.getAttributeNS(e.space,e.local);return s===o?null:s===n?i:i=t(n=s,r)}}:function(e,t,r){var n,i,o=r+"";return function(){var s=this.getAttribute(e);return s===o?null:s===n?i:i=t(n=s,r)}})(r,n,t))},attrTween:function(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw Error();var n=w(e);return this.tween(r,(n.local?function(e,t){var r,n;function i(){var i=t.apply(this,arguments);return i!==n&&(r=(n=i)&&function(t){this.setAttributeNS(e.space,e.local,i.call(this,t))}),r}return i._value=t,i}:function(e,t){var r,n;function i(){var i=t.apply(this,arguments);return i!==n&&(r=(n=i)&&function(t){this.setAttribute(e,i.call(this,t))}),r}return i._value=t,i})(n,t))},style:function(e,t,r){var n,i,o,s,a,l,u,c,d,h,f,p,g,v,m,y,_,b,I,w,O,N="transform"==(e+="")?eN:tn;return null==t?this.styleTween(e,(n=e,function(){var e=C(this,n),t=(this.style.removeProperty(n),C(this,n));return e===t?null:e===i&&t===o?s:s=N(i=e,o=t)})).on("end.style."+e,to(e)):"function"==typeof t?this.styleTween(e,(a=e,l=eE(this,"style."+e,t),function(){var e=C(this,a),t=l(this),r=t+"";return null==t&&(this.style.removeProperty(a),r=t=C(this,a)),e===r?null:e===u&&r===c?d:(c=r,d=N(u=e,t))})).each((h=this._id,_="end."+(y="style."+(f=e)),function(){var e=em(this,h),t=e.on,r=null==e.value[y]?m||(m=to(f)):void 0;(t!==p||v!==r)&&(g=(p=t).copy()).on(_,v=r),e.on=g})):this.styleTween(e,(b=e,O=t+"",function(){var e=C(this,b);return e===O?null:e===I?w:w=N(I=e,t)}),r).on("end.style."+e,null)},styleTween:function(e,t,r){var n="style."+(e+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw Error();return this.tween(n,function(e,t,r){var n,i;function o(){var o=t.apply(this,arguments);return o!==i&&(n=(i=o)&&function(t){this.style.setProperty(e,o.call(this,t),r)}),n}return o._value=t,o}(e,t,null==r?"":r))},text:function(e){var t,r;return this.tween("text","function"==typeof e?(t=eE(this,"text",e),function(){var e=t(this);this.textContent=null==e?"":e}):(r=null==e?"":e+"",function(){this.textContent=r}))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw Error();return this.tween(t,function(e){var t,r;function n(){var n=e.apply(this,arguments);return n!==r&&(t=(r=n)&&function(e){this.textContent=n.call(this,e)}),t}return n._value=e,n}(e))},remove:function(){var e;return this.on("end.remove",(e=this._id,function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}))},tween:function(e,t){var r=this._id;if(e+="",arguments.length<2){for(var n,i=ey(this.node(),r).tween,o=0,s=i.length;o<s;++o)if((n=i[o]).name===e)return n.value;return null}return this.each((null==t?function(e,t){var r,n;return function(){var i=em(this,e),o=i.tween;if(o!==r){n=r=o;for(var s=0,a=n.length;s<a;++s)if(n[s].name===t){(n=n.slice()).splice(s,1);break}}i.tween=n}}:function(e,t,r){var n,i;if("function"!=typeof r)throw Error();return function(){var o=em(this,e),s=o.tween;if(s!==n){i=(n=s).slice();for(var a={name:t,value:r},l=0,u=i.length;l<u;++l)if(i[l].name===t){i[l]=a;break}l===u&&i.push(a)}o.tween=i}})(r,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?function(e,t){return function(){ev(this,e).delay=+t.apply(this,arguments)}}:function(e,t){return t=+t,function(){ev(this,e).delay=t}})(t,e)):ey(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?function(e,t){return function(){em(this,e).duration=+t.apply(this,arguments)}}:function(e,t){return t=+t,function(){em(this,e).duration=t}})(t,e)):ey(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw Error();return function(){em(this,e).ease=t}}(t,e)):ey(this.node(),t).ease},easeVarying:function(e){var t;if("function"!=typeof e)throw Error();return this.each((t=this._id,function(){var r=e.apply(this,arguments);if("function"!=typeof r)throw Error();em(this,t).ease=r}))},end:function(){var e,t,r=this,n=r._id,i=r.size();return new Promise(function(o,s){var a={value:s},l={value:function(){0==--i&&o()}};r.each(function(){var r=em(this,n),i=r.on;i!==e&&((t=(e=i).copy())._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),r.on=t}),0===i&&o()})},[Symbol.iterator]:tl[Symbol.iterator]};var tu={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};B.prototype.interrupt=function(e){return this.each(function(){e_(this,e)})},B.prototype.transition=function(e){var t,r;e instanceof ta?(t=e._id,e=e._name):(t=++ts,(r=tu).time=eo(),e=null==e?null:e+"");for(var n=this._groups,i=n.length,o=0;o<i;++o)for(var s,a=n[o],l=a.length,u=0;u<l;++u)(s=a[u])&&eg(s,e,t,u,a,r||function(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw Error(`transition ${t} not found`);return r}(s,t));return new ta(n,this._parents,e,t)};let{abs:tc,max:td,min:th}=Math;function tf(e){return{type:e}}function tp(e){return"string"==typeof e?new U([[document.querySelector(e)]],[document.documentElement]):new U([[e]],z)}function tg(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var r=t.ownerSVGElement||t;if(r.createSVGPoint){var n=r.createSVGPoint();return n.x=e.clientX,n.y=e.clientY,[(n=n.matrixTransform(t.getScreenCTM().inverse())).x,n.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}["w","e"].map(tf),["n","s"].map(tf),["n","w","e","s","nw","ne","sw","se"].map(tf);let tv={passive:!1},tm={capture:!0,passive:!1};function ty(e){e.stopImmediatePropagation()}function t_(e){e.preventDefault(),e.stopImmediatePropagation()}function tb(e){var t=e.document.documentElement,r=tp(e).on("dragstart.drag",t_,tm);"onselectstart"in t?r.on("selectstart.drag",t_,tm):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function tI(e,t){var r=e.document.documentElement,n=tp(e).on("dragstart.drag",null);t&&(n.on("click.drag",t_,tm),setTimeout(function(){n.on("click.drag",null)},0)),"onselectstart"in r?n.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}var tw=e=>()=>e;function tO(e,{sourceEvent:t,subject:r,target:n,identifier:i,active:o,x:s,y:a,dx:l,dy:u,dispatch:c}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:r,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:c}})}function tC(e){return!e.ctrlKey&&!e.button}function tN(){return this.parentNode}function tF(e,t){return null==t?{x:e.x,y:e.y}:t}function tE(){return navigator.maxTouchPoints||"ontouchstart"in this}function tT(){var e,t,r,n,i=tC,o=tN,s=tF,a=tE,l={},u=V("start","drag","end"),c=0,d=0;function h(e){e.on("mousedown.drag",f).filter(a).on("touchstart.drag",v).on("touchmove.drag",m,tv).on("touchend.drag touchcancel.drag",y).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(s,a){if(!n&&i.call(this,s,a)){var l=_(this,o.call(this,s,a),s,a,"mouse");l&&(tp(s.view).on("mousemove.drag",p,tm).on("mouseup.drag",g,tm),tb(s.view),ty(s),r=!1,e=s.clientX,t=s.clientY,l("start",s))}}function p(n){if(t_(n),!r){var i=n.clientX-e,o=n.clientY-t;r=i*i+o*o>d}l.mouse("drag",n)}function g(e){tp(e.view).on("mousemove.drag mouseup.drag",null),tI(e.view,r),t_(e),l.mouse("end",e)}function v(e,t){if(i.call(this,e,t)){var r,n,s=e.changedTouches,a=o.call(this,e,t),l=s.length;for(r=0;r<l;++r)(n=_(this,a,e,t,s[r].identifier,s[r]))&&(ty(e),n("start",e,s[r]))}}function m(e){var t,r,n=e.changedTouches,i=n.length;for(t=0;t<i;++t)(r=l[n[t].identifier])&&(t_(e),r("drag",e,n[t]))}function y(e){var t,r,i=e.changedTouches,o=i.length;for(n&&clearTimeout(n),n=setTimeout(function(){n=null},500),t=0;t<o;++t)(r=l[i[t].identifier])&&(ty(e),r("end",e,i[t]))}function _(e,t,r,n,i,o){var a,d,f,p=u.copy(),g=tg(o||r,t);if(null!=(f=s.call(e,new tO("beforestart",{sourceEvent:r,target:h,identifier:i,active:c,x:g[0],y:g[1],dx:0,dy:0,dispatch:p}),n)))return a=f.x-g[0]||0,d=f.y-g[1]||0,function r(o,s,u){var v,m=g;switch(o){case"start":l[i]=r,v=c++;break;case"end":delete l[i],--c;case"drag":g=tg(u||s,t),v=c}p.call(o,e,new tO(o,{sourceEvent:s,subject:f,target:h,identifier:i,active:v,x:g[0]+a,y:g[1]+d,dx:g[0]-m[0],dy:g[1]-m[1],dispatch:p}),n)}}return h.filter=function(e){return arguments.length?(i="function"==typeof e?e:tw(!!e),h):i},h.container=function(e){return arguments.length?(o="function"==typeof e?e:tw(e),h):o},h.subject=function(e){return arguments.length?(s="function"==typeof e?e:tw(e),h):s},h.touchable=function(e){return arguments.length?(a="function"==typeof e?e:tw(!!e),h):a},h.on=function(){var e=u.on.apply(u,arguments);return e===u?h:e},h.clickDistance=function(e){return arguments.length?(d=(e=+e)*e,h):Math.sqrt(d)},h}function tM(e,t){var r,n=1;function i(){var i,o,s=r.length,a=0,l=0;for(i=0;i<s;++i)a+=(o=r[i]).x,l+=o.y;for(a=(a/s-e)*n,l=(l/s-t)*n,i=0;i<s;++i)o=r[i],o.x-=a,o.y-=l}return null==e&&(e=0),null==t&&(t=0),i.initialize=function(e){r=e},i.x=function(t){return arguments.length?(e=+t,i):e},i.y=function(e){return arguments.length?(t=+e,i):t},i.strength=function(e){return arguments.length?(n=+e,i):n},i}function tS(e){return function(){return e}}function tx(e){return(e()-.5)*1e-6}function tA(e){return e.index}function tk(e,t){var r=e.get(t);if(!r)throw Error("node not found: "+t);return r}function tL(e){var t,r,n,i,o,s,a=tA,l=function(e){return 1/Math.min(i[e.source.index],i[e.target.index])},u=tS(30),c=1;function d(n){for(var i=0,a=e.length;i<c;++i)for(var l,u,d,h,f,p,g,v=0;v<a;++v)u=(l=e[v]).source,p=((p=Math.sqrt((h=(d=l.target).x+d.vx-u.x-u.vx||tx(s))*h+(f=d.y+d.vy-u.y-u.vy||tx(s))*f))-r[v])/p*n*t[v],h*=p,f*=p,d.vx-=h*(g=o[v]),d.vy-=f*g,u.vx+=h*(g=1-g),u.vy+=f*g}function h(){if(n){var s,l,u=n.length,c=e.length,d=new Map(n.map((e,t)=>[a(e,t,n),e]));for(s=0,i=Array(u);s<c;++s)(l=e[s]).index=s,"object"!=typeof l.source&&(l.source=tk(d,l.source)),"object"!=typeof l.target&&(l.target=tk(d,l.target)),i[l.source.index]=(i[l.source.index]||0)+1,i[l.target.index]=(i[l.target.index]||0)+1;for(s=0,o=Array(c);s<c;++s)l=e[s],o[s]=i[l.source.index]/(i[l.source.index]+i[l.target.index]);t=Array(c),f(),r=Array(c),p()}}function f(){if(n)for(var r=0,i=e.length;r<i;++r)t[r]=+l(e[r],r,e)}function p(){if(n)for(var t=0,i=e.length;t<i;++t)r[t]=+u(e[t],t,e)}return null==e&&(e=[]),d.initialize=function(e,t){n=e,s=t,h()},d.links=function(t){return arguments.length?(e=t,h(),d):e},d.id=function(e){return arguments.length?(a=e,d):a},d.iterations=function(e){return arguments.length?(c=+e,d):c},d.strength=function(e){return arguments.length?(l="function"==typeof e?e:tS(+e),f(),d):l},d.distance=function(e){return arguments.length?(u="function"==typeof e?e:tS(+e),p(),d):u},d}function tj(e,t,r,n){if(isNaN(t)||isNaN(r))return e;var i,o,s,a,l,u,c,d,h,f=e._root,p={data:n},g=e._x0,v=e._y0,m=e._x1,y=e._y1;if(!f)return e._root=p,e;for(;f.length;)if((u=t>=(o=(g+m)/2))?g=o:m=o,(c=r>=(s=(v+y)/2))?v=s:y=s,i=f,!(f=f[d=c<<1|u]))return i[d]=p,e;if(a=+e._x.call(null,f.data),l=+e._y.call(null,f.data),t===a&&r===l)return p.next=f,i?i[d]=p:e._root=p,e;do i=i?i[d]=[,,,,]:e._root=[,,,,],(u=t>=(o=(g+m)/2))?g=o:m=o,(c=r>=(s=(v+y)/2))?v=s:y=s;while((d=c<<1|u)==(h=(l>=s)<<1|a>=o));return i[h]=f,i[d]=p,e}function tP(e,t,r,n,i){this.node=e,this.x0=t,this.y0=r,this.x1=n,this.y1=i}function tR(e){return e[0]}function tD(e){return e[1]}function t$(e,t,r){var n=new tJ(null==t?tR:t,null==r?tD:r,NaN,NaN,NaN,NaN);return null==e?n:n.addAll(e)}function tJ(e,t,r,n,i,o){this._x=e,this._y=t,this._x0=r,this._y0=n,this._x1=i,this._y1=o,this._root=void 0}function tG(e){for(var t={data:e.data},r=t;e=e.next;)r=r.next={data:e.data};return t}tO.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};var tz=t$.prototype=tJ.prototype;function tU(e){return e.x}function tB(e){return e.y}tz.copy=function(){var e,t,r=new tJ(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root;if(!n)return r;if(!n.length)return r._root=tG(n),r;for(e=[{source:n,target:r._root=[,,,,]}];n=e.pop();)for(var i=0;i<4;++i)(t=n.source[i])&&(t.length?e.push({source:t,target:n.target[i]=[,,,,]}):n.target[i]=tG(t));return r},tz.add=function(e){let t=+this._x.call(null,e),r=+this._y.call(null,e);return tj(this.cover(t,r),t,r,e)},tz.addAll=function(e){var t,r,n,i,o=e.length,s=Array(o),a=Array(o),l=1/0,u=1/0,c=-1/0,d=-1/0;for(r=0;r<o;++r)!(isNaN(n=+this._x.call(null,t=e[r]))||isNaN(i=+this._y.call(null,t)))&&(s[r]=n,a[r]=i,n<l&&(l=n),n>c&&(c=n),i<u&&(u=i),i>d&&(d=i));if(l>c||u>d)return this;for(this.cover(l,u).cover(c,d),r=0;r<o;++r)tj(this,s[r],a[r],e[r]);return this},tz.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var r=this._x0,n=this._y0,i=this._x1,o=this._y1;if(isNaN(r))i=(r=Math.floor(e))+1,o=(n=Math.floor(t))+1;else{for(var s,a,l=i-r||1,u=this._root;r>e||e>=i||n>t||t>=o;)switch(a=(t<n)<<1|e<r,(s=[,,,,])[a]=u,u=s,l*=2,a){case 0:i=r+l,o=n+l;break;case 1:r=i-l,o=n+l;break;case 2:i=r+l,n=o-l;break;case 3:r=i-l,n=o-l}this._root&&this._root.length&&(this._root=u)}return this._x0=r,this._y0=n,this._x1=i,this._y1=o,this},tz.data=function(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e},tz.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},tz.find=function(e,t,r){var n,i,o,s,a,l,u,c=this._x0,d=this._y0,h=this._x1,f=this._y1,p=[],g=this._root;for(g&&p.push(new tP(g,c,d,h,f)),null==r?r=1/0:(c=e-r,d=t-r,h=e+r,f=t+r,r*=r);l=p.pop();)if((g=l.node)&&!((i=l.x0)>h)&&!((o=l.y0)>f)&&!((s=l.x1)<c)&&!((a=l.y1)<d)){if(g.length){var v=(i+s)/2,m=(o+a)/2;p.push(new tP(g[3],v,m,s,a),new tP(g[2],i,m,v,a),new tP(g[1],v,o,s,m),new tP(g[0],i,o,v,m)),(u=(t>=m)<<1|e>=v)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-u],p[p.length-1-u]=l)}else{var y=e-+this._x.call(null,g.data),_=t-+this._y.call(null,g.data),b=y*y+_*_;if(b<r){var I=Math.sqrt(r=b);c=e-I,d=t-I,h=e+I,f=t+I,n=g.data}}}return n},tz.remove=function(e){if(isNaN(o=+this._x.call(null,e))||isNaN(s=+this._y.call(null,e)))return this;var t,r,n,i,o,s,a,l,u,c,d,h,f=this._root,p=this._x0,g=this._y0,v=this._x1,m=this._y1;if(!f)return this;if(f.length)for(;;){if((u=o>=(a=(p+v)/2))?p=a:v=a,(c=s>=(l=(g+m)/2))?g=l:m=l,t=f,!(f=f[d=c<<1|u]))return this;if(!f.length)break;(t[d+1&3]||t[d+2&3]||t[d+3&3])&&(r=t,h=d)}for(;f.data!==e;)if(n=f,!(f=f.next))return this;return((i=f.next)&&delete f.next,n)?i?n.next=i:delete n.next:t?(i?t[d]=i:delete t[d],(f=t[0]||t[1]||t[2]||t[3])&&f===(t[3]||t[2]||t[1]||t[0])&&!f.length&&(r?r[h]=f:this._root=f)):this._root=i,this},tz.removeAll=function(e){for(var t=0,r=e.length;t<r;++t)this.remove(e[t]);return this},tz.root=function(){return this._root},tz.size=function(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e},tz.visit=function(e){var t,r,n,i,o,s,a=[],l=this._root;for(l&&a.push(new tP(l,this._x0,this._y0,this._x1,this._y1));t=a.pop();)if(!e(l=t.node,n=t.x0,i=t.y0,o=t.x1,s=t.y1)&&l.length){var u=(n+o)/2,c=(i+s)/2;(r=l[3])&&a.push(new tP(r,u,c,o,s)),(r=l[2])&&a.push(new tP(r,n,c,u,s)),(r=l[1])&&a.push(new tP(r,u,i,o,c)),(r=l[0])&&a.push(new tP(r,n,i,u,c))}return this},tz.visitAfter=function(e){var t,r=[],n=[];for(this._root&&r.push(new tP(this._root,this._x0,this._y0,this._x1,this._y1));t=r.pop();){var i=t.node;if(i.length){var o,s=t.x0,a=t.y0,l=t.x1,u=t.y1,c=(s+l)/2,d=(a+u)/2;(o=i[0])&&r.push(new tP(o,s,a,c,d)),(o=i[1])&&r.push(new tP(o,c,a,l,d)),(o=i[2])&&r.push(new tP(o,s,d,c,u)),(o=i[3])&&r.push(new tP(o,c,d,l,u))}n.push(t)}for(;t=n.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},tz.x=function(e){return arguments.length?(this._x=e,this):this._x},tz.y=function(e){return arguments.length?(this._y=e,this):this._y};var tW=Math.PI*(3-Math.sqrt(5));function tV(e){let t;var r,n=1,i=.001,o=1-Math.pow(.001,1/300),s=0,a=.6,l=new Map,u=el(h),c=V("tick","end"),d=(t=1,()=>(t=(1664525*t+1013904223)%4294967296)/4294967296);function h(){f(),c.call("tick",r),n<i&&(u.stop(),c.call("end",r))}function f(t){var i,u,c=e.length;void 0===t&&(t=1);for(var d=0;d<t;++d)for(n+=(s-n)*o,l.forEach(function(e){e(n)}),i=0;i<c;++i)null==(u=e[i]).fx?u.x+=u.vx*=a:(u.x=u.fx,u.vx=0),null==u.fy?u.y+=u.vy*=a:(u.y=u.fy,u.vy=0);return r}function p(){for(var t,r=0,n=e.length;r<n;++r){if((t=e[r]).index=r,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var i=10*Math.sqrt(.5+r),o=r*tW;t.x=i*Math.cos(o),t.y=i*Math.sin(o)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function g(t){return t.initialize&&t.initialize(e,d),t}return null==e&&(e=[]),p(),r={tick:f,restart:function(){return u.restart(h),r},stop:function(){return u.stop(),r},nodes:function(t){return arguments.length?(e=t,p(),l.forEach(g),r):e},alpha:function(e){return arguments.length?(n=+e,r):n},alphaMin:function(e){return arguments.length?(i=+e,r):i},alphaDecay:function(e){return arguments.length?(o=+e,r):+o},alphaTarget:function(e){return arguments.length?(s=+e,r):s},velocityDecay:function(e){return arguments.length?(a=1-e,r):1-a},randomSource:function(e){return arguments.length?(d=e,l.forEach(g),r):d},force:function(e,t){return arguments.length>1?(null==t?l.delete(e):l.set(e,g(t)),r):l.get(e)},find:function(t,r,n){var i,o,s,a,l,u=0,c=e.length;for(null==n?n=1/0:n*=n,u=0;u<c;++u)(s=(i=t-(a=e[u]).x)*i+(o=r-a.y)*o)<n&&(l=a,n=s);return l},on:function(e,t){return arguments.length>1?(c.on(e,t),r):c.on(e)}}}function tq(){var e,t,r,n,i,o=tS(-30),s=1,a=1/0,l=.81;function u(r){var i,o=e.length,s=t$(e,tU,tB).visitAfter(d);for(n=r,i=0;i<o;++i)t=e[i],s.visit(h)}function c(){if(e){var t,r,n=e.length;for(t=0,i=Array(n);t<n;++t)i[(r=e[t]).index]=+o(r,t,e)}}function d(e){var t,r,n,o,s,a=0,l=0;if(e.length){for(n=o=s=0;s<4;++s)(t=e[s])&&(r=Math.abs(t.value))&&(a+=t.value,l+=r,n+=r*t.x,o+=r*t.y);e.x=n/l,e.y=o/l}else{(t=e).x=t.data.x,t.y=t.data.y;do a+=i[t.data.index];while(t=t.next)}e.value=a}function h(e,o,u,c){if(!e.value)return!0;var d=e.x-t.x,h=e.y-t.y,f=c-o,p=d*d+h*h;if(f*f/l<p)return p<a&&(0===d&&(p+=(d=tx(r))*d),0===h&&(p+=(h=tx(r))*h),p<s&&(p=Math.sqrt(s*p)),t.vx+=d*e.value*n/p,t.vy+=h*e.value*n/p),!0;if(!e.length&&!(p>=a)){(e.data!==t||e.next)&&(0===d&&(p+=(d=tx(r))*d),0===h&&(p+=(h=tx(r))*h),p<s&&(p=Math.sqrt(s*p)));do e.data!==t&&(f=i[e.data.index]*n/p,t.vx+=d*f,t.vy+=h*f);while(e=e.next)}}return u.initialize=function(t,n){e=t,r=n,c()},u.strength=function(e){return arguments.length?(o="function"==typeof e?e:tS(+e),c(),u):o},u.distanceMin=function(e){return arguments.length?(s=e*e,u):Math.sqrt(s)},u.distanceMax=function(e){return arguments.length?(a=e*e,u):Math.sqrt(a)},u.theta=function(e){return arguments.length?(l=e*e,u):Math.sqrt(l)},u}function tK(e){var t=0,r=e.children,n=r&&r.length;if(n)for(;--n>=0;)t+=r[n].value;else t=1;e.value=t}function tH(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=tX)):void 0===t&&(t=tY);for(var r,n,i,o,s,a=new t0(e),l=[a];r=l.pop();)if((i=t(r.data))&&(s=(i=Array.from(i)).length))for(r.children=i,o=s-1;o>=0;--o)l.push(n=i[o]=new t0(i[o])),n.parent=r,n.depth=r.depth+1;return a.eachBefore(tZ)}function tY(e){return e.children}function tX(e){return Array.isArray(e)?e[1]:null}function tQ(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function tZ(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function t0(e){this.data=e,this.depth=this.height=0,this.parent=null}function t1(e,t){return e.parent===t.parent?1:2}function t2(e){var t=e.children;return t?t[0]:e.t}function t5(e){var t=e.children;return t?t[t.length-1]:e.t}function t4(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function t3(){var e=t1,t=1,r=1,n=null;function i(i){var l=function(e){for(var t,r,n,i,o,s=new t4(e,0),a=[s];t=a.pop();)if(n=t._.children)for(t.children=Array(o=n.length),i=o-1;i>=0;--i)a.push(r=t.children[i]=new t4(n[i],i)),r.parent=t;return(s.parent=new t4(null,0)).children=[s],s}(i);if(l.eachAfter(o),l.parent.m=-l.z,l.eachBefore(s),n)i.eachBefore(a);else{var u=i,c=i,d=i;i.eachBefore(function(e){e.x<u.x&&(u=e),e.x>c.x&&(c=e),e.depth>d.depth&&(d=e)});var h=u===c?1:e(u,c)/2,f=h-u.x,p=t/(c.x+h+f),g=r/(d.depth||1);i.eachBefore(function(e){e.x=(e.x+f)*p,e.y=e.depth*g})}return i}function o(t){var r=t.children,n=t.parent.children,i=t.i?n[t.i-1]:null;if(r){!function(e){for(var t,r=0,n=0,i=e.children,o=i.length;--o>=0;)t=i[o],t.z+=r,t.m+=r,r+=t.s+(n+=t.c)}(t);var o=(r[0].z+r[r.length-1].z)/2;i?(t.z=i.z+e(t._,i._),t.m=t.z-o):t.z=o}else i&&(t.z=i.z+e(t._,i._));t.parent.A=function(t,r,n){if(r){for(var i,o,s,a=t,l=t,u=r,c=a.parent.children[0],d=a.m,h=l.m,f=u.m,p=c.m;u=t5(u),a=t2(a),u&&a;)c=t2(c),(l=t5(l)).a=t,(s=u.z+f-a.z-d+e(u._,a._))>0&&(function(e,t,r){var n=r/(t.i-e.i);t.c-=n,t.s+=r,e.c+=n,t.z+=r,t.m+=r}((i=u,o=n,i.a.parent===t.parent?i.a:o),t,s),d+=s,h+=s),f+=u.m,d+=a.m,p+=c.m,h+=l.m;u&&!t5(l)&&(l.t=u,l.m+=f-h),a&&!t2(c)&&(c.t=a,c.m+=d-p,n=t)}return n}(t,i,t.parent.A||n[0])}function s(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function a(e){e.x*=t,e.y=e.depth*r}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(n=!1,t=+e[0],r=+e[1],i):n?null:[t,r]},i.nodeSize=function(e){return arguments.length?(n=!0,t=+e[0],r=+e[1],i):n?[t,r]:null},i}t0.prototype=tH.prototype={constructor:t0,count:function(){return this.eachAfter(tK)},each:function(e,t){let r=-1;for(let n of this)e.call(t,n,++r,this);return this},eachAfter:function(e,t){for(var r,n,i,o=this,s=[o],a=[],l=-1;o=s.pop();)if(a.push(o),r=o.children)for(n=0,i=r.length;n<i;++n)s.push(r[n]);for(;o=a.pop();)e.call(t,o,++l,this);return this},eachBefore:function(e,t){for(var r,n,i=this,o=[i],s=-1;i=o.pop();)if(e.call(t,i,++s,this),r=i.children)for(n=r.length-1;n>=0;--n)o.push(r[n]);return this},find:function(e,t){let r=-1;for(let n of this)if(e.call(t,n,++r,this))return n},sum:function(e){return this.eachAfter(function(t){for(var r=+e(t.data)||0,n=t.children,i=n&&n.length;--i>=0;)r+=n[i].value;t.value=r})},sort:function(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function(e){for(var t=this,r=function(e,t){if(e===t)return e;var r=e.ancestors(),n=t.ancestors(),i=null;for(e=r.pop(),t=n.pop();e===t;)i=e,e=r.pop(),t=n.pop();return i}(t,e),n=[t];t!==r;)n.push(t=t.parent);for(var i=n.length;e!==r;)n.splice(i,0,e),e=e.parent;return n},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function(){var e=this,t=[];return e.each(function(r){r!==e&&t.push({source:r.parent,target:r})}),t},copy:function(){return tH(this).eachBefore(tQ)},[Symbol.iterator]:function*(){var e,t,r,n,i=this,o=[i];do for(e=o.reverse(),o=[];i=e.pop();)if(yield i,t=i.children)for(r=0,n=t.length;r<n;++r)o.push(t[r]);while(o.length)}},t4.prototype=Object.create(t0.prototype);var t6=Array.prototype.slice;function t8(e){return function(){return e}}class t7{constructor(e,t){this._context=e,this._x=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line}point(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,t,e,t):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+t)/2,e,this._y0,e,t)}this._x0=e,this._y0=t}}function t9(e){return new t7(e,!1)}let re=Math.PI,rt=2*re,rr=rt-1e-6;function rn(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}class ri{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?rn:function(e){let t=Math.floor(e);if(!(t>=0))throw Error(`invalid digits: ${e}`);if(t>15)return rn;let r=10**t;return function(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=Math.round(arguments[t]*r)/r+e[t]}}(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,r,n){this._append`Q${+e},${+t},${this._x1=+r},${this._y1=+n}`}bezierCurveTo(e,t,r,n,i,o){this._append`C${+e},${+t},${+r},${+n},${this._x1=+i},${this._y1=+o}`}arcTo(e,t,r,n,i){if(e=+e,t=+t,r=+r,n=+n,(i=+i)<0)throw Error(`negative radius: ${i}`);let o=this._x1,s=this._y1,a=r-e,l=n-t,u=o-e,c=s-t,d=u*u+c*c;if(null===this._x1)this._append`M${this._x1=e},${this._y1=t}`;else if(d>1e-6){if(Math.abs(c*a-l*u)>1e-6&&i){let h=r-o,f=n-s,p=a*a+l*l,g=Math.sqrt(p),v=Math.sqrt(d),m=i*Math.tan((re-Math.acos((p+d-(h*h+f*f))/(2*g*v)))/2),y=m/v,_=m/g;Math.abs(y-1)>1e-6&&this._append`L${e+y*u},${t+y*c}`,this._append`A${i},${i},0,0,${+(c*h>u*f)},${this._x1=e+_*a},${this._y1=t+_*l}`}else this._append`L${this._x1=e},${this._y1=t}`}}arc(e,t,r,n,i,o){if(e=+e,t=+t,o=!!o,(r=+r)<0)throw Error(`negative radius: ${r}`);let s=r*Math.cos(n),a=r*Math.sin(n),l=e+s,u=t+a,c=1^o,d=o?n-i:i-n;null===this._x1?this._append`M${l},${u}`:(Math.abs(this._x1-l)>1e-6||Math.abs(this._y1-u)>1e-6)&&this._append`L${l},${u}`,r&&(d<0&&(d=d%rt+rt),d>rr?this._append`A${r},${r},0,1,${c},${e-s},${t-a}A${r},${r},0,1,${c},${this._x1=l},${this._y1=u}`:d>1e-6&&this._append`A${r},${r},0,${+(d>=re)},${c},${this._x1=e+r*Math.cos(i)},${this._y1=t+r*Math.sin(i)}`)}rect(e,t,r,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${r=+r}v${+n}h${-r}Z`}toString(){return this._}}function ro(e){return e[0]}function rs(e){return e[1]}function ra(e){return e.source}function rl(e){return e.target}function ru(){return function(e){let t;let r=ra,n=rl,i=ro,o=rs,s=null,a=null,l=(t=3,u.digits=function(e){if(!arguments.length)return t;if(null==e)t=null;else{let r=Math.floor(e);if(!(r>=0))throw RangeError(`invalid digits: ${e}`);t=r}return u},()=>new ri(t));function u(){let t;let u=t6.call(arguments),c=r.apply(this,u),d=n.apply(this,u);if(null==s&&(a=e(t=l())),a.lineStart(),u[0]=c,a.point(+i.apply(this,u),+o.apply(this,u)),u[0]=d,a.point(+i.apply(this,u),+o.apply(this,u)),a.lineEnd(),t)return a=null,t+""||null}return u.source=function(e){return arguments.length?(r=e,u):r},u.target=function(e){return arguments.length?(n=e,u):n},u.x=function(e){return arguments.length?(i="function"==typeof e?e:t8(+e),u):i},u.y=function(e){return arguments.length?(o="function"==typeof e?e:t8(+e),u):o},u.context=function(t){return arguments.length?(null==t?s=a=null:a=e(s=t),u):s},u}(t9)}function rc(e){return((e=Math.exp(e))+1/e)/2}ri.prototype;var rd=function e(t,r,n){function i(e,i){var o,s,a=e[0],l=e[1],u=e[2],c=i[0],d=i[1],h=i[2],f=c-a,p=d-l,g=f*f+p*p;if(g<1e-12)s=Math.log(h/u)/t,o=function(e){return[a+e*f,l+e*p,u*Math.exp(t*e*s)]};else{var v=Math.sqrt(g),m=(h*h-u*u+n*g)/(2*u*r*v),y=(h*h-u*u-n*g)/(2*h*r*v),_=Math.log(Math.sqrt(m*m+1)-m);s=(Math.log(Math.sqrt(y*y+1)-y)-_)/t,o=function(e){var n,i,o=e*s,c=rc(_),d=u/(r*v)*(((n=Math.exp(2*(n=t*o+_)))-1)/(n+1)*c-((i=Math.exp(i=_))-1/i)/2);return[a+d*f,l+d*p,u*c/rc(t*o+_)]}}return o.duration=1e3*s*t/Math.SQRT2,o}return i.rho=function(t){var r=Math.max(.001,+t),n=r*r;return e(r,n,n*n)},i}(Math.SQRT2,2,4),rh=e=>()=>e;function rf(e,{sourceEvent:t,target:r,transform:n,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},transform:{value:n,enumerable:!0,configurable:!0},_:{value:i}})}function rp(e,t,r){this.k=e,this.x=t,this.y=r}rp.prototype={constructor:rp,scale:function(e){return 1===e?this:new rp(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new rp(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var rg=new rp(1,0,0);function rv(e){for(;!e.__zoom;)if(!(e=e.parentNode))return rg;return e.__zoom}function rm(e){e.stopImmediatePropagation()}function ry(e){e.preventDefault(),e.stopImmediatePropagation()}function r_(e){return(!e.ctrlKey||"wheel"===e.type)&&!e.button}function rb(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function rI(){return this.__zoom||rg}function rw(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function rO(){return navigator.maxTouchPoints||"ontouchstart"in this}function rC(e,t,r){var n=e.invertX(t[0][0])-r[0][0],i=e.invertX(t[1][0])-r[1][0],o=e.invertY(t[0][1])-r[0][1],s=e.invertY(t[1][1])-r[1][1];return e.translate(i>n?(n+i)/2:Math.min(0,n)||Math.max(0,i),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function rN(){var e,t,r,n=r_,i=rb,o=rC,s=rw,a=rO,l=[0,1/0],u=[[-1/0,-1/0],[1/0,1/0]],c=250,d=rd,h=V("start","zoom","end"),f=0,p=10;function g(e){e.property("__zoom",rI).on("wheel.zoom",w,{passive:!1}).on("mousedown.zoom",O).on("dblclick.zoom",C).filter(a).on("touchstart.zoom",N).on("touchmove.zoom",F).on("touchend.zoom touchcancel.zoom",E).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function v(e,t){return(t=Math.max(l[0],Math.min(l[1],t)))===e.k?e:new rp(t,e.x,e.y)}function m(e,t,r){var n=t[0]-r[0]*e.k,i=t[1]-r[1]*e.k;return n===e.x&&i===e.y?e:new rp(e.k,n,i)}function y(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function _(e,t,r,n){e.on("start.zoom",function(){b(this,arguments).event(n).start()}).on("interrupt.zoom end.zoom",function(){b(this,arguments).event(n).end()}).tween("zoom",function(){var e=arguments,o=b(this,e).event(n),s=i.apply(this,e),a=null==r?y(s):"function"==typeof r?r.apply(this,e):r,l=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),u=this.__zoom,c="function"==typeof t?t.apply(this,e):t,h=d(u.invert(a).concat(l/u.k),c.invert(a).concat(l/c.k));return function(e){if(1===e)e=c;else{var t=h(e),r=l/t[2];e=new rp(r,a[0]-t[0]*r,a[1]-t[1]*r)}o.zoom(null,e)}})}function b(e,t,r){return!r&&e.__zooming||new I(e,t)}function I(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=i.apply(e,t),this.taps=0}function w(e,...t){if(n.apply(this,arguments)){var r=b(this,t).event(e),i=this.__zoom,a=Math.max(l[0],Math.min(l[1],i.k*Math.pow(2,s.apply(this,arguments)))),c=tg(e);if(r.wheel)(r.mouse[0][0]!==c[0]||r.mouse[0][1]!==c[1])&&(r.mouse[1]=i.invert(r.mouse[0]=c)),clearTimeout(r.wheel);else{if(i.k===a)return;r.mouse=[c,i.invert(c)],e_(this),r.start()}ry(e),r.wheel=setTimeout(function(){r.wheel=null,r.end()},150),r.zoom("mouse",o(m(v(i,a),r.mouse[0],r.mouse[1]),r.extent,u))}}function O(e,...t){if(!r&&n.apply(this,arguments)){var i=e.currentTarget,s=b(this,t,!0).event(e),a=tp(e.view).on("mousemove.zoom",function(e){if(ry(e),!s.moved){var t=e.clientX-c,r=e.clientY-d;s.moved=t*t+r*r>f}s.event(e).zoom("mouse",o(m(s.that.__zoom,s.mouse[0]=tg(e,i),s.mouse[1]),s.extent,u))},!0).on("mouseup.zoom",function(e){a.on("mousemove.zoom mouseup.zoom",null),tI(e.view,s.moved),ry(e),s.event(e).end()},!0),l=tg(e,i),c=e.clientX,d=e.clientY;tb(e.view),rm(e),s.mouse=[l,this.__zoom.invert(l)],e_(this),s.start()}}function C(e,...t){if(n.apply(this,arguments)){var r=this.__zoom,s=tg(e.changedTouches?e.changedTouches[0]:e,this),a=r.invert(s),l=r.k*(e.shiftKey?.5:2),d=o(m(v(r,l),s,a),i.apply(this,t),u);ry(e),c>0?tp(this).transition().duration(c).call(_,d,s,e):tp(this).call(g.transform,d,s,e)}}function N(r,...i){if(n.apply(this,arguments)){var o,s,a,l,u=r.touches,c=u.length,d=b(this,i,r.changedTouches.length===c).event(r);for(rm(r),s=0;s<c;++s)l=[l=tg(a=u[s],this),this.__zoom.invert(l),a.identifier],d.touch0?d.touch1||d.touch0[2]===l[2]||(d.touch1=l,d.taps=0):(d.touch0=l,o=!0,d.taps=1+!!e);e&&(e=clearTimeout(e)),o&&(d.taps<2&&(t=l[0],e=setTimeout(function(){e=null},500)),e_(this),d.start())}}function F(e,...t){if(this.__zooming){var r,n,i,s,a=b(this,t).event(e),l=e.changedTouches,c=l.length;for(ry(e),r=0;r<c;++r)i=tg(n=l[r],this),a.touch0&&a.touch0[2]===n.identifier?a.touch0[0]=i:a.touch1&&a.touch1[2]===n.identifier&&(a.touch1[0]=i);if(n=a.that.__zoom,a.touch1){var d=a.touch0[0],h=a.touch0[1],f=a.touch1[0],p=a.touch1[1],g=(g=f[0]-d[0])*g+(g=f[1]-d[1])*g,y=(y=p[0]-h[0])*y+(y=p[1]-h[1])*y;n=v(n,Math.sqrt(g/y)),i=[(d[0]+f[0])/2,(d[1]+f[1])/2],s=[(h[0]+p[0])/2,(h[1]+p[1])/2]}else{if(!a.touch0)return;i=a.touch0[0],s=a.touch0[1]}a.zoom("touch",o(m(n,i,s),a.extent,u))}}function E(e,...n){if(this.__zooming){var i,o,s=b(this,n).event(e),a=e.changedTouches,l=a.length;for(rm(e),r&&clearTimeout(r),r=setTimeout(function(){r=null},500),i=0;i<l;++i)o=a[i],s.touch0&&s.touch0[2]===o.identifier?delete s.touch0:s.touch1&&s.touch1[2]===o.identifier&&delete s.touch1;if(s.touch1&&!s.touch0&&(s.touch0=s.touch1,delete s.touch1),s.touch0)s.touch0[1]=this.__zoom.invert(s.touch0[0]);else if(s.end(),2===s.taps&&(o=tg(o,this),Math.hypot(t[0]-o[0],t[1]-o[1])<p)){var u=tp(this).on("dblclick.zoom");u&&u.apply(this,arguments)}}}return g.transform=function(e,t,r,n){var i=e.selection?e.selection():e;i.property("__zoom",rI),e!==i?_(e,t,r,n):i.interrupt().each(function(){b(this,arguments).event(n).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()})},g.scaleBy=function(e,t,r,n){g.scaleTo(e,function(){var e=this.__zoom.k,r="function"==typeof t?t.apply(this,arguments):t;return e*r},r,n)},g.scaleTo=function(e,t,r,n){g.transform(e,function(){var e=i.apply(this,arguments),n=this.__zoom,s=null==r?y(e):"function"==typeof r?r.apply(this,arguments):r,a=n.invert(s),l="function"==typeof t?t.apply(this,arguments):t;return o(m(v(n,l),s,a),e,u)},r,n)},g.translateBy=function(e,t,r,n){g.transform(e,function(){return o(this.__zoom.translate("function"==typeof t?t.apply(this,arguments):t,"function"==typeof r?r.apply(this,arguments):r),i.apply(this,arguments),u)},null,n)},g.translateTo=function(e,t,r,n,s){g.transform(e,function(){var e=i.apply(this,arguments),s=this.__zoom,a=null==n?y(e):"function"==typeof n?n.apply(this,arguments):n;return o(rg.translate(a[0],a[1]).scale(s.k).translate("function"==typeof t?-t.apply(this,arguments):-t,"function"==typeof r?-r.apply(this,arguments):-r),e,u)},n,s)},I.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=tp(this.that).datum();h.call(e,this.that,new rf(e,{sourceEvent:this.sourceEvent,target:g,type:e,transform:this.that.__zoom,dispatch:h}),t)}},g.wheelDelta=function(e){return arguments.length?(s="function"==typeof e?e:rh(+e),g):s},g.filter=function(e){return arguments.length?(n="function"==typeof e?e:rh(!!e),g):n},g.touchable=function(e){return arguments.length?(a="function"==typeof e?e:rh(!!e),g):a},g.extent=function(e){return arguments.length?(i="function"==typeof e?e:rh([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),g):i},g.scaleExtent=function(e){return arguments.length?(l[0]=+e[0],l[1]=+e[1],g):[l[0],l[1]]},g.translateExtent=function(e){return arguments.length?(u[0][0]=+e[0][0],u[1][0]=+e[1][0],u[0][1]=+e[0][1],u[1][1]=+e[1][1],g):[[u[0][0],u[0][1]],[u[1][0],u[1][1]]]},g.constrain=function(e){return arguments.length?(o=e,g):o},g.duration=function(e){return arguments.length?(c=+e,g):c},g.interpolate=function(e){return arguments.length?(d=e,g):d},g.on=function(){var e=h.on.apply(h,arguments);return e===h?g:e},g.clickDistance=function(e){return arguments.length?(f=(e=+e)*e,g):Math.sqrt(f)},g.tapDistance=function(e){return arguments.length?(p=+e,g):p},g}rv.prototype=rp.prototype}}]);