(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[902],{456:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/test-chat-session",function(){return n(9967)}])},5088:function(e,t,n){"use strict";n.d(t,{Gh:function(){return r},Pv:function(){return a},bG:function(){return s}});var o=n(3454);let r={SERVER_HOST:o.env.NEXT_PUBLIC_ISTACK_BUDDY_BACKEND_SERVER_HOST||"localhost",SERVER_PORT:o.env.NEXT_PUBLIC_ISTACK_BUDDY_BACKEND_SERVER_HOST_PORT||"3500",DEFAULT_USER_ID:"form-marv-user",DEFAULT_USER_ROLE:"cx-agent",CONNECTION_TIMEOUT:2e4,RECONNECT_ATTEMPTS:5,DEFAULT_MESSAGE_LIMIT:50,DEBUG_MODE:!1},a=e=>{let t=Date.now(),n=Math.random().toString(36).substring(7),o="marv-chat-".concat(t,"-").concat(n);return e?"".concat(o,"-form-").concat(e):o},s=()=>({userId:r.DEFAULT_USER_ID,userRole:r.DEFAULT_USER_ROLE})},9967:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return O}});var o=n(5893),r=n(7294),a=n(990),s=n(6788),i=n(8864),c=n(6541),l=n(1015),u=n(7182),d=n(18),h=n(3366),m=n(7462),x=n(512),p=n(4780),b=n(6643),f=n(7527),T=n(4001),E=n(9310),k=n(9168),v=n(1588),y=n(4867);function _(e){return(0,y.ZP)("MuiLink",e)}let S=(0,v.Z)("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]);var g=n(4844),R=n(2101);let Z={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},w=e=>Z[e]||e;var C=e=>{let{theme:t,ownerState:n}=e,o=w(n.color),r=(0,g.DW)(t,"palette.".concat(o),!1)||n.color,a=(0,g.DW)(t,"palette.".concat(o,"Channel"));return"vars"in t&&a?"rgba(".concat(a," / 0.4)"):(0,R.Fq)(r,.4)};let j=["className","color","component","onBlur","onFocus","TypographyClasses","underline","variant","sx"],D=e=>{let{classes:t,component:n,focusVisible:o,underline:r}=e,a={root:["root","underline".concat((0,b.Z)(r)),"button"===n&&"button",o&&"focusVisible"]};return(0,p.Z)(a,_,t)},U=(0,f.ZP)(s.Z,{name:"MuiLink",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t["underline".concat((0,b.Z)(n.underline))],"button"===n.component&&t.button]}})(e=>{let{theme:t,ownerState:n}=e;return(0,m.Z)({},"none"===n.underline&&{textDecoration:"none"},"hover"===n.underline&&{textDecoration:"none","&:hover":{textDecoration:"underline"}},"always"===n.underline&&(0,m.Z)({textDecoration:"underline"},"inherit"!==n.color&&{textDecorationColor:C({theme:t,ownerState:n})},{"&:hover":{textDecorationColor:"inherit"}}),"button"===n.component&&{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},["&.".concat(S.focusVisible)]:{outline:"auto"}})}),L=r.forwardRef(function(e,t){let n=(0,T.i)({props:e,name:"MuiLink"}),{className:a,color:s="primary",component:i="a",onBlur:c,onFocus:l,TypographyClasses:u,underline:d="always",variant:p="inherit",sx:b}=n,f=(0,h.Z)(n,j),{isFocusVisibleRef:v,onBlur:y,onFocus:_,ref:S}=(0,E.Z)(),[g,R]=r.useState(!1),w=(0,k.Z)(t,S),C=(0,m.Z)({},n,{color:s,component:i,focusVisible:g,underline:d,variant:p}),L=D(C);return(0,o.jsx)(U,(0,m.Z)({color:s,className:(0,x.Z)(L.root,a),classes:u,component:i,onBlur:e=>{y(e),!1===v.current&&R(!1),c&&c(e)},onFocus:e=>{_(e),!0===v.current&&R(!0),l&&l(e)},ref:w,ownerState:C,variant:p,sx:[...Object.keys(Z).includes(s)?[]:[{color:s}],...Array.isArray(b)?b:[b]]},f))});var I=n(5088),O=()=>{let[e,t]=(0,r.useState)(!1),[n,h]=(0,r.useState)(null),[m,x]=(0,r.useState)(null),[p,b]=(0,r.useState)("5375703"),f=async()=>{t(!0),x(null),h(null);try{let e="http://".concat(I.Gh.SERVER_HOST,":").concat(I.Gh.SERVER_PORT);console.log("Requesting secure session from:",e);let t=p.trim()?"".concat(e,"/public/form-marv/debug-create?formId=").concat(encodeURIComponent(p.trim())):"".concat(e,"/public/form-marv/debug-create");console.log("Requesting secure session with URL:",t);let n=await fetch(t,{method:"GET",headers:{"Content-Type":"text/html"}});if(!n.ok)throw Error("HTTP ".concat(n.status,": ").concat(n.statusText));let o=await n.text();console.log("Received HTML response:",o);let r=o.match(/href="([^"]+)"/);if(r&&r[1]){let e=r[1];console.log("Extracted backend URL:",e);let t=window.location.port,n=e.replace("http://localhost:3500","http://localhost:".concat(t)).replace(/https:\/\/[^.]+\.ngrok-free\.app/,"http://localhost:".concat(t)).replace(/\?jwtToken=[^&]+/,"");console.log("Transformed to frontend URL:",n),h(n);let o=e.match(/jwtToken=([^&]+)/);if(o&&o[1]){let e=o[1];console.log("Extracted JWT token:",e),sessionStorage.setItem("marv-jwt-token",e),console.log("JWT token stored in sessionStorage")}else console.warn("Could not extract JWT token from URL")}else throw Error("Could not extract secure URL from response")}catch(e){console.error("Failed to request secure session:",e),x("Failed to create secure session: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{t(!1)}};return(0,o.jsxs)(a.Z,{sx:{p:3,maxWidth:800,mx:"auto"},children:[(0,o.jsx)(s.Z,{variant:"h4",gutterBottom:!0,children:"Test Chat Session Creation"}),(0,o.jsx)(s.Z,{variant:"body1",sx:{mb:3},children:"This page tests the secure chat session creation flow. Click the button below to request a temporary secure link from the backend server."}),(0,o.jsxs)(i.Z,{sx:{p:3,mb:3},children:[(0,o.jsx)(s.Z,{variant:"h6",gutterBottom:!0,children:"Backend Configuration"}),(0,o.jsxs)(s.Z,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Server: ",I.Gh.SERVER_HOST,":",I.Gh.SERVER_PORT]}),(0,o.jsx)(s.Z,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Form ID will be sent to backend as a query parameter"}),(0,o.jsxs)(a.Z,{sx:{display:"flex",gap:2,alignItems:"center",mb:2},children:[(0,o.jsx)(c.Z,{label:"Form ID (optional)",value:p,onChange:e=>b(e.target.value),size:"small",sx:{width:200}}),(0,o.jsx)(l.Z,{variant:"contained",onClick:f,disabled:e,startIcon:e?(0,o.jsx)(u.Z,{size:16}):null,children:e?"Creating Session...":"Create Secure Session"})]}),m&&(0,o.jsx)(d.Z,{severity:"error",sx:{mt:2},children:m})]}),n&&(0,o.jsxs)(i.Z,{sx:{p:3,backgroundColor:"success.light"},children:[(0,o.jsx)(s.Z,{variant:"h6",gutterBottom:!0,children:"âœ… Secure Session Created!"}),(0,o.jsx)(s.Z,{variant:"body2",sx:{mb:2},children:"Your secure chat session has been created. Click the link below to open it in your form utilities:"}),(0,o.jsxs)(a.Z,{sx:{display:"flex",gap:2,alignItems:"center"},children:[(0,o.jsx)(L,{href:n,target:"_blank",rel:"noopener noreferrer",sx:{wordBreak:"break-all",color:"primary.main",textDecoration:"underline"},children:n}),(0,o.jsx)(l.Z,{variant:"outlined",onClick:()=>{n&&window.open(n,"_blank")},size:"small",children:"Open Session"})]}),(0,o.jsx)(s.Z,{variant:"caption",sx:{display:"block",mt:2},children:"This link will take you to the form MARV interface with the chat session open. The session is secure and temporary."})]}),(0,o.jsxs)(i.Z,{sx:{p:3,mt:3},children:[(0,o.jsx)(s.Z,{variant:"h6",gutterBottom:!0,children:"How It Works"}),(0,o.jsx)(s.Z,{variant:"body2",sx:{mb:2},children:'1. Click "Create Secure Session" to request a temporary link from the backend'}),(0,o.jsx)(s.Z,{variant:"body2",sx:{mb:2},children:"2. The backend creates a secure session and returns a URL"}),(0,o.jsx)(s.Z,{variant:"body2",sx:{mb:2},children:"3. Click the generated link to open your form utilities interface"}),(0,o.jsx)(s.Z,{variant:"body2",sx:{mb:2},children:"4. The JWT token is stored for WebSocket authentication"}),(0,o.jsx)(s.Z,{variant:"body2",sx:{mb:2},children:"5. You can then interact with the MarvToolBox chat component"}),(0,o.jsx)(s.Z,{variant:"body2",children:"6. The chat will connect using the stored JWT token"})]})]})}}},function(e){e.O(0,[18,621,541,888,774,179],function(){return e(e.s=456)}),_N_E=e.O()}]);