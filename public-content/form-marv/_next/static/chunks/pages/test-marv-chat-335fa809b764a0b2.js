(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[615],{2894:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/test-marv-chat",function(){return o(1932)}])},1932:function(e,t,o){"use strict";o.r(t);var n=o(5893),s=o(7294),r=o(990),i=o(7182),c=o(6788),l=o(18),a=o(1015),d=o(8864),h=o(1163),x=o(4664),f=o(5088);t.default=()=>{let e=(0,h.useRouter)(),[t,o]=(0,s.useState)(null),[u,m]=(0,s.useState)(!1),[g,v]=(0,s.useState)(null),T=e.query.conversationId,k=async()=>{m(!0),v(null);try{let e="http://".concat(f.Gh.SERVER_HOST,":").concat(f.Gh.SERVER_PORT);console.log("Requesting session from:",e);let t="".concat(e,"/public/form-marv/debug-create?formId=test-form-123");console.log("Requesting session with URL:",t);let n=await fetch(t,{method:"GET",headers:{"Content-Type":"text/html"}});if(!n.ok)throw Error("HTTP ".concat(n.status,": ").concat(n.statusText));let s=await n.text();console.log("Received HTML response:",s);let r=s.match(/href="([^"]+)"/);if(r&&r[1]){let e=r[1];console.log("Extracted backend URL:",e);let t=e.match(/\/public\/form-marv\/([^\/]+)\//);if(t&&t[1]){let n=t[1];console.log("Extracted session token:",n),o(n);let s=e.match(/jwtToken=([^&]+)/);if(s&&s[1]){let e=s[1];console.log("Extracted JWT token:",e),sessionStorage.setItem("marv-jwt-token",e),console.log("JWT token stored in sessionStorage")}else console.warn("Could not extract JWT token from URL")}else throw Error("Could not extract session token from URL")}else throw Error("Could not extract secure URL from response")}catch(e){console.error("Failed to request session:",e),v("Failed to create session: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{m(!1)}},p=async e=>{m(!0),v(null);try{let t="http://".concat(f.Gh.SERVER_HOST,":").concat(f.Gh.SERVER_PORT);console.log("Getting JWT for existing conversation:",e);let o="".concat(t,"/public/form-marv/debug-create?formId=test-form-123&conversationId=").concat(e);console.log("Requesting JWT with URL:",o);let n=await fetch(o,{method:"GET",headers:{"Content-Type":"text/html"}});if(!n.ok)throw Error("HTTP ".concat(n.status,": ").concat(n.statusText));let s=await n.text();console.log("Received HTML response for existing conversation:",s);let r=s.match(/href="([^"]+)"/);if(r&&r[1]){let e=r[1];console.log("Extracted backend URL for existing conversation:",e);let t=e.match(/jwtToken=([^&]+)/);if(t&&t[1]){let e=t[1];console.log("Extracted JWT token for existing conversation:",e),sessionStorage.setItem("marv-jwt-token",e),console.log("JWT token stored in sessionStorage for existing conversation")}else console.warn("Could not extract JWT token from URL for existing conversation")}else throw Error("Could not extract secure URL from response for existing conversation")}catch(e){console.error("Failed to get JWT for existing conversation:",e),v("Failed to get JWT for existing conversation: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{m(!1)}};return((0,s.useEffect)(()=>{if(T){console.log("Using conversation ID from URL:",T),o(T),p(T);return}k()},[T]),u)?(0,n.jsxs)(r.Z,{sx:{p:3,height:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,n.jsx)(i.Z,{}),(0,n.jsx)(c.Z,{variant:"body1",sx:{mt:2},children:"Creating chat session..."})]}):g?(0,n.jsxs)(r.Z,{sx:{p:3,height:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,n.jsx)(l.Z,{severity:"error",sx:{mb:2},children:g}),(0,n.jsx)(a.Z,{variant:"contained",onClick:k,children:"Retry"})]}):t?(0,n.jsxs)(r.Z,{sx:{p:3,height:"100vh",display:"flex",flexDirection:"column"},children:[(0,n.jsx)(c.Z,{variant:"h4",gutterBottom:!0,children:"MarvToolBox Socket.io Test"}),(0,n.jsxs)(r.Z,{sx:{mb:3},children:[(0,n.jsxs)(c.Z,{variant:"body1",sx:{mb:1},children:["Session token: ",t]}),(0,n.jsxs)(r.Z,{sx:{display:"flex",gap:2,mb:2},children:[(0,n.jsx)(a.Z,{variant:"outlined",size:"small",onClick:()=>{if(t){let e="".concat(window.location.origin,"/test-marv-chat?conversationId=").concat(t);navigator.clipboard.writeText(e),console.log("Conversation link copied:",e)}},children:"Copy Conversation Link"}),(0,n.jsx)(a.Z,{variant:"outlined",size:"small",onClick:()=>{e.push("/test-marv-chat")},children:"Create New Session"})]}),T&&(0,n.jsx)(l.Z,{severity:"info",sx:{mb:2},children:"Joined existing conversation via URL parameter"})]}),(0,n.jsx)(d.Z,{elevation:3,sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:(0,n.jsx)(x.Z,{onMessageSent:e=>{console.log("Message sent:",e)},onTemplateButtonClick:e=>{console.log("Template button clicked:",e)},conversationId:t,formId:"test-form-123",autoConnect:!0})})]}):(0,n.jsxs)(r.Z,{sx:{p:3,height:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,n.jsx)(c.Z,{variant:"h6",gutterBottom:!0,children:"No session token available"}),(0,n.jsx)(a.Z,{variant:"contained",onClick:k,children:"Create Session"})]})}}},function(e){e.O(0,[18,621,541,984,664,888,774,179],function(){return e(e.s=2894)}),_N_E=e.O()}]);