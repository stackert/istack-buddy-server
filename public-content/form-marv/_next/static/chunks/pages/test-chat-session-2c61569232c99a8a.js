(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[902],{456:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/test-chat-session",function(){return r(9967)}])},5088:function(e,t,r){"use strict";r.d(t,{Gh:function(){return n},Pv:function(){return a},bG:function(){return s}});var o=r(3454);let n={SERVER_HOST:o.env.NEXT_PUBLIC_ISTACK_BUDDY_BACKEND_SERVER_HOST||"localhost",SERVER_PORT:o.env.NEXT_PUBLIC_ISTACK_BUDDY_BACKEND_SERVER_HOST_PORT||"3500",DEFAULT_USER_ID:"form-marv-user",DEFAULT_USER_ROLE:"cx-agent",CONNECTION_TIMEOUT:2e4,RECONNECT_ATTEMPTS:5,DEFAULT_MESSAGE_LIMIT:50,DEBUG_MODE:!1},a=e=>{let t=Date.now(),r=Math.random().toString(36).substring(7),o="marv-chat-".concat(t,"-").concat(r);return e?"".concat(o,"-form-").concat(e):o},s=()=>({userId:n.DEFAULT_USER_ID,userRole:n.DEFAULT_USER_ROLE})},9967:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return I}});var o=r(5893),n=r(7294),a=r(990),s=r(6788),l=r(8864),i=r(6541),c=r(1015),u=r(7182),d=r(18),h=r(3366),p=r(7462),x=r(512),m=r(4780),b=r(6643),k=r(7527),f=r(4001),g=r(9310),T=r(9168),v=r(1588),j=r(4867);function y(e){return(0,j.ZP)("MuiLink",e)}let S=(0,v.Z)("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]);var Z=r(4844),E=r(2101);let w={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},R=e=>w[e]||e;var _=e=>{let{theme:t,ownerState:r}=e,o=R(r.color),n=(0,Z.DW)(t,"palette.".concat(o),!1)||r.color,a=(0,Z.DW)(t,"palette.".concat(o,"Channel"));return"vars"in t&&a?"rgba(".concat(a," / 0.4)"):(0,E.Fq)(n,.4)};let C=["className","color","component","onBlur","onFocus","TypographyClasses","underline","variant","sx"],D=e=>{let{classes:t,component:r,focusVisible:o,underline:n}=e,a={root:["root","underline".concat((0,b.Z)(n)),"button"===r&&"button",o&&"focusVisible"]};return(0,m.Z)(a,y,t)},B=(0,k.ZP)(s.Z,{name:"MuiLink",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:r}=e;return[t.root,t["underline".concat((0,b.Z)(r.underline))],"button"===r.component&&t.button]}})(e=>{let{theme:t,ownerState:r}=e;return(0,p.Z)({},"none"===r.underline&&{textDecoration:"none"},"hover"===r.underline&&{textDecoration:"none","&:hover":{textDecoration:"underline"}},"always"===r.underline&&(0,p.Z)({textDecoration:"underline"},"inherit"!==r.color&&{textDecorationColor:_({theme:t,ownerState:r})},{"&:hover":{textDecorationColor:"inherit"}}),"button"===r.component&&{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},["&.".concat(S.focusVisible)]:{outline:"auto"}})}),U=n.forwardRef(function(e,t){let r=(0,f.i)({props:e,name:"MuiLink"}),{className:a,color:s="primary",component:l="a",onBlur:i,onFocus:c,TypographyClasses:u,underline:d="always",variant:m="inherit",sx:b}=r,k=(0,h.Z)(r,C),{isFocusVisibleRef:v,onBlur:j,onFocus:y,ref:S}=(0,g.Z)(),[Z,E]=n.useState(!1),R=(0,T.Z)(t,S),_=(0,p.Z)({},r,{color:s,component:l,focusVisible:Z,underline:d,variant:m}),U=D(_);return(0,o.jsx)(B,(0,p.Z)({color:s,className:(0,x.Z)(U.root,a),classes:u,component:l,onBlur:e=>{j(e),!1===v.current&&E(!1),i&&i(e)},onFocus:e=>{y(e),!0===v.current&&E(!0),c&&c(e)},ref:R,ownerState:_,variant:m,sx:[...Object.keys(w).includes(s)?[]:[{color:s}],...Array.isArray(b)?b:[b]]},k))});var L=r(5088),I=()=>{let[e,t]=(0,n.useState)(!1),[r,h]=(0,n.useState)(null),[p,x]=(0,n.useState)(null),[m,b]=(0,n.useState)(null),[k,f]=(0,n.useState)(null),[g,T]=(0,n.useState)(null),[v,j]=(0,n.useState)("5375703"),[y,S]=(0,n.useState)(!1),Z=async()=>{t(!0),T(null),h(null),x(null),b(null),f(null),S(!1);try{let e="http://".concat(L.Gh.SERVER_HOST,":").concat(L.Gh.SERVER_PORT);console.log("Requesting secure session from:",e);let t=v.trim()?"".concat(e,"/public/form-marv/debug-create?formId=").concat(encodeURIComponent(v.trim())):"".concat(e,"/public/form-marv/debug-create");console.log("Requesting secure session with URL:",t);let r=await fetch(t,{method:"GET",headers:{"Content-Type":"text/html"}});if(!r.ok)throw Error("HTTP ".concat(r.status,": ").concat(r.statusText));let o=await r.text();console.log("Received HTML response:",o);let n=o.match(/href="([^"]+)"/);if(n&&n[1]){let e=n[1];console.log("Extracted backend URL:",e);let t=window.location.port,r=e.replace("http://localhost:3500","http://localhost:".concat(t)).replace(/https:\/\/[^.]+\.ngrok-free\.app/,"http://localhost:".concat(t)).replace(/\?jwtToken=[^&]+/,"");console.log("Transformed to frontend URL:",r),h(r);let o=e.match(/jwtToken=([^&]+)/),a=o?o[1]:null;if(a){console.log("Extracted JWT token:",a.substring(0,20)+"..."),sessionStorage.setItem("marv-jwt-token",a),console.log("JWT token stored in sessionStorage"),sessionStorage.getItem("marv-jwt-token")?(console.log("✅ JWT token successfully stored and retrieved from sessionStorage"),S(!0)):(console.error("❌ Failed to store JWT token in sessionStorage"),S(!1));let t=e.replace(/\?jwtToken=[^&]+/,""),r="?jwtToken=".concat(a),o=t.replace("http://localhost:3500","http://localhost:3501").replace(/https:\/\/[^.]+\.ngrok-free\.app/,"http://localhost:3501")+r,n=t.replace("http://localhost:3500","http://localhost:3500").replace(/https:\/\/[^.]+\.ngrok-free\.app/,"http://localhost:3500")+r,s=t.replace("http://localhost:3500","https://c6db887f710f.ngrok-free.app").replace(/https:\/\/[^.]+\.ngrok-free\.app/,"https://c6db887f710f.ngrok-free.app")+r;x(o),b(n),f(s)}else console.warn("Could not extract JWT token from URL"),console.log("Backend URL for debugging:",e),S(!1)}else throw Error("Could not extract secure URL from response")}catch(e){console.error("Failed to request secure session:",e),T("Failed to create secure session: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{t(!1)}};return(0,o.jsxs)(a.Z,{sx:{p:3,maxWidth:800,mx:"auto"},children:[(0,o.jsx)(s.Z,{variant:"h4",gutterBottom:!0,children:"Test Chat Session Creation"}),(0,o.jsx)(s.Z,{variant:"body1",sx:{mb:3},children:"This page tests the secure chat session creation flow. Click the button below to request a temporary secure link from the backend server."}),(0,o.jsxs)(l.Z,{sx:{p:3,mb:3},children:[(0,o.jsx)(s.Z,{variant:"h6",gutterBottom:!0,children:"Backend Configuration"}),(0,o.jsxs)(s.Z,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Server: ",L.Gh.SERVER_HOST,":",L.Gh.SERVER_PORT]}),(0,o.jsx)(s.Z,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Form ID will be sent to backend as a query parameter"}),(0,o.jsxs)(a.Z,{sx:{display:"flex",gap:2,alignItems:"center",mb:2},children:[(0,o.jsx)(i.Z,{label:"Form ID (optional)",value:v,onChange:e=>j(e.target.value),size:"small",sx:{width:200}}),(0,o.jsx)(c.Z,{variant:"contained",onClick:Z,disabled:e,startIcon:e?(0,o.jsx)(u.Z,{size:16}):null,children:e?"Creating Session...":"Create Secure Session"})]}),g&&(0,o.jsx)(d.Z,{severity:"error",sx:{mt:2},children:g})]}),r&&(0,o.jsxs)(l.Z,{sx:{p:3,backgroundColor:"success.light"},children:[(0,o.jsx)(s.Z,{variant:"h6",gutterBottom:!0,children:"✅ Secure Session Created!"}),(0,o.jsx)(s.Z,{variant:"body2",sx:{mb:2},children:"Your secure chat session has been created. Click the link below to open it in your form utilities:"}),y&&(0,o.jsx)(d.Z,{severity:"success",sx:{mb:2},children:"✅ JWT token successfully stored for WebSocket authentication"}),(0,o.jsxs)(a.Z,{sx:{display:"flex",gap:2,alignItems:"center"},children:[(0,o.jsx)(U,{href:r,target:"_blank",rel:"noopener noreferrer",sx:{wordBreak:"break-all",color:"primary.main",textDecoration:"underline"},children:r}),(0,o.jsx)(c.Z,{variant:"outlined",onClick:()=>{r&&window.open(r,"_blank")},size:"small",children:"Open Session"})]}),(0,o.jsx)(s.Z,{variant:"caption",sx:{display:"block",mt:2},children:"This link will take you to the form MARV interface with the chat session open. The session is secure and temporary."})]}),(p||m||k)&&(0,o.jsxs)(l.Z,{sx:{p:3,mt:3,backgroundColor:"info.light"},children:[(0,o.jsx)(s.Z,{variant:"h6",gutterBottom:!0,children:"\uD83D\uDD17 Links with JWT Parameters"}),(0,o.jsx)(s.Z,{variant:"body2",sx:{mb:3},children:"These links include the JWT token as a URL parameter for direct access:"}),(0,o.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[p&&(0,o.jsxs)(a.Z,{sx:{p:2,border:1,borderColor:"divider",borderRadius:1,backgroundColor:"background.paper"},children:[(0,o.jsx)(s.Z,{variant:"subtitle2",gutterBottom:!0,children:"Frontend Dev (3501)"}),(0,o.jsx)(U,{href:p,target:"_blank",rel:"noopener noreferrer",sx:{wordBreak:"break-all",color:"primary.main",textDecoration:"underline",fontSize:"0.875rem"},children:p.replace(/\?jwtToken=[^&]+/,"?jwtToken=...")})]}),m&&(0,o.jsxs)(a.Z,{sx:{p:2,border:1,borderColor:"divider",borderRadius:1,backgroundColor:"background.paper"},children:[(0,o.jsx)(s.Z,{variant:"subtitle2",gutterBottom:!0,children:"Backend Dev (3500)"}),(0,o.jsx)(U,{href:m,target:"_blank",rel:"noopener noreferrer",sx:{wordBreak:"break-all",color:"primary.main",textDecoration:"underline",fontSize:"0.875rem"},children:m.replace(/\?jwtToken=[^&]+/,"?jwtToken=...")})]}),k&&(0,o.jsxs)(a.Z,{sx:{p:2,border:1,borderColor:"divider",borderRadius:1,backgroundColor:"background.paper"},children:[(0,o.jsx)(s.Z,{variant:"subtitle2",gutterBottom:!0,children:"Ngrok"}),(0,o.jsx)(U,{href:k,target:"_blank",rel:"noopener noreferrer",sx:{wordBreak:"break-all",color:"primary.main",textDecoration:"underline",fontSize:"0.875rem"},children:k.replace(/\?jwtToken=[^&]+/,"?jwtToken=...")})]})]}),(0,o.jsx)(s.Z,{variant:"caption",sx:{display:"block",mt:2},children:"Note: JWT tokens are cropped for display. Click the links to access the full URLs."})]}),(0,o.jsxs)(l.Z,{sx:{p:3,mt:3},children:[(0,o.jsx)(s.Z,{variant:"h6",gutterBottom:!0,children:"How It Works"}),(0,o.jsx)(s.Z,{variant:"body2",sx:{mb:2},children:'1. Click "Create Secure Session" to request a temporary link from the backend'}),(0,o.jsx)(s.Z,{variant:"body2",sx:{mb:2},children:"2. The backend creates a secure session and returns a URL"}),(0,o.jsx)(s.Z,{variant:"body2",sx:{mb:2},children:"3. Click the generated link to open your form utilities interface"}),(0,o.jsx)(s.Z,{variant:"body2",sx:{mb:2},children:"4. The JWT token is stored for WebSocket authentication"}),(0,o.jsx)(s.Z,{variant:"body2",sx:{mb:2},children:"5. You can then interact with the MarvToolBox chat component"}),(0,o.jsx)(s.Z,{variant:"body2",children:"6. The chat will connect using the stored JWT token"})]})]})}}},function(e){e.O(0,[18,621,541,888,774,179],function(){return e(e.s=456)}),_N_E=e.O()}]);